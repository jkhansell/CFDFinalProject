var wpd=wpd||{},wpd=(wpd.initApp=function(){wpd.browserInfo.checkBrowser(),wpd.layoutManager.initialLayout(),wpd.handleLaunchArgs(),wpd.log(),document.getElementById("loadingCurtain").style.display="none"},wpd.loadDefaultImage=function(){!async function(){let e=await fetch("start.png");var t=await e.blob(),t=new File([t],"start.png",{type:"image/png"});wpd.imageManager.initializeFileManager([t]),wpd.imageManager.loadFromFile(t)}()},wpd.handleLaunchArgs=function(){let t=wpd.args.getValue("projectid");null==t?wpd.loadDefaultImage():fetch("storage/project/"+t+".tar").then(function(e){if(e.ok)return e.blob();throw new Error("Can not open project file with ID: "+t)}).then(function(e){wpd.saveResume.readProjectFile(e)}).catch(e=>{wpd.messagePopup.show(wpd.gettext("invalid-project"),e),wpd.loadDefaultImage()})},document.addEventListener("DOMContentLoaded",wpd.initApp,!0),wpd||{}),wpd=(wpd._AutoDetectionDataCounter=0,wpd.AutoDetectionData=class{constructor(){this.imageWidth=0,this.imageHeight=0,this.fgColor=[0,0,255],this.bgColor=[255,255,255],this.mask=new Set,this.binaryData=new Set,this.colorDetectionMode="fg",this.colorDistance=120,this.algorithm=null,this.name=wpd._AutoDetectionDataCounter++}serialize(){var e,t;return null==this.algorithm||null==(e=this.algorithm.serialize())?null:(t=wpd.rle.encode(Array.from(this.mask.values()).sort((e,t)=>e-t)),{fgColor:this.fgColor,bgColor:this.bgColor,mask:t,colorDetectionMode:this.colorDetectionMode,colorDistance:this.colorDistance,algorithm:e,name:this.name,imageWidth:this.imageWidth,imageHeight:this.imageHeight})}deserialize(e){if(this.fgColor=e.fgColor,this.bgColor=e.bgColor,this.imageWidth=e.imageWidth,this.imageHeight=e.imageHeight,null!=e.mask){var t,a=wpd.rle.decode(e.mask);this.mask=new Set;for(t of a)this.mask.add(t)}this.colorDetectionMode=e.colorDetectionMode,this.colorDistance=e.colorDistance,null!=e.algorithm&&("AveragingWindowAlgo"===(a=e.algorithm.algoType)?this.algorithm=new wpd.AveragingWindowAlgo:"AveragingWindowWithStepSizeAlgo"===a?this.algorithm=new wpd.AveragingWindowWithStepSizeAlgo:"BarExtractionAlgo"===a?this.algorithm=new wpd.BarExtractionAlgo:"BlobDetectorAlgo"===a?this.algorithm=new wpd.BlobDetectorAlgo:"XStepWithInterpolationAlgo"===a?this.algorithm=new wpd.XStepWithInterpolationAlgo:"CustomIndependents"===a&&(this.algorithm=new wpd.CustomIndependents),this.algorithm.deserialize(e.algorithm)),this.name=e.name}generateBinaryDataFromMask(i){this.binaryData=new Set;var n,s="fg"===this.colorDetectionMode?this.fgColor:this.bgColor;for(n of this.mask){let e=i.data[4*n],t=i.data[4*n+1],a=i.data[4*n+2];0===i.data[4*n+3]&&(e=255,t=255,a=255);var o=wpd.dist3d(e,t,a,s[0],s[1],s[2]);"fg"===this.colorDetectionMode?o<=this.colorDistance&&this.binaryData.add(n):o>=this.colorDistance&&this.binaryData.add(n)}}generateBinaryDataUsingFullImage(n){this.binaryData=new Set;var s="fg"===this.colorDetectionMode?this.fgColor:this.bgColor;for(let i=0;i<n.data.length;i++){let e=n.data[4*i],t=n.data[4*i+1],a=n.data[4*i+2];0===n.data[4*i+3]&&(e=255,t=255,a=255);var o=wpd.dist3d(e,t,a,s[0],s[1],s[2]);"fg"===this.colorDetectionMode?o<=this.colorDistance&&this.binaryData.add(i):o>=this.colorDistance&&this.binaryData.add(i)}}generateBinaryData(e){null==this.mask||0==this.mask.size?this.generateBinaryDataUsingFullImage(e):this.generateBinaryDataFromMask(e)}setMask(e){this.mask=e}},wpd.GridDetectionData=class{constructor(){this.mask={xmin:null,xmax:null,ymin:null,ymax:null,pixels:[]},this.lineColor=[255,255,255],this.colorDistance=10,this.gridData=null,this.gridMask={xmin:null,xmax:null,ymin:null,ymax:null,pixels:new Set},this.binaryData=new Set,this.imageWidth=0,this.imageHeight=0,this.backupImageData=null,this.gridBackgroundMode=!0}generateBinaryData(s){if(this.binaryData=new Set,this.imageWidth=s.width,this.imageHeight=s.height,null==this.gridMask.pixels||0===this.gridMask.pixels.size){this.gridMask.pixels=new Set;for(let n=0;n<this.imageHeight;n++)for(let i=0;i<this.imageWidth;i++){var o=n*this.imageWidth+i;let e=s.data[4*o],t=s.data[4*o+1],a=s.data[4*o+2];0===s.data[4*o+3]&&(e=255,t=255,a=255);var r=wpd.dist3d(this.lineColor[0],this.lineColor[1],this.lineColor[2],e,t,a);this.gridBackgroundMode?r>this.colorDistance&&(this.binaryData.add(o),this.gridMask.pixels.add(o)):r<this.colorDistance&&(this.binaryData.add(o),this.gridMask.pixels.add(o))}this.gridMask.xmin=0,this.gridMask.xmax=this.imageWidth,this.gridMask.ymin=0,this.gridMask.ymax=this.imageHeight}else for(var e of this.gridMask.pixels){var t=s.data[4*e],a=s.data[4*e+1],i=s.data[4*e+2],t=(s.data[4*e+3],wpd.dist3d(this.lineColor[0],this.lineColor[1],this.lineColor[2],t,a,i));this.gridBackgroundMode?t>this.colorDistance&&this.binaryData.add(e):t<this.colorDistance&&this.binaryData.add(e)}}},wpd||{}),wpd=(wpd.Calibration=class{constructor(e){this._dim=e,this._px=[],this._py=[],this._dimensions=null==e?2:e,this._dp=[],this._selections=[],this.labels=[],this.labelPositions=[],this.maxPointCount=0}getCount(){return this._px.length}getDimensions(){return this._dimensions}addPoint(e,t,a,i,n){var s=this._px.length,o=this._dp.length;this._px[s]=e,this._py[s]=t,this._dp[o]=a,this._dp[o+1]=i,3===this._dimensions&&(this._dp[o+2]=n)}getPoint(e){return e<0||e>=this._px.length?null:{px:this._px[e],py:this._py[e],dx:this._dp[this._dimensions*e],dy:this._dp[this._dimensions*e+1],dz:2===this._dimensions?null:this._dp[this._dimensions*e+2]}}changePointPx(e,t,a){e<0||e>=this._px.length||(this._px[e]=t,this._py[e]=a)}setDataAt(e,t,a,i){e<0||e>=this._px.length||(this._dp[this._dimensions*e]=t,this._dp[this._dimensions*e+1]=a,3===this._dimensions&&(this._dp[this._dimensions*e+2]=i))}findNearestPoint(t,a,i){i=null==i?50:parseFloat(i);let n=0,s=-1;for(let e=0;e<this._px.length;e++){var o=Math.sqrt((t-this._px[e])*(t-this._px[e])+(a-this._py[e])*(a-this._py[e]));(s<0&&o<=i||0<=s&&o<n)&&(s=e,n=o)}return s}selectPoint(e){this._selections.indexOf(e)<0&&this._selections.push(e)}selectNearestPoint(e,t,a){e=this.findNearestPoint(e,t,a);0<=e&&this.selectPoint(e)}getSelectedPoints(){return this._selections}unselectAll(){this._selections=[]}isPointSelected(e){return 0<=this._selections.indexOf(e)}dump(){console.log(this._px),console.log(this._py),console.log(this._dp)}},wpd||{}),wpd=(wpd.ColorGroup=function(i){var n=0,s={r:0,g:0,b:0};i=null==i?100:i,this.getPixelCount=function(){return n},this.getAverageColor=function(){return s},this.isColorInGroup=function(e,t,a){return 0===n||(s.r-e)*(s.r-e)+(s.g-t)*(s.g-t)+(s.b-a)*(s.b-a)<=i*i},this.addPixel=function(e,t,a){s.r=(s.r*n+e)/(n+1),s.g=(s.g*n+t)/(n+1),s.b=(s.b*n+a)/(n+1),n+=1}},wpd.colorAnalyzer={getTopColors:function(e){var t,a,i,n,s,o,r,l=[],d=[];for(l[0]=new wpd.ColorGroup(120),t=0;t<e.data.length;t+=4){for(a=e.data[t],i=e.data[t+1],n=e.data[t+2],0===e.data[t+3]&&(n=i=a=255),o=!1,s=0;s<l.length;s++)if(l[s].isColorInGroup(a,i,n)){l[s].addPixel(a,i,n),o=!0;break}o||(l[l.length]=new wpd.ColorGroup(120),l[l.length-1].addPixel(a,i,n))}for(l.sort(function(e,t){return e.getPixelCount()>t.getPixelCount()?-1:e.getPixelCount()<t.getPixelCount()?1:0}),s=0;s<l.length;s++)r=l[s].getAverageColor(),d[s]={r:parseInt(r.r,10),g:parseInt(r.g,10),b:parseInt(r.b,10),pixels:l[s].getPixelCount(),percentage:100*l[s].getPixelCount()/(.25*e.data.length)};return d}},wpd||{}),wpd=(wpd.Color=class{constructor(e=0,t=0,a=0,i=255){this._r=e,this._g=t,this._b=a,this._a=i}toRGBString(){return`rgb(${this._r}, ${this._g}, ${this._b})`}toRGBAString(){return`rgba(${this._r}, ${this._g}, ${this._b}, ${this._a})`}serialize(){return[this._r,this._g,this._b,this._a]}getRGB(){return[this._r,this._g,this._b]}deserialize(e){this._r=e[0],this._g=e[1],this._b=e[2],this._a=e[3]}},wpd||{}),wpd=(wpd.ConnectedPoints=class{constructor(e){this._connections=[],this._selectedConnectionIndex=-1,this._selectedPointIndex=-1,this._connectivity=e,wpd.appData.isMultipage()&&(this.page=1)}addConnection(e){this._connections.push(e)}clearAll(){this._connections=[]}getConnectionAt(e){if(e<this._connections.length)return this._connections[e]}replaceConnectionAt(e,t){e<this._connections.length&&(this._connections[e]=t)}deleteConnectionAt(e){e<this._connections.length&&this._connections.splice(e,1)}connectionCount(){return this._connections.length}findNearestPointAndConnection(e,t){for(var a,i,n,s=-1,o=-1,r=0;r<this._connections.length;r++)for(n=0;n<this._connections[r].length;n+=2)i=(this._connections[r][n]-e)*(this._connections[r][n]-e)+(this._connections[r][n+1]-t)*(this._connections[r][n+1]-t),(-1===o||i<a)&&(s=r,o=n/2,a=i);return{connectionIndex:s,pointIndex:o}}selectNearestPoint(e,t){e=this.findNearestPointAndConnection(e,t);0<=e.connectionIndex&&(this._selectedConnectionIndex=e.connectionIndex,this._selectedPointIndex=e.pointIndex)}deleteNearestConnection(e,t){e=this.findNearestPointAndConnection(e,t);0<=e.connectionIndex&&this.deleteConnectionAt(e.connectionIndex)}isPointSelected(e,t){return this._selectedPointIndex===t&&this._selectedConnectionIndex===e}getSelectedConnectionAndPoint(){return{connectionIndex:this._selectedConnectionIndex,pointIndex:this._selectedPointIndex}}unselectConnectionAndPoint(){this._selectedConnectionIndex=-1,this._selectedPointIndex=-1}setPointAt(e,t,a,i){this._connections[e][2*t]=a,this._connections[e][2*t+1]=i}getPointAt(e,t){return{x:this._connections[e][2*t],y:this._connections[e][2*t+1]}}},wpd.DistanceMeasurement=class extends wpd.ConnectedPoints{constructor(){super(2)}getDistance(e){if(e<this._connections.length&&2===this._connectivity)return Math.sqrt((this._connections[e][0]-this._connections[e][2])*(this._connections[e][0]-this._connections[e][2])+(this._connections[e][1]-this._connections[e][3])*(this._connections[e][1]-this._connections[e][3]))}},wpd.AngleMeasurement=class extends wpd.ConnectedPoints{constructor(){super(3)}getAngle(e){if(e<this._connections.length&&3===this._connectivity)return(e=180*(e=wpd.taninverse(-(this._connections[e][5]-this._connections[e][3]),this._connections[e][4]-this._connections[e][2])-wpd.taninverse(-(this._connections[e][1]-this._connections[e][3]),this._connections[e][0]-this._connections[e][2]))/Math.PI)<0?e+360:e}},wpd.AreaMeasurement=class extends wpd.ConnectedPoints{constructor(){super(-1)}getArea(n){if(n<this._connections.length&&4<=this._connections[n].length){let i=0;for(let a=0;a<this._connections[n].length;a+=2){var s=this._connections[n][a],o=this._connections[n][a+1];let e=0,t=0;t=a<=this._connections[n].length-4?(e=this._connections[n][a+2],this._connections[n][a+3]):(e=this._connections[n][0],this._connections[n][1]),i+=s*t-e*o}return i/=2}return 0}getPerimeter(n){if(n<this._connections.length){let t=0,a=0,i=0;for(let e=0;e<this._connections[n].length;e+=2){var s,o,r=this._connections[n][e],l=this._connections[n][e+1];2<=e&&(t+=Math.sqrt((r-a)*(r-a)+(l-i)*(l-i))),e==this._connections[n].length-2&&4<=e&&(s=this._connections[n][0],o=this._connections[n][1],t+=Math.sqrt((r-s)*(r-s)+(l-o)*(l-o))),a=r,i=l}return t}}},wpd||{}),wpd=(wpd.plotDataProvider=function(){let k=null;return{setDataSource:function(e){k=e},getData:function(){var s=wpd.appData.getPlotData().getAxesForDataset(k);if(s instanceof wpd.BarAxes){var o=k;var r=s;const _=[],t=[!1,!0];o.hasMetadata();let e=["Label","Value"],n=o.getMetadataKeys().filter(e=>"label"!==e);var l=-1<n.indexOf("overrides");l&&(n=n.filter(e=>"overrides"!==e));var d=o.hasPointGroups(),p=o.getPointGroups();for(let i=0;i<o.getCount();i++){var g,c=o.getPixel(i),u=r.pixelToData(c.x,c.y);let t,a,e=(d&&(t=o.getTupleIndex(i),a=o.getPointGroupIndexInTuple(t,i)),_[i]=[],"Bar"+i);if(null!=c.metadata?e=c.metadata.label:d&&-1<t&&-1<a&&(g=o.getPixel(o.getTuple(t)[0]),e=null!=g.metadata?g.metadata.label:"Bar"+t),_[i].push(e),_[i].push(u[0]),d){let e=p[a];e=e||(-1===a?"":0===a?wpd.gettext("point-group-primary-group"):wpd.gettext("point-group-group")+" "+a),_[i].push(t),_[i].push(e)}for(let t=0;t<n.length;t++){var h=n[t];let e=null;null!=c.metadata&&null!=c.metadata[h]&&(e=c.metadata[h]),_[i].push(e)}if(l){let e=null;null!=c.metadata&&null!=c.metadata.overrides&&null!=c.metadata.overrides.y&&(e=c.metadata.overrides.y),_[i].push(e)}}d&&(e=e.concat("Tuple","Group"),t.push(!0,!0));n.length&&(e=e.concat(n.map(e=>(t.push(!0),wpd.utils.toSentenceCase(e)))));l&&(e=e.concat(["Value-Override"]),t.push(!0));return{fields:e,fieldDateFormat:[],rawData:_,allowConnectivity:!1,connectivityFieldIndices:[],isFieldSortable:t}}{var m=k;var w=s;const A=[],I=[],T=m.hasMetadata();let i=w.getAxesLabels(),t=[],a=[],n=m.getMetadataKeys(),e=!0===T?n.length:0;var x=-1<n.indexOf("overrides");x&&(n=n.filter(e=>"overrides"!==e),--e);var f=m.hasPointGroups(),y=m.getPointGroups();for(let a=0;a<m.getCount();a++){var C=m.getPixel(a),v=w.pixelToData(C.x,C.y);A[a]=[];for(let e=0;e<v.length;e++)A[a].push(v[e]);if(f){var D=m.getTupleIndex(a),P=m.getPointGroupIndexInTuple(D,a);let e=y[P];e=e||(-1===P?"":0===P?wpd.gettext("point-group-primary-group"):wpd.gettext("point-group-group")+" "+P),A[a].push(D),A[a].push(e)}for(let t=0;t<e;t++){var b=n[t];let e=null;null!=C.metadata&&null!=C.metadata[b]&&(e=C.metadata[b]),A[a].push(e)}if(x)for(let t=0;t<i.length;t++){var M=i[t].toLowerCase();let e=null;null!=C.metadata&&null!=C.metadata.overrides&&null!=C.metadata.overrides[M]&&(e=C.metadata.overrides[M]),A[a].push(e)}}f&&(i=i.concat("Tuple","Group"),I.push(!0,!0));T&&(i=i.concat(n.map(e=>wpd.utils.toSentenceCase(e))),x&&(i=i.concat(w.getAxesLabels().map(e=>wpd.utils.toSentenceCase(e)+"-Override"))));for(let e=0;e<i.length;e++)e<w.getDimensions()&&(a[e]=e,null!=w.isDate&&w.isDate(e)&&(t[e]=w.getInitialDateFormat(e))),I[e]=!0;return{fields:i,fieldDateFormat:t,rawData:A,allowConnectivity:!0,connectivityFieldIndices:a,isFieldSortable:I};return}}}}(),wpd.measurementDataProvider=function(){let o=null;return{getData:function(){var e,t=[],a=[],i=[],n=wpd.appData.getPlotData().getAxesForMeasurement(o),s=null!=n&&n instanceof wpd.MapAxes;if(o instanceof wpd.DistanceMeasurement){for(e=0;e<o.connectionCount();e++)a[e]=[],a[e][0]="Dist"+e,a[e][1]=s?n.pixelToDataDistance(o.getDistance(e)):o.getDistance(e);i=[!(t=["Label","Distance"]),!0]}else if(o instanceof wpd.AngleMeasurement){for(e=0;e<o.connectionCount();e++)a[e]=[],a[e][0]="Theta"+e,a[e][1]=o.getAngle(e);i=[!(t=["Label","Angle"]),!0]}else if(o instanceof wpd.AreaMeasurement){for(e=0;e<o.connectionCount();e++)a[e]=[],a[e][0]="Poly"+e,s?(a[e][1]=n.pixelToDataArea(o.getArea(e)),a[e][2]=n.pixelToDataDistance(o.getPerimeter(e))):(a[e][1]=o.getArea(e),a[e][2]=o.getPerimeter(e));i=[!(t=["Label","Area","Perimeter"]),!0,!0]}return{fields:t,fieldDateFormat:[],rawData:a,allowConnectivity:!1,connectivityFieldIndices:[],isFieldSortable:i}},setDataSource:function(e){o=e}}}(),wpd||{}),wpd=(wpd.Dataset=class{constructor(e){this._dim=e,this._dataPoints=[],this._connections=[],this._selections=[],this._pixelMetadataCount=0,this._pixelMetadataKeys=[],this._metadata={},this._groupNames=[],this._tuples=[],this.name="Default Dataset",this.variableNames=["x","y"],this.colorRGB=new wpd.Color(200,0,0)}hasMetadata(){return 0<this._pixelMetadataCount}setMetadataKeys(e){this._pixelMetadataKeys=e}getMetadataKeys(){return this._pixelMetadataKeys}addPixel(e,t,a){var i=this._dataPoints.length;return this._dataPoints[i]={x:e,y:t,metadata:a},null!=a&&this._pixelMetadataCount++,i}getPixel(e){return this._dataPoints[e]}getAllPixels(){return this._dataPoints}setPixelAt(e,t,a){e<this._dataPoints.length&&(this._dataPoints[e].x=t,this._dataPoints[e].y=a)}setMetadataAt(e,t){e<this._dataPoints.length&&(null!=t?null==this._dataPoints[e].metadata&&this._pixelMetadataCount++:null!=this._dataPoints[e].metadata&&this._pixelMetadataCount--,this._dataPoints[e].metadata=t)}insertPixel(e,t,a,i){this._dataPoints.splice(e,0,{x:t,y:a,metadata:i}),null!=i&&this._pixelMetadataCount++}removePixelAtIndex(e){e<this._dataPoints.length&&(null!=this._dataPoints[e].metadata&&this._pixelMetadataCount--,this._dataPoints.splice(e,1))}removeLastPixel(){var e=this._dataPoints.length-1;return this.removePixelAtIndex(e),e}findNearestPixel(t,a,i){i=null==i?50:parseFloat(i);let n=0,s=-1;for(let e=0;e<this._dataPoints.length;e++){var o=Math.sqrt((t-this._dataPoints[e].x)*(t-this._dataPoints[e].x)+(a-this._dataPoints[e].y)*(a-this._dataPoints[e].y));(s<0&&o<=i||0<=s&&o<n)&&(s=e,n=o)}return s}removeNearestPixel(e,t,a){e=this.findNearestPixel(e,t,a);return 0<=e&&this.removePixelAtIndex(e),e}clearAll(){this._dataPoints=[],this._pixelMetadataCount=0,this._pixelMetadataKeys=[],this._metadata={},this._groupNames=[],this._tuples=[]}getCount(){return this._dataPoints.length}selectPixel(e){0<=this._selections.indexOf(e)||this._selections.push(e)}selectPixels(t){for(let e=0;e<t.length;e++)this.selectPixel(t[e])}unselectAll(){this._selections=[]}selectPixelsInRectangle(a,i){const t={ne:function(e,t){return e>=a.x&&e<=i.x&&t>=a.y&&t<=i.y},se:function(e,t){return e>=a.x&&e<=i.x&&t<=a.y&&t>=i.y},sw:function(e,t){return e<=a.x&&e>=i.x&&t<=a.y&&t>=i.y},nw:function(e,t){return e<=a.x&&e>=i.x&&t>=a.y&&t<=i.y}};var e=0<a.x-i.x?-1:1,n=0<a.y-i.y?1:-1;let s=null;s=0<n?0<e?"se":"sw":0<e?"ne":"nw";for(let e=0;e<this._dataPoints.length;e++)t[s](this._dataPoints[e].x,this._dataPoints[e].y)&&this.selectPixel(e)}selectNearestPixel(e,t,a){e=this.findNearestPixel(e,t,a);return 0<=e&&this.selectPixel(e),e}selectNextPixel(){for(let e=0;e<this._selections.length;e++)this._selections[e]=(this._selections[e]+1)%this._dataPoints.length}selectPreviousPixel(){for(let t=0;t<this._selections.length;t++){let e=this._selections[t];0===e?e=this._dataPoints.length-1:e-=1,this._selections[t]=e}}getSelectedPixels(){return this._selections}getPointGroups(){return this._groupNames}setPointGroups(e){this._groupNames=e}hasPointGroups(){return 0<this._groupNames.length}getPointGroupsCount(){return this._groupNames.length}getPointGroupIndexInTuple(e,t){return this._tuples[e]?this._tuples[e].indexOf(t):-1}getPixelIndexesInGroup(t){return t<this._groupNames.length?this._tuples.map(e=>e[t]):[]}removePointGroupFromTuples(t){t<this._groupNames.length&&this._tuples.forEach(e=>{e.splice(t,1)})}addTuple(t){if(this._tuples.some(e=>e[0]===t))return null;{const e=Array(this._groupNames.length).fill(null);return e[0]=t,this._tuples.push(e),this._tuples.length-1}}addEmptyTupleAt(e){this._tuples[e]||(this._tuples[e]=Array(this._groupNames.length).fill(null))}addToTupleAt(e,t,a){this._tuples[e].includes(a)||(this._tuples[e][t]=a)}removeTuple(e){e<this._tuples.length&&this._tuples.splice(e,1)}removeFromTupleAt(e,t){t=this._tuples[e].indexOf(t);-1<t&&(this._tuples[e][t]=null)}getTupleIndex(t){return this._tuples.findIndex(e=>e.includes(t))}getTuple(e){return this._tuples[e]}getTupleCount(){return this._tuples.length}getAllTuples(){return this._tuples}isTupleEmpty(e){return this._tuples[e].every(e=>null===e)}refreshTuplesAfterGroupAdd(t){this._tuples.forEach(e=>e.push(...Array(t).fill(null)))}refreshTuplesAfterPixelRemoval(t){for(let e=0;e<this._tuples.length;e++){const a=this._tuples[e];for(let e=0;e<a.length;e++)null!==a[e]&&(a[e]===t?a[e]=null:a[e]>t&&a[e]--)}}getMetadata(){return JSON.parse(JSON.stringify(this._metadata))}setMetadata(e){this._metadata=JSON.parse(JSON.stringify(e))}},wpd||{}),wpd=(wpd.dateConverter={parse:function(e){var t,a,i,n,s,o;return null==e||"string"==typeof e&&e.indexOf("/")<0&&e.indexOf(":")<0||(o=(e=(e=e).toString()).split(/[/ :]/),e=0<=e.indexOf("/"),o.length<=0||6<o.length)?null:(e=e?(s=parseInt(o[0],10),t=parseInt(void 0===o[1]?0:o[1],10),a=parseInt(void 0===o[2]?1:o[2],10),3):(e=new Date,s=e.getFullYear(),t=e.getMonth()+1,a=e.getDate(),0),i=parseInt(void 0===o[e]?0:o[e],10),n=parseInt(void 0===o[e+1]?0:o[e+1],10),o=parseInt(void 0===o[e+2]?0:o[e+2],10),isNaN(s)||isNaN(t)||isNaN(a)||isNaN(i)||isNaN(n)||isNaN(o)||12<t||t<1||31<a||a<1||23<i||i<0||59<n||n<0||59<o||o<0||((e=new Date).setUTCFullYear(s),e.setUTCMonth(t-1),e.setUTCDate(a),e.setUTCHours(i,n,o),s=parseFloat(Date.parse(e)),isNaN(s))?null:s)},getFormatString:function(e){var t=e.split(/[/ :]/),e=0<=e.indexOf("/"),a="yyyy/mm/dd hh:ii:ss";return 1<=t.length&&(a=e?"yyyy":"hh"),2<=t.length&&(a+=e?"/mm":":ii"),3<=t.length&&(a+=e?"/dd":":ss"),4<=t.length&&(a+=" hh"),5<=t.length&&(a+=":ii"),6===t.length&&(a+=":ss"),a},formatDateNumber:function(e,t){for(var a=1,e=(0<=t.indexOf("s")?a=1e3:0<=t.indexOf("i")?a=6e4:0<=t.indexOf("h")?a=36e5:0<=t.indexOf("d")?a=864e5:0<=t.indexOf("m")?a=2629746e3:0<=t.indexOf("y")&&(a=31556952e3),new Date(Math.round(new Date(e).getTime()/a)*a)),a=t,i=[],n=[],s=new Date("1/1/2021"),o=0;o<12;o++)s.setUTCMonth(o),i.push(s.toLocaleString(void 0,{month:"long"})),n.push(s.toLocaleString(void 0,{month:"short"}));return a=(a=(a=(a=(a=(a=(a=(a=(a=(a=a.replace("YYYY","yyyy")).replace("YY","yy")).replace("MMMM","mmmm")).replace("MMM","mmm")).replace("MM","mm")).replace("DD","dd")).replace("HH","hh")).replace("II","ii")).replace("SS","ss")).replace("yyyy",e.getUTCFullYear()),t=(t=e.getUTCFullYear()%100)<10?"0"+t:t,a=(a=(a=(a=(a=(a=(a=(a=a.replace("yy",t)).replace("mmmm",i[e.getUTCMonth()])).replace("mmm",n[e.getUTCMonth()])).replace("mm",("0"+(e.getUTCMonth()+1)).slice(-2))).replace("dd",("0"+e.getUTCDate()).slice(-2))).replace("hh",("0"+e.getUTCHours()).slice(-2))).replace("ii",("0"+e.getUTCMinutes()).slice(-2))).replace("ss",("0"+e.getUTCSeconds()).slice(-2))}},wpd||{}),wpd=(wpd.gridDetectionCore=function(){var p,g,c=.1,u=.1;return{run:function(e){var t,a,i,n=new Set,s=e.gridMask.xmin,o=e.gridMask.xmax,r=e.gridMask.ymin,l=e.gridMask.ymax,d=e.imageWidth;if(e.imageHeight,g)for(t=s;t<=o;t++){for(i=0,a=r;a<l;a++)e.binaryData.has(a*d+t)&&i++;if(u*(l-r)<i)for(a=r;a<l;a++)n.add(a*d+t)}if(p)for(a=r;a<=l;a++){for(i=0,t=s;t<=o;t++)e.binaryData.has(a*d+t)&&i++;if(c*(o-s)<i)for(t=s;t<=o;t++)n.add(a*d+t)}return n},setHorizontalParameters:function(e,t){p=e,u=Math.abs(parseFloat(t)/100)},setVerticalParameters:function(e,t){g=e,c=Math.abs(parseFloat(t)/100)}}}(),wpd||{}),wpd=(wpd.InputParser=class{constructor(){this.isValid=!1,this.isDate=!1,this.formatting=null,this.isArray=!1}parse(e){var t;return this.isValid=!1,this.isDate=!1,(this.formatting=null)==e||"string"==typeof e&&0<=(e=e.trim()).indexOf("^")?null:null!=(t=wpd.dateConverter.parse(e))?(this.isValid=!0,this.isDate=!0,this.formatting=wpd.dateConverter.getFormatString(e),t):null!=(t=this._parseArray(e))?(this.isValid=!0,this.isArray=!0,t):(t=parseFloat(e),isNaN(t)?null:(this.isValid=!0,t))}_parseArray(e){e=e.replace("[","").replace("]","").split(",").map(e=>parseFloat(e)).filter(e=>!isNaN(e));return 0==e.length?null:e}},wpd||{}),wpd=(wpd.taninverse=function(e,t){var a;return 0<e?a=Math.atan2(e,t):e<=0&&(a=Math.atan2(e,t)+2*Math.PI),a=a>=2*Math.PI?0:a},wpd.sqDist2d=function(e,t,a,i){return(e-a)*(e-a)+(t-i)*(t-i)},wpd.sqDist3d=function(e,t,a,i,n,s){return(e-i)*(e-i)+(t-n)*(t-n)+(a-s)*(a-s)},wpd.dist2d=function(e,t,a,i){return Math.sqrt(wpd.sqDist2d(e,t,a,i))},wpd.dist3d=function(e,t,a,i,n,s){return Math.sqrt(wpd.sqDist3d(e,t,a,i,n,s))},wpd.mat=function(){function a(e){return e[0]*e[3]-e[1]*e[2]}return{det2x2:a,inv2x2:function(e){var t=a(e);return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t]},mult2x2:function(e,t){return[e[0]*t[0]+e[1]*t[2],e[0]*t[1]+e[1]*t[3],e[2]*t[0]+e[3]*t[2],e[2]*t[1]+e[3]*t[3]]},mult2x2Vec:function(e,t){return[e[0]*t[0]+e[1]*t[1],e[2]*t[0]+e[3]*t[1]]},multVec2x2:function(e,t){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1]]}}}(),wpd.cspline=function(e,t){var a,i=e.length,n={x:e,y:t,len:i,d:[]},s=[],o=[];if(i<3)return null;for(o[0]=2,s[0]=3*(t[1]-t[0]),a=1;a<i-1;++a)o[a]=4-1/o[a-1],s[a]=3*(t[a+1]-t[a-1])-s[a-1]/o[a-1];for(o[i-1]=2-1/o[i-2],s[i-1]=3*(t[i-1]-t[i-2])-s[i-2]/o[i-1],n.d[a=i-1]=s[a]/o[a];0<a;)n.d[--a]=(s[a]-n.d[a+1])/o[a];return n},wpd.cspline_interp=function(e,t){var a,i=0;if(t>=e.x[e.len-1]||t<e.x[0])return null;for(;t>e.x[i];)i++;return a=(t-e.x[i=0<i?i-1:0])/(e.x[i+1]-e.x[i]),e.y[i]+e.d[i]*a+(3*(e.y[i+1]-e.y[i])-2*e.d[i]-e.d[i+1])*a*a+(2*(e.y[i]-e.y[i+1])+e.d[i]+e.d[i+1])*a*a*a},wpd.getCircleFrom3Pts=function(e){var t=e[0][0],a=e[1][0],i=e[2][0],n=e[0][1],s=e[1][1],e=e[2][1],o=wpd.dist2d(i,e,a,s),r=wpd.dist2d(t,n,i,e),l=wpd.dist2d(a,s,t,n),d=(o+r+l)/2,d=o*r*l/4/Math.sqrt(d*(d-o)*(d-r)*(d-l)),p=o*o*(r*r+l*l-o*o),g=r*r*(o*o+l*l-r*r),o=l*l*(o*o+r*r-l*l),r=[(t*p+a*g+i*o)/(p+g+o),(n*p+s*g+e*o)/(p+g+o)];return{x0:r[0],y0:r[1],radius:d}},wpd.normalizeAngleDeg=function(e){let t=e%360;return t<0&&(t+=360),t},wpd||{}),wpd=(wpd.PlotData=class{constructor(){this._topColors=null,this._axesColl=[],this._datasetColl=[],this._measurementColl=[],this._objectAxesMap=new Map,this._datasetAutoDetectionDataMap=new Map,this._gridDetectionData=null}reset(){this._axesColl=[],this._datasetColl=[],this._measurementColl=[],this._objectAxesMap=new Map,this._datasetAutoDetectionDataMap=new Map,this._gridDetectionData=null}setTopColors(e){this._topColors=e}getTopColors(e){return this._topColors}addAxes(e){this._axesColl.push(e)}getAxesColl(){return this._axesColl}getAxesNames(){let t=[];return this._axesColl.forEach(e=>{t.push(e.name)}),t}deleteAxes(i){var e=this._axesColl.indexOf(i);0<=e&&(this._axesColl.splice(e,1),this._objectAxesMap.forEach((e,t,a)=>{e===i&&a.set(t,null)}))}getAxesCount(){return this._axesColl.length}addDataset(e){this._datasetColl.push(e);var t=this._axesColl.length;0<t&&(t=this._axesColl[t-1],this.setAxesForDataset(e,t))}getDatasets(){return this._datasetColl}getDatasetNames(){let t=[];return this._datasetColl.forEach(e=>{t.push(e.name)}),t}getDatasetCount(){return this._datasetColl.length}addMeasurement(t,e){if(this._measurementColl.push(t),!e&&t instanceof wpd.DistanceMeasurement&&0<this._axesColl.length)for(let e=0;e<this._axesColl.length;e++)if(this._axesColl[e]instanceof wpd.MapAxes||this._axesColl[e]instanceof wpd.ImageAxes){this.setAxesForMeasurement(t,this._axesColl[e]);break}}getMeasurementColl(){return this._measurementColl}getMeasurementsByType(t){let a=[];return this._measurementColl.forEach(e=>{e instanceof t&&a.push(e)}),a}deleteMeasurement(e){var t=this._measurementColl.indexOf(e);0<=t&&(this._measurementColl.splice(t,1),this._objectAxesMap.delete(e))}setAxesForDataset(e,t){this._objectAxesMap.set(e,t)}setAxesForMeasurement(e,t){this._objectAxesMap.set(e,t)}setAutoDetectionDataForDataset(e,t){this._datasetAutoDetectionDataMap.set(e,t)}getAxesForDataset(e){return this._objectAxesMap.get(e)}getAxesForMeasurement(e){return this._objectAxesMap.get(e)}getAutoDetectionDataForDataset(e){let t=this._datasetAutoDetectionDataMap.get(e);return null==t&&(t=new wpd.AutoDetectionData,this.setAutoDetectionDataForDataset(e,t)),t}getGridDetectionData(){return null==this._gridDetectionData&&(this._gridDetectionData=new wpd.GridDetectionData),this._gridDetectionData}deleteDataset(e){var t=this._datasetColl.indexOf(e);0<=t&&(this._datasetColl.splice(t,1),this._objectAxesMap.delete(e),this._datasetAutoDetectionDataMap.delete(e))}_deserializePreVersion4(i){if(null!=i.axesType){if("ImageAxes"!==i.axesType&&(null==i.calibration||null==i.axesParameters))return!1;let t=null;if("ImageAxes"!==i.axesType){t="TernaryAxes"===i.axesType?new wpd.Calibration(3):new wpd.Calibration(2);for(let e=0;e<i.calibration.length;e++)t.addPoint(i.calibration[e].px,i.calibration[e].py,i.calibration[e].dx,i.calibration[e].dy,i.calibration[e].dz)}let a=null;if("XYAxes"===i.axesType?(a=new wpd.XYAxes,t.labels=["X1","X2","Y1","Y2"],t.labelPositions=["N","N","E","E"],t.maxPointCount=4,a.calibrate(t,i.axesParameters.isLogX,i.axesParameters.isLogY)):"BarAxes"===i.axesType?(a=new wpd.BarAxes,t.labels=["P1","P2"],t.labelPositions=["S","S"],t.maxPointCount=2,a.calibrate(t,i.axesParameters.isLog)):"PolarAxes"===i.axesType?(a=new wpd.PolarAxes,t.labels=["Origin","P1","P2"],t.labelPositions=["E","S","S"],t.maxPointCount=3,a.calibrate(t,i.axesParameters.isDegrees,i.axesParameters.isClockwise)):"TernaryAxes"===i.axesType?(a=new wpd.TernaryAxes,t.labels=["A","B","C"],t.labelPositions=["S","S","E"],t.maxPointCount=3,a.calibrate(t,i.axesParameters.isRange100,i.axesParameters.isNormalOrientation)):"MapAxes"===i.axesType?(a=new wpd.MapAxes,t.labels=["P1","P2"],t.labelPositions=["S","S"],t.maxPointCount=2,a.calibrate(t,i.axesParameters.scaleLength,i.axesParameters.unitString,"top-left",0)):"ImageAxes"===i.axesType&&(a=new wpd.ImageAxes),null!=a&&this._axesColl.push(a),null!=i.dataSeries)for(let e=0;e<i.dataSeries.length;e++){const o=i.dataSeries[e];let t=new wpd.Dataset;t.name=o.name,null!=o.metadataKeys&&0<o.metadataKeys.length&&t.setMetadataKeys(o.metadataKeys.map(e=>e.toLowerCase()));for(let e=0;e<o.data.length;e++){var n,s;0<o.metadataKeys.length?(n=o.metadataKeys[0].toLowerCase(),s=o.data[e].metadata[0],t.addPixel(o.data[e].x,o.data[e].y,{[n]:s})):t.addPixel(o.data[e].x,o.data[e].y)}this.addDataset(t),this.setAxesForDataset(t,a)}if(null!=i.distanceMeasurementData){let t=new wpd.DistanceMeasurement;for(let e=0;e<i.distanceMeasurementData.length;e++)t.addConnection(i.distanceMeasurementData[e]);this.addMeasurement(t),a instanceof wpd.MapAxes&&this.setAxesForMeasurement(t,a)}if(null!=i.angleMeasurementData){let t=new wpd.AngleMeasurement;for(let e=0;e<i.angleMeasurementData.length;e++)t.addConnection(i.angleMeasurementData[e]);this.addMeasurement(t)}}return!0}_deserializeVersion4(i){let n={};var s=(e,t,a,i)=>{n[e]||(n[e]={}),n[e][t]||(n[e][t]={}),n[e][t][a]||(n[e][t][a]=[]),n[e][t][a].push(i)};if(null!=i.axesColl)for(let a=0;a<i.axesColl.length;a++){var o,r,l=i.axesColl[a];let t=null;if("ImageAxes"!==l.type){t="TernaryAxes"===l.type?new wpd.Calibration(3):new wpd.Calibration(2);for(let e=0;e<l.calibrationPoints.length;e++)t.addPoint(l.calibrationPoints[e].px,l.calibrationPoints[e].py,l.calibrationPoints[e].dx,l.calibrationPoints[e].dy,l.calibrationPoints[e].dz)}let e=null;"XYAxes"===l.type?(e=new wpd.XYAxes,t.labels=["X1","X2","Y1","Y2"],t.labelPositions=["N","N","E","E"],t.maxPointCount=4,e.calibrate(t,l.isLogX,l.isLogY,l.noRotation)):"BarAxes"===l.type?(e=new wpd.BarAxes,t.labels=["P1","P2"],t.labelPositions=["S","S"],t.maxPointCount=2,e.calibrate(t,l.isLog,null!=l.isRotated&&l.isRotated)):"PolarAxes"===l.type?(e=new wpd.PolarAxes,t.labels=["Origin","P1","P2"],t.labelPositions=["E","S","S"],t.maxPointCount=3,e.calibrate(t,l.isDegrees,l.isClockwise,l.isLog)):"TernaryAxes"===l.type?(e=new wpd.TernaryAxes,t.labels=["A","B","C"],t.labelPositions=["S","S","E"],t.maxPointCount=3,e.calibrate(t,l.isRange100,l.isNormalOrientation)):"MapAxes"===l.type?(e=new wpd.MapAxes,t.labels=["P1","P2"],t.labelPositions=["S","S"],t.maxPointCount=2,o=null!=l.originLocation?l.originLocation:"top-left",r=null!=l.imageHeight?parseInt(l.imageHeight,10):0,e.calibrate(t,l.scaleLength,l.unitString,o,r)):"ImageAxes"===l.type?e=new wpd.ImageAxes:"CircularChartRecorderAxes"===l.type&&(e=new wpd.CircularChartRecorderAxes,t.labels=["(T0,R0)","(T0,R1)","(T0,R2)","(T1,R2)","(T2,R2)"],t.labelPositions=["S","S","S","S","S"],t.maxPointCount=5,e.calibrate(t,l.startTime)),null!=e&&(e.name=l.name,void 0!==l.metadata&&e.setMetadata(l.metadata),this._axesColl.push(e),void 0!==l.file&&s("file","axes",l.file,e),void 0!==l.page&&s("page","axes",l.page,e))}if(null!=i.datasetColl)for(let e=0;e<i.datasetColl.length;e++){const p=i.datasetColl[e];let a=new wpd.Dataset;a.name=p.name,null!=p.colorRGB&&(a.colorRGB=new wpd.Color(p.colorRGB[0],p.colorRGB[1],p.colorRGB[2])),void 0!==p.metadata&&a.setMetadata(p.metadata),void 0!==p.groupNames&&a.setPointGroups(p.groupNames),null!=p.metadataKeys&&a.setMetadataKeys(p.metadataKeys);for(let t=0;t<p.data.length;t++){let e=p.data[t].metadata;null!=p.data[t].metadata&&Array.isArray(e)&&(e=e.reduce((e,t,a)=>({...e,[p.metadataKeys[a]]:t}),{})),a.hasPointGroups()&&void 0!==p.data[t].tuple&&void 0!==p.data[t].group&&(a.addEmptyTupleAt(p.data[t].tuple),a.addToTupleAt(p.data[t].tuple,p.data[t].group,t)),a.addPixel(p.data[t].x,p.data[t].y,e)}this._datasetColl.push(a),void 0!==p.file&&s("file","datasets",p.file,a),void 0!==p.page&&s("page","datasets",p.page,a);var t=this.getAxesNames().indexOf(p.axesName);if(0<=t&&this.setAxesForDataset(a,this._axesColl[t]),null!=p.autoDetectionData){let e=new wpd.AutoDetectionData;e.deserialize(p.autoDetectionData),this.setAutoDetectionDataForDataset(a,e)}}if(null!=i.measurementColl)for(let e=0;e<i.measurementColl.length;e++){var a,d=i.measurementColl[e];let t=null;if("Distance"===d.type?(t=new wpd.DistanceMeasurement,this._measurementColl.push(t),0<=(a=this.getAxesNames().indexOf(d.axesName))&&this.setAxesForMeasurement(t,this._axesColl[a])):"Angle"===d.type?(t=new wpd.AngleMeasurement,this._measurementColl.push(t)):"Area"===d.type&&(t=new wpd.AreaMeasurement,this._measurementColl.push(t),0<=(a=this.getAxesNames().indexOf(d.axesName))&&this.setAxesForMeasurement(t,this._axesColl[a])),null!=t){for(let e=0;e<d.data.length;e++)t.addConnection(d.data[e]);void 0!==d.file&&s("file","measurements",d.file,t),void 0!==d.page&&s("page","measurements",d.page,t)}}return null!=i.misc&&(n.misc=i.misc),n}deserialize(e){this.reset();try{return null!=e.wpd&&3===e.wpd.version[0]?this._deserializePreVersion4(e.wpd):null==e.version||4!==e.version[0]||this._deserializeVersion4(e)}catch(e){return console.log(e),!1}}serialize(i){let n={version:[4,2],axesColl:[],datasetColl:[],measurementColl:[]};for(let e=0;e<this._axesColl.length;e++){const r=this._axesColl[e];let t={};if(t.name=r.name,i&&(i.file&&void 0!==i.file.axes[r.name]&&(t.file=i.file.axes[r.name]),i.page&&void 0!==i.page.axes[r.name]&&(t.page=i.page.axes[r.name])),r instanceof wpd.XYAxes?(t.type="XYAxes",t.isLogX=r.isLogX(),t.isLogY=r.isLogY(),t.noRotation=r.noRotation()):r instanceof wpd.BarAxes?(t.type="BarAxes",t.isLog=r.isLog(),t.isRotated=r.isRotated()):r instanceof wpd.PolarAxes?(t.type="PolarAxes",t.isDegrees=r.isThetaDegrees(),t.isClockwise=r.isThetaClockwise(),t.isLog=r.isRadialLog()):r instanceof wpd.TernaryAxes?(t.type="TernaryAxes",t.isRange100=r.isRange100(),t.isNormalOrientation=r.isNormalOrientation):r instanceof wpd.MapAxes?(t.type="MapAxes",t.scaleLength=r.getScaleLength(),t.unitString=r.getUnits(),t.originLocation=r.getOriginLocation(),t.imageHeight=r.getImageHeight()):r instanceof wpd.ImageAxes?t.type="ImageAxes":r instanceof wpd.CircularChartRecorderAxes&&(t.type="CircularChartRecorderAxes",t.startTime=r.getStartTime()),0<Object.keys(r.getMetadata()).length&&(t.metadata=r.getMetadata()),!(r instanceof wpd.ImageAxes)){t.calibrationPoints=[];for(let e=0;e<r.calibration.getCount();e++)t.calibrationPoints.push(r.calibration.getPoint(e))}n.axesColl.push(t)}for(let e=0;e<this._datasetColl.length;e++){const l=this._datasetColl[e],d=this.getAxesForDataset(l),t=this.getAutoDetectionDataForDataset(l);let a={};a.name=l.name,a.axesName=null!=d?d.name:"",a.colorRGB=l.colorRGB.serialize(),a.metadataKeys=l.getMetadataKeys(),i&&(i.file&&void 0!==i.file.datasets[l.name]&&(a.file=i.file.datasets[l.name]),i.page&&void 0!==i.page.datasets[l.name]&&(a.page=i.page.datasets[l.name])),l.hasPointGroups()&&(a.groupNames=l.getPointGroups()),0<Object.keys(l.getMetadata()).length&&(a.metadata=l.getMetadata()),a.data=[];for(let t=0;t<l.getCount();t++){let e=l.getPixel(t);var s,o;l.hasPointGroups()&&(s=l.getTupleIndex(t),o=l.getPointGroupIndexInTuple(s,t),-1<s&&-1<o&&(e.tuple=s,e.group=o)),a.data[t]=e,null!=d&&(a.data[t].value=d.pixelToData(e.x,e.y))}a.autoDetectionData=null!=t?t.serialize():null,n.datasetColl.push(a)}for(let e=0;e<this._measurementColl.length;e++){const p=this._measurementColl[e];var a=this.getAxesForMeasurement(p);let t={};p instanceof wpd.DistanceMeasurement?(t.type="Distance",t.name="Distance",t.axesName=null!=a?a.name:""):p instanceof wpd.AngleMeasurement?(t.type="Angle",t.name="Angle"):p instanceof wpd.AreaMeasurement&&(t.type="Area",t.name="Area",t.axesName=null!=a?a.name:""),i&&(i.file&&void 0!==i.file.measurements[e]&&(t.file=i.file.measurements[e]),i.page&&void 0!==i.page.measurements[e]&&(t.page=i.page.measurements[e])),t.data=[];for(let e=0;e<p.connectionCount();e++)t.data.push(p.getConnectionAt(e));n.measurementColl.push(t)}return i&&i.misc&&(n.misc=i.misc),n}},wpd||{}),wpd=(wpd.rle={},wpd.rle.encode=function(e){let t=[],a=null,i=[0,0];for(var n of e)null==a?i=[n,1]:n==a+1?i[1]++:(t.push(i),i=[n,1]),a=n;return 0!=i[1]&&t.push(i),t},wpd.rle.decode=function(e){let t=[];for(var a of e){var i=a[0],n=a[1];for(let e=0;e<n;++e)t.push(i+e)}return t},wpd||{}),wpd=(wpd.AveragingWindowCore=class{constructor(e,t,a,i,n,s){this._binaryData=e,this._imageHeight=t,this._imageWidth=a,this._dx=i,this._dy=n,this._dataSeries=s}run(){var e,t,a,i,n,s,o,r,l,d,p,g,c,u,h,m,w,x,f=[],y=0,C=this._imageWidth,v=this._imageHeight,D=[],P=this._dx,b=this._dy;for(this._dataSeries.clearAll(),e=0;e<C;e++){for(n=-1,a=-2*b,t=i=0;t<v;t++)this._binaryData.has(t*C+e)&&(a+b<t?a=D[n+=i=1]=t:(i+=1,D[n]=parseFloat((D[n]*(i-1)+t)/parseFloat(i))));if(0<=n)for(o=e+.5,s=0;s<=n;s++)r=D[s]+.5,f[y]=[],f[y][0]=parseFloat(o),f[y][1]=parseFloat(r),f[y][2]=!0,y+=1}if(0!==y){for(l=0;l<y;l++)if(!0===f[l][2]){for(d=!0,p=l+1,u=g=f[l][0],h=c=f[l][1],x=1;!0===d&&p<y;)m=f[p][0],w=f[p][1],Math.abs(m-g)<=P&&Math.abs(w-c)<=b&&!0===f[p][2]&&(u=(u*x+m)/(x+1),h=(h*x+w)/(x+1),x+=1,f[p][2]=!1),g+2*P<m&&(d=!1),p+=1;f[l][2]=!1,this._dataSeries.addPixel(parseFloat(u),parseFloat(h))}return f=[],this._dataSeries}}},wpd||{}),wpd=(wpd.AveragingWindowAlgo=class{constructor(){this._xStep=10,this._yStep=10,this._wasRun=!1}getParamList(e){return{xStep:["ΔX","Px",this._xStep],yStep:["ΔY","Px",this._yStep]}}setParams(e){this._xStep=parseFloat(e.xStep),this._yStep=parseFloat(e.yStep)}getParams(){return{xStep:this._xStep,yStep:this._yStep}}serialize(){return this._wasRun?{algoType:"AveragingWindowAlgo",xStep:this._xStep,yStep:this._yStep}:null}deserialize(e){this._xStep=e.xStep,this._yStep=e.yStep,this._wasRun=!0}run(e,t,a){this._wasRun=!0;let i=new wpd.AveragingWindowCore(e.binaryData,e.imageHeight,e.imageWidth,this._xStep,this._yStep,t);i.run()}},wpd||{}),wpd=(wpd.AveragingWindowWithStepSizeAlgo=class{constructor(){this._xmin=0,this._xmax=0,this._delx=.1,this._lineWidth=30,this._ymin=0,this._ymax=0,this._wasRun=!1}getParamList(e){return this._wasRun||null!=e&&e instanceof wpd.XYAxes&&(e=e.getBounds(),this._xmin=e.x1,this._xmax=e.x2,this._ymin=e.y3,this._ymax=e.y4),{xmin:["X_min","Units",this._xmin],delx:["ΔX Step","Units",this._delx],xmax:["X_max","Units",this._xmax],ymin:["Y_min","Units",this._ymin],ymax:["Y_max","Units",this._ymax],lineWidth:["Line width","Px",this._lineWidth]}}setParams(e){this._xmin=parseFloat(e.xmin),this._delx=parseFloat(e.delx),this._xmax=parseFloat(e.xmax),this._ymin=parseFloat(e.ymin),this._ymax=parseFloat(e.ymax),this._lineWidth=parseFloat(e.lineWidth)}getParams(){return{xmin:this._xmin,delx:this._delx,xmax:this._xmax,ymin:this._ymin,ymax:this._ymax,lineWidth:this._lineWidth}}serialize(){return this._wasRun?{algoType:"AveragingWindowWithStepSizeAlgo",xmin:this._xmin,delx:this._delx,xmax:this._xmax,ymin:this._ymin,ymax:this._ymax,lineWidth:this._lineWidth}:null}deserialize(e){this._xmin=e.xmin,this._delx=e.delx,this._xmax=e.xmax,this._ymin=e.ymin,this._ymax=e.ymax,this._lineWidth=e.lineWidth,this._wasRun=!0}run(e,t,a){this._wasRun=!0;var i,n,s,o,r,l,d,p,g,c,u,h,m=e.imageWidth,w=e.imageHeight;for(t.clearAll(),i=this._xmin;i<=this._xmax;i+=this._delx)for(n=(x=a.dataToPixel(i,this._ymin)).x,o=x.y,s=(x=a.dataToPixel(i,this._ymax)).x,r=x.y,l=Math.sqrt((r-o)*(r-o)+(s-n)*(s-n)),d=(this._ymax-this._ymin)/l,u=p=!1,h=c=g=0;h<=l;h++){var x,f=-h*d+this._ymax,f=(x=a.dataToPixel(i,f)).x,y=x.y;0<=f&&f<m&&0<=y&&y<w&&(e.binaryData.has(parseInt(y,10)*m+parseInt(f,10))?(!1===p&&(c=g=h,u=!(p=!0)),!0===u&&(c=h,u=!1)):!1===u&&(c=h,u=!0),!0===p&&(h>g+this._lineWidth||h==l-1)&&(p=!1,y=-((g+(c=c<g?h:c))/2)*d+this._ymax,x=a.dataToPixel(i,y),t.addPixel(parseFloat(x.x),parseFloat(x.y)),0))}}},wpd||{}),wpd=(wpd.BarValue=class{constructor(){this.npoints=0,this.avgValTop=0,this.avgValBot=0,this.avgX=0}append(e,t,a){this.avgX=(this.npoints*this.avgX+e)/(this.npoints+1),this.avgValTop=(this.npoints*this.avgValTop+t)/(this.npoints+1),this.avgValBot=(this.npoints*this.avgValBot+a)/(this.npoints+1),this.npoints++}isPointInGroup(e,t,a,i,n){return 0===this.npoints||Math.abs(this.avgX-e)<=i&&Math.abs(this.avgValTop-t)<=n&&Math.abs(this.avgValBot-a)<=n}},wpd.BarExtractionAlgo=class{constructor(){this._delX=30,this._delVal=10,this._wasRun=!1}getParamList(e){return"Y"===e.getOrientation().axes?{delX:["ΔX","Px",this._delX],delVal:["ΔVal","Px",this._delVal]}:{delX:["ΔY","Px",this._delX],delVal:["ΔVal","Px",this._delVal]}}setParams(e){this._delX=parseFloat(e.delX),this._delVal=parseFloat(e.delVal)}getParams(e){return{delX:this._delX,delVal:this._delVal}}serialize(){return this._wasRun?{algoType:"BarExtractionAlgo",delX:this._delX,delVal:this._delVal}:null}deserialize(e){this._delX=e.delX,this._delVal=e.delVal,this._wasRun=!0}run(e,t,a){this._wasRun=!0;function i(e,t,a,i,n){for(p=!1,g=0;g<m.length;g++)if((c=m[g]).isPointInGroup(e,t,a,i,n)){c.append(e,t,a),p=!0;break}p||((c=new wpd.BarValue).append(e,t,a),m.push(c))}var n,s,o,r,l,d,p,g,c,u,h=a.getOrientation(),m=[],w=e.imageWidth,x=e.imageHeight;if(t.clearAll(),"Y"===h.axes)for(l=0;l<w;l++){for(s=x-1,d=o=n=0;d<x;d++)if(e.binaryData.has(d*w+l)){n=d,o++;break}for(d=x-1;0<=d;d--)if(e.binaryData.has(d*w+l)){s=d,o++;break}2===o&&i(l,n,s,this._delX,this._delVal)}else for(d=0;d<x;d++){for(o=s=0,l=n=w-1;0<=l;l--)if(e.binaryData.has(d*w+l)){n=l,o++;break}for(l=0;l<w;l++)if(e.binaryData.has(d*w+l)){s=l,o++;break}2===o&&i(d,n,s,this._delX,this._delVal)}for(!a.dataPointsHaveLabels||null!=(u=t.getMetadataKeys())&&"label"===u[0]||t.setMetadataKeys(["label"]),g=0;g<m.length;g++)c=m[g],s=("Y"===h.axes?(n=a.pixelToData(c.avgX,c.avgValTop)[0],a.pixelToData(c.avgX,c.avgValBot)):(n=a.pixelToData(c.avgValTop,c.avgX)[0],a.pixelToData(c.avgValBot,c.avgX)))[0],r=n+s<0?"increasing"===h.direction?c.avgValBot:c.avgValTop:"increasing"===h.direction?c.avgValTop:c.avgValBot,a.dataPointsHaveLabels?"Y"===h.axes?t.addPixel(c.avgX+.5,r+.5,{label:"Bar"+g}):t.addPixel(r+.5,c.avgX+.5,{label:"Bar"+g}):"Y"===h.axes?t.addPixel(c.avgX+.5,r+.5):t.addPixel(r+.5,c.avgX+.5)}},wpd||{}),wpd=(wpd.BlobDetectorAlgo=class{constructor(){this._minDia=0,this._maxDia=5e3,this._wasRun=!1}getParamList(e){return null!=e&&e instanceof wpd.MapAxes?{minDia:["Min Diameter","Units",this._minDia],maxDia:["Max Diameter","Units",this._maxDia]}:{minDia:["Min Diameter","Px",this._minDia],maxDia:["Max Diameter","Px",this._maxDia]}}serialize(){return this._wasRun?{algoType:"BlobDetectorAlgo",minDia:this._minDia,maxDia:this._maxDia}:null}deserialize(e){this._minDia=e.minDia,this._maxDia=e.maxDia,this._wasRun=!0}setParams(e){this._minDia=parseFloat(e.minDia),this._maxDia=parseFloat(e.maxDia)}getParams(){return{minDia:this._minDia,maxDia:this._maxDia}}run(e,t,a){this._wasRun=!0;var i,n,s,o,r,l,d,p,g,c,u=e.imageWidth,h=e.imageHeight,m=[],w=[];if(!(u<=0||h<=0||null==e.binaryData||0===e.binaryData.size)){for(t.clearAll(),t.setMetadataKeys(["area","moment"]),i=0;i<u;i++)for(n=0;n<h;n++)if(e.binaryData.has(n*u+i)&&!0!==m[n*u+i])for(m[n*u+i]=!0,w[o=w.length]={pixels:[{x:i,y:n}],centroid:{x:i,y:n},area:1,moment:0},s=0;s<w[o].pixels.length;){for(d=w[o].pixels[s].x,p=w[o].pixels[s].y,r=d-1;r<=d+1;r++)for(l=p-1;l<=p+1;l++)0<=r&&0<=l&&r<u&&l<h&&!0!==m[l*u+r]&&e.binaryData.has(l*u+r)&&(m[l*u+r]=!0,g=w[o].pixels.length,w[o].pixels[g]={x:r,y:l},w[o].centroid.x=(w[o].centroid.x*g+r)/(g+1),w[o].centroid.y=(w[o].centroid.y*g+l)/(g+1),w[o].area=w[o].area+1);s+=1}for(o=0;o<w.length;o++){for(s=w[o].moment=0;s<w[o].pixels.length;s++)w[o].moment=w[o].moment+(w[o].pixels[s].x-w[o].centroid.x)*(w[o].pixels[s].x-w[o].centroid.x)+(w[o].pixels[s].y-w[o].centroid.y)*(w[o].pixels[s].y-w[o].centroid.y);a instanceof wpd.MapAxes&&(w[o].area=plotData.axes.pixelToDataArea(w[o].area)),(c=2*Math.sqrt(w[o].area/Math.PI))<=this._maxDia&&c>=this._minDia&&t.addPixel(w[o].centroid.x+.5,w[o].centroid.y+.5,{area:w[o].area,moment:w[o].moment})}}}},wpd||{}),wpd=(wpd.CustomIndependents=class{constructor(){this._xvals=[],this._ymin=0,this._ymax=0,this._curveWidth=5,this._wasRun=!1}deserialize(e){this._xvals=e.xvals,this._ymin=e.ymin,this._ymax=e.ymax,this._curveWidth=e.curveWidth,this._wasRun=!0}setParams(e){this._xvals=e.xvals,this._ymin=parseFloat(e.ymin),this._ymax=parseFloat(e.ymax),this._curveWidth=parseFloat(e.curveWidth)}getParams(){return{xvals:this._xvals,ymin:this._ymin,ymax:this._ymax,curveWidth:this._curveWidth}}getParamList(e){return this._wasRun||null!=e&&e instanceof wpd.XYAxes&&(e=e.getBounds(),this._xvals="["+e.x1+", "+e.x2+"]",this._ymin=e.y3,this._ymax=e.y4,this._curveWidth=5),{xvals:["X Values","Array",this._xvals],ymin:["Y min","Units",this._ymin],ymax:["Y max","Units",this._ymax],curveWidth:["Curve Width","Px",this._curveWidth]}}serialize(){return this._wasRun?{algoType:"CustomIndependents",xvals:this._xvals,ymin:this._ymin,ymax:this._ymax,curveWidth:this._curveWidth}:null}run(l,a,d){this._wasRun=!0,a.clearAll();let e=new wpd.InputParser,i=e.parse(this._xvals);if(null!=i&&e.isArray){var p=d.isLogX(),g=d.isLogY(),c=d.isLogXNegative(),u=c?-1:1,h=d.isLogYNegative()?-1:1,c=(c?i.sort((e,t)=>t-e):i.sort((e,t)=>e-t),i[0]),m=i[i.length-1];let e=c,t=m,n=this._ymin,s=this._ymax;p&&(e=Math.log10(u*e),t=Math.log10(u*t)),g&&(n=Math.log10(h*n),s=Math.log10(h*s));var w=d.dataToPixel(c,this._ymin),m=d.dataToPixel(m,this._ymin),c=d.dataToPixel(c,this._ymax),m=Math.sqrt((w.x-m.x)*(w.x-m.x)+(w.y-m.y)*(w.y-m.y)),w=Math.sqrt((w.x-c.x)*(w.x-c.x)+(w.y-c.y)*(w.y-c.y)),x=(t-e)/m,f=(s-n)/w,y=l.imageWidth,C=l.imageHeight;let o=[],r=[];var v=2<this._curveWidth?this._curveWidth:2;for(let i=e-v*x;i<=t+v*x;i+=x){let e=0,t=0,a=0<f?n:s;for(;0<f&&a<=s||f<0&&a<=n;){var D=d.dataToPixel(p?u*Math.pow(10,i):i,g?h*Math.pow(10,a):a);0<=D.x&&0<=D.y&&D.x<y&&D.y<C&&l.binaryData.has(parseInt(D.y,10)*y+parseInt(D.x,10))&&(e+=a,t++),a+=Math.abs(f)}0<t&&(e/=t,o.push(parseFloat(i)),r.push(parseFloat(e)))}if(!(o.length<=0||r.length<=0)){let n=[],s=[];if(0<this._curveWidth){let t=parseInt(this._curveWidth/2,10);t<1&&(t=1);for(let e=0;e<o.length;e+=t){let t=0,a=0,i=0;var P=d.dataToPixel(p?u*Math.pow(10,o[e]):o[e],g?h*Math.pow(10,r[e]):r[e]);for(let e=0;e<o.length;e++){var b=d.dataToPixel(p?u*Math.pow(10,o[e]):o[e],g?h*Math.pow(10,r[e]):r[e]);Math.abs(P.x-b.x)<this._curveWidth&&Math.abs(P.y-b.y)<this._curveWidth&&(t+=o[e],a+=r[e],i++)}t/=i,a/=i,n.push(t),s.push(a)}}else n=o,s=r;var M,_=wpd.cspline(n,s);if(null!=_)for(let e=0;e<i.length;e++)isNaN(i[e])||null!=(M=wpd.cspline_interp(_,p?Math.log10(u*i[e]):i[e]))&&(M=d.dataToPixel(i[e],g?h*Math.pow(10,M):M),a.addPixel(M.x,M.y))}}}},wpd||{}),wpd=(wpd.XStepWithInterpolationAlgo=class{constructor(){this._xmin=0,this._xmax=1,this._delx=.1,this._smoothing=0,this._ymin=0,this._ymax=0,this._wasRun=!1}getParamList(e){return this._wasRun||null!=e&&e instanceof wpd.XYAxes&&(e=e.getBounds(),this._xmin=e.x1,this._xmax=e.x2,this._delx=(e.x2-e.x1)/50,this._ymin=e.y3,this._ymax=e.y4,this._smoothing=0),{xmin:["X_min","Units",this._xmin],delx:["ΔX Step","Units",this._delx],xmax:["X_max","Units",this._xmax],ymin:["Y_min","Units",this._ymin],ymax:["Y_max","Units",this._ymax],smoothing:["Smoothing","% of ΔX",this._smoothing]}}setParams(e){this._xmin=parseFloat(e.xmin),this._delx=parseFloat(e.delx),this._xmax=parseFloat(e.xmax),this._ymin=parseFloat(e.ymin),this._ymax=parseFloat(e.ymax),this._smoothing=parseFloat(e.smoothing)}getParams(){return{xmin:this._xmin,delx:this._delx,xmax:this._xmax,ymin:this._ymin,ymax:this._ymax,smoothing:this._smoothing}}serialize(){return this._wasRun?{algoType:"XStepWithInterpolationAlgo",xmin:this._xmin,delx:this._delx,xmax:this._xmax,ymin:this._ymin,ymax:this._ymax,smoothing:this._smoothing}:null}deserialize(e){this._xmin=e.xmin,this._delx=e.delx,this._xmax=e.xmax,this._ymin=e.ymin,this._ymax=e.ymax,this._smoothing=e.smoothing,this._wasRun=!0}run(e,t,a){this._wasRun=!0;var i,n,s,o,r,l,d,p,g,c,u,h,m,w,x,f=0,y=e.imageWidth,C=e.imageHeight,v=[],D=[],P=[],b=[],M=Math.abs(this._delx*(this._smoothing/100)),_=a.isLogX(),A=a.isLogY(),I=a.isLogXNegative()?-1:1,T=a.isLogYNegative()?-1:1,k=(a.isDate(0),a.isDate(1),this._xmin),B=this._xmax,E=this._ymin,S=this._ymax,R=M,W=this._delx;for(t.clearAll(),_&&(B=Math.log10(I*B),k=Math.log10(I*k),R=Math.abs(Math.log10(I*this._delx)*this._smoothing/100),W=I*Math.log10(I*W)),A&&(E=Math.log10(T*E),S=Math.log10(T*S)),d=a.dataToPixel(this._xmin,this._ymin),p=a.dataToPixel(this._xmin,this._ymax),h=(S-E)/Math.sqrt((d.x-p.x)*(d.x-p.x)+(d.y-p.y)*(d.y-p.y)),p=a.dataToPixel(this._xmax,this._ymin),u=(B-k)/Math.sqrt((d.x-p.x)*(d.x-p.x)+(d.y-p.y)*(d.y-p.y)),0<Math.abs(R/u)&&Math.abs(R/u)<1&&(R=u),i=0<u?k-2*u:k+2*u;0<u&&i<=B+2*u||u<0&&B-2*u<=i;){for(r=o=0,s=E;0<h&&s<=S||h<0&&S<=s;)0<=(l=a.dataToPixel(_?I*Math.pow(10,i):i,A?T*Math.pow(10,s):s)).x&&0<=l.y&&l.x<y&&l.y<C&&e.binaryData.has(parseInt(l.y,10)*y+parseInt(l.x,10))&&(o=(o*r+s)/parseFloat(r+1),r++),s+=h;0<r&&(v[f]=parseFloat(i),D[f]=parseFloat(o),f+=1),i+=u}if(!(v.length<=0||D.length<=0)){if(0<R)for(P=[],b=[],i=v[0];0<u&&i<=v[v.length-1]||u<0&&i>=v[v.length-1];){for(n=r=c=g=0;n<v.length;n++)v[n]<=i+R&&v[n]>=i-R&&(g=(g*r+v[n])/parseFloat(r+1),c=(c*r+D[n])/parseFloat(r+1),r++);0<r&&(P[P.length]=g,b[b.length]=c),0<u?i+=M:i-=M}else P=v,b=D;if(!(P.length<=0||b.length<=0||(m=[],i=k,u<(n=0)&&0<this._delx||0<u&&this._delx<0))){for(;0<u&&i<=B||u<0&&B<=i;)m[n]=i,n++,i+=W;if(u<0&&(P=P.reverse(),b=b.reverse()),null!=(x=wpd.cspline(P,b)))for(w=[],n=0;n<m.length;++n)isNaN(m[n])||(w[n]=wpd.cspline_interp(x,m[n]),null!==w[n]&&(l=a.dataToPixel(_?I*Math.pow(10,m[n]):m[n],A?T*Math.pow(10,w[n]):w[n]),t.addPixel(l.x,l.y)))}}}},wpd||{}),wpd=(wpd.BarAxes=function(){function e(){var n,s,o,r,l,d,p,g=!1,c=!1,u=!1,t={};this.isCalibrated=function(){return g},this.calibration=null,this.calibrate=function(e,t,a){this.calibration=e,g=!1;var i=e.getPoint(0),e=e.getPoint(1);return n=i.px,s=i.py,o=e.px,r=e.py,l=parseFloat(i.dy),d=parseFloat(e.dy),t?(c=!0,l=Math.log(l)/Math.log(10),d=Math.log(d)/Math.log(10)):c=!1,p=this.calculateOrientation(),(u=a)||("Y"==p.axes?o=n:r=s,p=this.calculateOrientation()),g=!0},this.pixelToData=function(e,t){var a=[],t=((t-s)*(r-s)+(o-n)*(e-n))/((r-s)*(r-s)+(o-n)*(o-n));return a[0]=(d-l)*t+l,c&&(a[0]=Math.pow(10,a[0])),a},this.dataToPixel=function(e,t){return{x:0,y:0}},this.pixelToLiveString=function(e,t){return this.pixelToData(e,t)[0].toExponential(4)},this.isLog=function(){return c},this.isRotated=function(){return u},this.dataPointsHaveLabels=!0,this.dataPointsLabelPrefix="Bar",this.calculateOrientation=function(){var e=180*wpd.taninverse(-(r-s),o-n)/Math.PI,t={axes:"Y",direction:"increasing",angle:e};return Math.abs(e-90)<30?(t.axes="Y",t.direction="increasing"):Math.abs(e-270)<30?(t.axes="Y",t.direction="decreasing"):Math.abs(e)<30||Math.abs(e-360)<30?(t.axes="X",t.direction="increasing"):Math.abs(e-180)<30&&(t.axes="X",t.direction="decreasing"),t},this.getOrientation=function(){return p},this.getMetadata=function(){return JSON.parse(JSON.stringify(t))},this.setMetadata=function(e){t=JSON.parse(JSON.stringify(e))},this.name="Bar"}return e.prototype.numCalibrationPointsRequired=function(){return 2},e.prototype.getDimensions=function(){return 2},e.prototype.getAxesLabels=function(){return["Label","Y"]},e}(),wpd||{}),wpd=(wpd.CircularChartRecorderAxes=class{isCalibrated(){return!1}xChart=0;yChart=0;xPen=0;yPen=0;rPen=0;rMax=0;rMin=0;rMinPx=0;rMaxPx=0;chartToPenDist=0;thetac0=0;thetaStartOffset=0;timeFormat=null;time0=0;timeMax=0;tStart=null;tEnd=null;calibrate(e,t){var a=e.getPoint(0),i=e.getPoint(1),n=e.getPoint(2),s=e.getPoint(3),o=e.getPoint(4);let r=new wpd.InputParser;var l=a.dx;this.time0=r.parse(l),r.isDate&&(this.timeFormat=r.formatting);let d=new Date(this.time0),p=(this.timeMax=parseFloat(d.setDate(d.getDate()+7)),this.tStart=r.parse(t),new Date(this.tStart));this.tEnd=parseFloat(p.setDate(p.getDate()+7));l=a.dy,t=n.dy,i=[[a.px,a.py],[i.px,i.py],[n.px,n.py]],i=wpd.getCircleFrom3Pts(i),s=[[n.px,n.py],[s.px,s.py],[o.px,o.py]],o=wpd.getCircleFrom3Pts(s);return this.thetac0=180*wpd.taninverse(i.y0-o.y0,i.x0-o.x0)/Math.PI,this.thetaStartOffset=360*(this.tStart-this.time0)/(this.timeMax-this.time0),this.xChart=o.x0,this.yChart=o.y0,this.xPen=i.x0,this.yPen=i.y0,this.rPen=i.radius,this.rMin=l,this.rMax=t,this.rMinPx=wpd.dist2d(a.px,a.py,o.x0,o.y0),this.rMaxPx=wpd.dist2d(n.px,n.py,o.x0,o.y0),this.chartToPenDist=wpd.dist2d(o.x0,o.y0,i.x0,i.y0),this.calibration=e,!0}pixelToData(e,t){let a=[0,1];var i=wpd.dist2d(e,t,this.xChart,this.yChart),n=(this.rMax-this.rMin)*(i-this.rMinPx)/(this.rMaxPx-this.rMinPx)+this.rMin,t=wpd.taninverse(t-this.yChart,e-this.xChart),e=Math.acos((this.chartToPenDist*this.chartToPenDist+i*i-this.rPen*this.rPen)/(2*this.chartToPenDist*i)),i=wpd.normalizeAngleDeg(180*(t+e)/Math.PI),t=(this.tEnd-this.tStart)*wpd.normalizeAngleDeg(i-this.thetac0-this.thetaStartOffset)/360+this.tStart;return a[0]=t,a[1]=n,a}dataToPixel(e,t){return{x:0,y:0}}pixelToLiveString(e,t){let a=this.pixelToData(e,t);return null==this.timeFormat?"calibration error!":wpd.dateConverter.formatDateNumber(a[0],this.timeFormat)+", "+a[1].toExponential(4)}name="Circular Chart";calibration=null;_metadata={};getStartTime(){return null==this.timeFormat||null==this.tStart?null:wpd.dateConverter.formatDateNumber(this.tStart,this.timeFormat)}getTimeFormat(){return this.timeFormat}getInitialDateFormat(e){return 0==e?this.timeFormat:null}isDate(e){return 0===e}getMetadata(){return JSON.parse(JSON.stringify(this._metadata))}setMetadata(e){this._metadata=JSON.parse(JSON.stringify(e))}numCalibrationPointsRequired(){return 5}getDimensions(){return 2}getAxesLabels(){return["Time","Magnitude"]}},wpd||{}),wpd=(wpd.ImageAxes=function(){function e(){let t={};this.isCalibrated=function(){return!0},this.calibrate=function(){return!0},this.pixelToData=function(e,t){return[e,t]},this.dataToPixel=function(e,t){return{x:e,y:t}},this.pixelToLiveString=function(e,t){e=this.pixelToData(e,t);return e[0].toFixed(2)+", "+e[1].toFixed(2)},this.getMetadata=function(){return JSON.parse(JSON.stringify(t))},this.setMetadata=function(e){t=JSON.parse(JSON.stringify(e))},this.name="Image"}return e.prototype.numCalibrationPointsRequired=function(){return 0},e.prototype.getDimensions=function(){return 2},e.prototype.getAxesLabels=function(){return["X","Y"]},e}(),wpd||{}),wpd=(wpd.MapAxes=function(){function e(){var o,r,l,d,p,g=!1,t={};this.calibration=null,this.isCalibrated=function(){return g},this.calibrate=function(e,t,a,i,n){var s;return this.calibration=e,t=t,a=a,i=i,n=n,s=(e=e).getPoint(0),e=e.getPoint(1),l=Math.sqrt((s.px-e.px)*(s.px-e.px)+(s.py-e.py)*(s.py-e.py)),o=parseFloat(t),r=a,d=null!=i?i:"top-left",p=parseFloat(n),g=!0},this.pixelToData=function(e,t){var a=[];return a[0]=e*o/l,"top-left"===d?a[1]=t*o/l:"bottom-left"===d&&(a[1]=(p-t-1)*o/l),a},this.pixelToDataDistance=function(e){return e*o/l},this.pixelToDataArea=function(e){return e*o*o/(l*l)},this.dataToPixel=function(e,t,a){return{x:0,y:0}},this.pixelToLiveString=function(e,t){e=this.pixelToData(e,t);return e[0].toExponential(4)+", "+e[1].toExponential(4)},this.getScaleLength=function(){return o},this.getUnits=function(){return r},this.getOriginLocation=function(){return d},this.getImageHeight=function(){return p},this.getMetadata=function(){return JSON.parse(JSON.stringify(t))},this.setMetadata=function(e){t=JSON.parse(JSON.stringify(e))},this.name="Map"}return e.prototype.numCalibrationPointsRequired=function(){return 2},e.prototype.getDimensions=function(){return 2},e.prototype.getAxesLabels=function(){return["X","Y"]},e}(),wpd||{}),wpd=(wpd.PolarAxes=function(){function e(){var o,r,l,d,p,g,c,u,h,m,w,x,f,y=!1,C=!1,v=!1,D=!1,t={};this.calibration=null,this.isCalibrated=function(){return y},this.calibrate=function(e,t,a,i){var n,s;return this.calibration=e,t=t,a=a,i=i,n=(e=e).getPoint(0),s=e.getPoint(1),e=e.getPoint(2),o=n.px,r=n.py,l=s.px,d=s.py,x=e.px,p=e.py,g=s.dx,c=s.dy,u=e.dx,m=e.dy,v=a,!0===(C=t)&&(c=Math.PI/180*c,m=Math.PI/180*m),i&&(D=!0,g=Math.log(g)/Math.log(10),u=Math.log(u)/Math.log(10)),h=Math.sqrt((l-o)*(l-o)+(d-r)*(d-r)),m=Math.sqrt((x-o)*(x-o)+(p-r)*(p-r)),w=m-h,x=wpd.taninverse(-(d-r),l-o),f=v?x+c:x-c,y=!0},this.isThetaDegrees=function(){return C},this.isThetaClockwise=function(){return v},this.isRadialLog=function(){return D},this.pixelToData=function(e,t){var a=[],e=parseFloat(e),t=parseFloat(t),i=(u-g)/w*(Math.sqrt((e-o)*(e-o)+(t-r)*(t-r))-h)+g,t=v?f-wpd.taninverse(-(t-r),e-o):wpd.taninverse(-(t-r),e-o)-f;return t<0&&(t+=2*Math.PI),!0===C&&(t=180*t/Math.PI),D&&(i=Math.pow(10,i)),a[0]=i,a[1]=t,a},this.dataToPixel=function(e,t){return{x:0,y:0}},this.pixelToLiveString=function(e,t){e=this.pixelToData(e,t);return e[0].toExponential(4)+", "+e[1].toExponential(4)},this.getMetadata=function(){return JSON.parse(JSON.stringify(t))},this.setMetadata=function(e){t=JSON.parse(JSON.stringify(e))},this.name="Polar"}return e.prototype.numCalibrationPointsRequired=function(){return 3},e.prototype.getDimensions=function(){return 2},e.prototype.getAxesLabels=function(){return["r","θ"]},e}(),wpd||{}),wpd=(wpd.TernaryAxes=function(){function e(){var s,o,r,l,d,p,g,c,u,h=!1,t={};this.isCalibrated=function(){return h},this.calibration=null,this.calibrate=function(e,t,a){var i,n;return this.calibration=e,t=t,a=a,i=(e=e).getPoint(0),n=e.getPoint(1),e=e.getPoint(2),s=i.px,o=i.py,r=n.px,l=n.py,e.px,e.py,d=Math.sqrt((s-r)*(s-r)+(o-l)*(o-l)),p=wpd.taninverse(-(l-o),r-s),g=Math.sqrt(3),c=t,u=a,h=!0},this.isRange100=function(){return c},this.isNormalOrientation=function(){return u},this.pixelToData=function(e,t){var a,i=[],e=parseFloat(e),t=parseFloat(t),n=Math.sqrt((e-s)*(e-s)+(t-o)*(t-o)),t=wpd.taninverse(-(t-o),e-s)-p,e=n*Math.cos(t)/d,n=n*Math.sin(t)/d,t=1-e-n/g,e=e-n/g,n=2*n/g;return 0==u&&(a=e,e=t,t=n,n=a),1==c&&(t*=100,e*=100,n*=100),i[0]=t,i[1]=e,i[2]=n,i},this.dataToPixel=function(e,t,a){return{x:0,y:0}},this.pixelToLiveString=function(e,t){e=this.pixelToData(e,t);return e[0].toExponential(4)+", "+e[1].toExponential(4)+", "+e[2].toExponential(4)},this.getMetadata=function(){return JSON.parse(JSON.stringify(t))},this.setMetadata=function(e){t=JSON.parse(JSON.stringify(e))},this.name="Ternary"}return e.prototype.numCalibrationPointsRequired=function(){return 3},e.prototype.getDimensions=function(){return 3},e.prototype.getAxesLabels=function(){return["a","b","c"]},e}(),wpd||{}),wpd=(wpd.XYAxes=function(){function e(){var d,p,g,c,u,h,m,w,x,f,y,C,v,D,P=!1,b=!1,M=!1,_=!1,A=!1,I=!1,T=!1,k=!1,t={},B=[0,0,0,0],E=[0,0,0,0],S=[0,0];this.getBounds=function(){return{x1:b?Math.pow(10,y):y,x2:b?Math.pow(10,C):C,y3:M?Math.pow(10,v):v,y4:M?Math.pow(10,D):D}},this.isCalibrated=function(){return P},this.calibration=null,this.calibrate=function(e,t,a,i){var n,s,o,r,l;return this.calibration=e,t=t,a=a,i=i,P=!((e=e).getCount()<4)&&(l=e.getPoint(0),n=e.getPoint(1),s=e.getPoint(2),o=e.getPoint(3),r=new wpd.InputParser,g=l.px,m=l.py,c=n.px,w=n.py,u=s.px,x=s.py,h=o.px,f=o.py,y=l.dx,C=n.dx,v=s.dy,D=o.dy,y=r.parse(y),!!r.isValid&&(I=r.isDate,C=r.parse(C),!(!r.isValid||r.isDate!=I)&&(d=r.formatting,v=r.parse(v),!!r.isValid&&(T=r.isDate,D=r.parse(D),!(!r.isValid||r.isDate!=T)&&(p=r.formatting,M=a,k=i,!0===(b=t)&&(C=y<0&&C<0?(_=!0,y=Math.log(-y)/Math.log(10),Math.log(-C)/Math.log(10)):(y=Math.log(y)/Math.log(10),Math.log(C)/Math.log(10))),!0===M&&(D=v<0&&D<0?(A=!0,v=Math.log(-v)/Math.log(10),Math.log(-D)/Math.log(10)):(v=Math.log(v)/Math.log(10),Math.log(D)/Math.log(10))),l=[y-C,0,0,v-D],B=wpd.mat.mult2x2(l,wpd.mat.inv2x2([g-c,u-h,m-w,x-f])),k&&(Math.abs(B[0]*B[3])>Math.abs(B[1]*B[2])?(B[1]=0,B[2]=0,B[0]=(C-y)/(c-g),B[3]=(D-v)/(f-x)):(B[0]=0,B[3]=0,B[1]=(C-y)/(w-m),B[2]=(D-v)/(h-u))),E=wpd.mat.inv2x2(B),S[0]=y-B[0]*g-B[1]*m,S[1]=v-B[2]*u-B[3]*x,!0)))))},this.pixelToData=function(e,t){var a=[],e=parseFloat(e),t=parseFloat(t),e=wpd.mat.mult2x2Vec(B,[e,t]);return e[0]=e[0]+S[0],e[1]=e[1]+S[1],t=e[0],e=e[1],!0===b&&(t=_?-Math.pow(10,t):Math.pow(10,t)),!0===M&&(e=A?-Math.pow(10,e):Math.pow(10,e)),a[0]=t,a[1]=e,a},this.dataToPixel=function(e,t){return b&&(e=_?Math.log(-e)/Math.log(10):Math.log(e)/Math.log(10)),M&&(t=A?Math.log(-t)/Math.log(10):Math.log(t)/Math.log(10)),e=[e-S[0],t-S[1]],{x:(t=wpd.mat.mult2x2Vec(E,e))[0],y:t[1]}},this.pixelToLiveString=function(e,t){var a="",e=this.pixelToData(e,t);return a=(a=a+(I?wpd.dateConverter.formatDateNumber(e[0],d):e[0].toExponential(4))+", ")+(T?wpd.dateConverter.formatDateNumber(e[1],p):e[1].toExponential(4))},this.isDate=function(e){return 0===e?I:T},this.getInitialDateFormat=function(e){return 0===e?d:p},this.isLogX=function(){return b},this.isLogXNegative=function(){return _},this.isLogY=function(){return M},this.isLogYNegative=function(){return A},this.noRotation=function(){return k},this.getOrientation=function(){return{axes:"Y",direction:"increasing",angle:90}},this.getMetadata=function(){return JSON.parse(JSON.stringify(t))},this.setMetadata=function(e){t=JSON.parse(JSON.stringify(e))},this.name="XY"}return e.prototype.numCalibrationPointsRequired=function(){return 4},e.prototype.getDimensions=function(){return 2},e.prototype.getAxesLabels=function(){return["X","Y"]},e}(),wpd||{}),wpd=(wpd.dataTable=function(){var t,m,w,l,g,c,d=1.1.toLocaleString().replace(/\d/g,"");function e(){wpd.graphicsWidget.removeTool(),wpd.popup.show("csvWindow"),document.getElementById("data-number-format-separator").value.trim()===d&&(document.getElementById("data-number-format-separator").value=","===d?"; ":", "),a()}function a(){m=t.getData();{let t=document.getElementById("data-table-dataset-list"),e=document.getElementById("data-sort-variables"),a=document.getElementById("dataVariables"),i=document.getElementById("data-date-formatting-container"),n=document.getElementById("data-date-formatting"),s="",o="",r="",l=!1,d=null!=g,p=null!=c;if(d){let e=wpd.appData.getPlotData().getDatasetNames();e.forEach(e=>{s+='<option value="'+e+'">'+e+"</option>"}),t.innerHTML=s,t.value=g.name}else p&&(0<wpd.appData.getPlotData().getMeasurementsByType(wpd.AreaMeasurement).length&&(s+='<option value="area">'+wpd.gettext("area-measurements")+"</option>"),0<wpd.appData.getPlotData().getMeasurementsByType(wpd.AngleMeasurement).length&&(s+='<option value="angle">'+wpd.gettext("angle-measurements")+"</option>"),0<wpd.appData.getPlotData().getMeasurementsByType(wpd.DistanceMeasurement).length&&(s+='<option value="distance">'+wpd.gettext("distance-measurements")+"</option>"),t.innerHTML=s,c instanceof wpd.AngleMeasurement?t.value="angle":c instanceof wpd.DistanceMeasurement?t.value="distance":c instanceof wpd.AreaMeasurement&&(t.value="area"));a.innerHTML=m.fields.join(", "),i.style.display="none",o+='<option value="raw">'+wpd.gettext("raw")+"</option>";for(let e=0;e<m.fields.length;e++)m.isFieldSortable[e]&&(o+='<option value="'+m.fields[e]+'">'+m.fields[e]+"</option>"),null!=m.fieldDateFormat[e]&&(r+="<p>"+m.fields[e]+' <input type="text" length="15" value="'+m.fieldDateFormat[e]+'" id="data-format-string-'+e+'"/></p>',l=!0);m.allowConnectivity&&(o+='<option value="NearestNeighbor">'+wpd.gettext("nearest-neighbor")+"</option>"),e.innerHTML=o,u(),l?(i.style.display="inline-block",n.innerHTML=r):i.style.display="hidden"}i(),n()}function u(){var e=document.getElementById("data-sort-variables").value,t=document.getElementById("data-sort-order");"NearestNeighbor"===e||"raw"===e?t.setAttribute("disabled",!0):t.removeAttribute("disabled")}function i(){if(null!=m&&null!=m.rawData){w=m.rawData.slice(0);var a,e=document.getElementById("data-sort-variables").value,i="ascending"===document.getElementById("data-sort-order").value,t="raw"===e,n="NearestNeighbor"===e;m.fields.length;if(!t){if(!n)return(a=m.fields.indexOf(e))<0?void 0:void w.sort(function(e,t){return e[a]>t[a]?i?1:-1:e[a]<t[a]?i?-1:1:0});if(n)for(var s,o,r,l,d,p,g,c=w.length,u=m.connectivityFieldIndices,h=0;h<c-1;h++){for(r=-1,l=h+1;l<c;l++){for(d=o=0;d<u.length;d++)p=u[d],o+=(w[h][p]-w[l][p])*(w[h][p]-w[l][p]);(o<s||-1===r)&&(s=o,r=l)}for(d=0;d<m.fields.length;d++)g=w[r][d],w[r][d]=w[h+1][d],w[h+1][d]=g}}}}function n(){if(null!=w){var t,a,i,e=document.getElementById("digitizedDataTable"),n=parseInt(document.getElementById("data-number-format-digits").value,10),s=document.getElementById("data-number-format-style").value,o=[],r=(r=document.getElementById("data-number-format-separator").value).replace(/[^\\]\\t/,"\t").replace(/^\\t/,"\t");for(l="",t=0;t<w.length;t++){for(i=[],a=0;a<m.fields.length;a++)if(null!=m.fieldDateFormat[a])void 0===o[a]&&(o[a]=document.getElementById("data-format-string-"+a).value),i[a]=wpd.dateConverter.formatDateNumber(w[t][a],o[a]);else{if("string"==typeof w[t][a])i[a]=w[t][a];else{let e=w[t][a];null==e?i[a]=null:i[a]="fixed"===s&&0<=n?e.toFixed(n):"precision"===s&&0<=n?e.toPrecision(n):"exponential"===s&&0<=n?e.toExponential(n):e}null===i[a]?i[a]="":i[a]=i[a].toString().replace(".",d)}l=l+i.join(r)+"\n"}e.value=l}}return{showTable:function(){t=wpd.plotDataProvider,g=wpd.tree.getActiveDataset(),c=null,t.setDataSource(g),e()},showAngleData:function(){t=wpd.measurementDataProvider,c=wpd.measurementModes.angle.getData(),g=null,t.setDataSource(c),e()},showAreaData:function(){t=wpd.measurementDataProvider,c=wpd.measurementModes.area.getData(),g=null,t.setDataSource(c),e()},showDistanceData:function(){t=wpd.measurementDataProvider,c=wpd.measurementModes.distance.getData(),g=null,t.setDataSource(c),e()},updateSortingControls:u,reSort:function(){u(),i(),n()},copyToClipboard:function(){var e=document.getElementById("digitizedDataTable");e.focus(),e.select();try{document.execCommand("copy")}catch(e){console.log("copyToClipboard",e.message)}},generateCSV:function(){var e=null!=g?g.name:c instanceof wpd.AngleMeasurement?"angles":"distances";wpd.download.csv(l,e+".csv")},exportToPlotly:function(){if(null!=w){var e,t,a,i={data:[]};for(i.data[0]={},e=0;e<w.length;e++)for(t=0;t<m.fields.length;t++)a=m.fields[t],0===t?a="x":1===t&&(a="y"),0===e&&(i.data[0][a]=[]),null!=m.fieldDateFormat[t]?i.data[0][a][e]=wpd.dateConverter.formatDateNumber(w[e][t],"yyyy-mm-dd hh:ii:ss"):i.data[0][a][e]=w[e][t];wpd.plotly.send(i)}},changeDataset:function(){var e=document.getElementById("data-table-dataset-list");null!=g?(g=wpd.appData.getPlotData().getDatasets()[e.selectedIndex],t.setDataSource(g)):null!=c&&("angle"===e.value?c=wpd.appData.getPlotData().getMeasurementsByType(wpd.AngleMeasurement)[0]:"distance"===e.value?c=wpd.appData.getPlotData().getMeasurementsByType(wpd.DistanceMeasurement)[0]:"area"===e.value&&(c=wpd.appData.getPlotData().getMeasurementsByType(wpd.AreaMeasurement)[0]),t.setDataSource(c)),a()}}}(),wpd||{}),wpd=(wpd.graphicsWidget=function(){var s,o,r,l,d,p,n,g,c,u,h,m,w,x,f,y,C,v,D,P,b,M,_,A,L,I,T,i=!1,t=!1,k=0;function B(e){var t=s.getBoundingClientRect();return{x:parseInt(e.pageX-(t.left+window.pageXOffset),10),y:parseInt(e.pageY-(t.top+window.pageYOffset),10)}}function E(e,t){e/=A,t/=A;return 0===k?{x:e,y:t}:H(k,0,e,t)}function N(){s.width=s.width,o.width=o.width,r.width=r.width,l.width=l.width,d.width=d.width,n.width=n.width}function S(){null!=T&&null!=T.onRemove&&T.onRemove(),T=null}function R(e,t,a){let i,n;switch(e){case 90:i=a??0,n=0;break;case 180:i=t??0,n=a??0;break;case 270:i=0,n=t??0;break;default:i=0,n=0}e=e*Math.PI/180;return new DOMMatrix([Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),i,n])}function a(e=0,t=null,a=null){var i,n;Math.abs(e)%90==0&&(t=t??P*A,a=a??b*A,n=(k=((k||360)+e)%360)%180==0?[t,a]:[a,t],[n,i]=[...n],n=parseInt(n,10),i=parseInt(i,10),c.style.width=n+"px",c.style.height=i+"px",s.width=n,o.width=n,r.width=n,l.width=n,d.width=n,s.height=i,o.height=i,r.height=i,l.height=i,d.height=i,v=n,D=i,n=R(k,t,a),u.setTransform(n),h.setTransform(n),m.setTransform(n),w.setTransform(n),x.setTransform(n),i=t,n=a,null!=_&&(u.fillStyle="rgb(255, 255, 255)",u.fillRect(0,0,i,n),u.drawImage(p,0,0,i,n),null!=T&&null!=T.onRedraw&&T.onRedraw(),null!=I&&null!=I.onRedraw&&I.onRedraw()),0!==e&&wpd.events.dispatch("wpd.image.rotate",{rotation:k}))}function O(e){k=e}function W(){var e=wpd.layoutManager.getGraphicsViewportSize(),t=e.width/+e.height;M<t?(A=e.height/+b,a(0,e.height*M,e.height)):(A=e.width/+P,a(0,e.width,e.width/M))}function F(e){a(0,P*(A=e),b*A)}function z(){i=!i;let e=document.getElementById("extended-crosshair-btn");i?e.classList.add("pressed-button"):e.classList.remove("pressed-button"),d.width=d.width}function H(e,t,a,i){t-=e;if(Math.abs(t)%90!=0)return{x:a,y:i};var n=e%180==0?{x:P,y:b}:{x:b,y:P};let s,o;switch(t){case 90:case-270:s=n.y-i,o=a;break;case 180:case-180:s=n.x-a,o=n.y-i;break;case 270:case-90:s=i,o=n.x-a;break;default:s=a,o=i}return{x:s,y:o}}function G(e,t){var a,i=wpd.zoomView.getSize(),n=wpd.zoomView.getZoomRatio(),s=0,o=0,r=i.width,l=i.height,d=i.width/n,i=i.height/n,e=e-d/2,t=t-i/2,p=e,g=t,c=e+d,u=t+i;e<0&&(p=0,s=-e*n),t<0&&(g=0,o=-t*n),P<=e+d&&(r-=n*((c=P)-(e+d))),b<=t+i&&(l-=n*((u=b)-(t+i)));for(var h=f.getImageData(parseInt(p,10),parseInt(g,10),parseInt(c-p,10),parseInt(u-g,10)),m=y.getImageData(parseInt(p,10),parseInt(g,10),parseInt(c-p,10),parseInt(u-g,10)),w=0;w<m.data.length;w+=4)0==m.data[w]&&0==m.data[w+1]&&0==m.data[w+2]||(a=m.data[w+3]/255,h.data[w]=(1-a)*h.data[w]+a*m.data[w],h.data[w+1]=(1-a)*h.data[w+1]+a*m.data[w+1],h.data[w+2]=(1-a)*h.data[w+2]+a*m.data[w+2]);e=n*(parseInt(p,10)-p),d=n*(parseInt(g,10)-g),wpd.zoomView.setZoomImage(h,parseInt(s+e,10),parseInt(o+d,10),parseInt(r-s,10),parseInt(l-o,10),R(k,r,l))}function e(e){var t,a;clearTimeout(L),L=setTimeout((t=(e=B(e=e)).x,e=e.y,a=E(t,e),i&&(d.width=d.width,x.strokeStyle="rgba(0,0,0, 0.5)",x.beginPath(),x.moveTo(t,0),x.lineTo(t,D),x.moveTo(0,e),x.lineTo(v,e),x.stroke()),G(a.x,a.y),void wpd.zoomView.setCoords(a.x,a.y)),10)}function U(){s=document.getElementById("mainCanvas"),o=document.getElementById("dataCanvas"),r=document.getElementById("drawCanvas"),l=document.getElementById("hoverCanvas"),d=document.getElementById("topCanvas"),p=document.createElement("canvas"),n=document.createElement("canvas"),g=document.createElement("canvas"),u=s.getContext("2d"),h=o.getContext("2d"),w=l.getContext("2d"),x=d.getContext("2d"),m=r.getContext("2d"),f=p.getContext("2d"),y=n.getContext("2d"),C=g.getContext("2d"),c=document.getElementById("canvasDiv"),document.addEventListener("keydown",function(e){t&&220===(e=e).keyCode&&(e.preventDefault(),z())},!1),d.addEventListener("mousemove",e,!1),d.addEventListener("dragover",function(e){e.preventDefault()},!0),d.addEventListener("drop",function(e){e.preventDefault(),e=e,wpd.busyNote.show(),1===(e=e.dataTransfer.files).length&&(wpd.imageManager.initializeFileManager(e),wpd.imageManager.loadFromFile(e[0]))},!0),d.addEventListener("mousemove",j,!1),d.addEventListener("click",V,!1),d.addEventListener("mouseup",$,!1),d.addEventListener("mousedown",q,!1),d.addEventListener("mouseout",K,!0),document.addEventListener("mouseup",Y,!1),document.addEventListener("mousedown",function(e){t=e.target===d},!1),document.addEventListener("keydown",function(e){t&&(e=e,null!=I&&null!=I.onKeyDown&&I.onKeyDown(e))},!0),wpd.zoomView.initZoom(),window.addEventListener("paste",function(t){if(void 0!==t.clipboardData){let e=t.clipboardData.items;if(void 0!==e)for(var a,i=0;i<e.length;i++)-1!==e[i].type.indexOf("image")&&(wpd.busyNote.show(),a=e[i].getAsFile(),wpd.imageManager.initializeFileManager([a]),wpd.imageManager.loadFromFile(a))}},!1)}function X(){null!=I&&null!=I.onRemove&&I.onRemove(),I=null}function j(e){var t,a;null!=I&&null!=I.onMouseMove&&(a=E((t=B(e)).x,t.y),I.onMouseMove(e,t,a))}function V(e){var t,a;null!=I&&null!=I.onMouseClick&&(a=E((t=B(e)).x,t.y),I.onMouseClick(e,t,a))}function Y(e){var t,a;null!=I&&null!=I.onDocumentMouseUp&&(a=E((t=B(e)).x,t.y),I.onDocumentMouseUp(e,t,a))}function $(e){var t,a;null!=I&&null!=I.onMouseUp&&(a=E((t=B(e)).x,t.y),I.onMouseUp(e,t,a))}function q(e){var t,a;null!=I&&null!=I.onMouseDown&&(a=E((t=B(e)).x,t.y),I.onMouseDown(e,t,a))}function K(e){var t,a;null!=I&&null!=I.onMouseOut&&(a=E((t=B(e)).x,t.y),I.onMouseOut(e,t,a))}return{zoomIn:function(){F(1.2*A)},zoomOut:function(){F(A/1.2)},zoomFit:W,zoom100perc:function(){F(1)},toggleExtendedCrosshairBtn:z,setZoomRatio:F,getZoomRatio:function(){return A},rotateClockwise:function(){a(90)},rotateCounterClockwise:function(){a(-90)},rotateAndResize:a,getRotation:function(){return k},setRotation:O,getRotationMatrix:R,getRotatedCoordinates:H,runImageOp:function(e){var t,a,i,e=e(_,P,b);t=e.imageData,a=e.width,i=e.height,e=e.keepZoom,X(),S(),M=(P=a)/+(b=i),p.width=P,p.height=b,n.width=P,n.height=b,f.putImageData(t,0,0),_=t,N(),e?F(A):W()},setTool:function(e){null!=I&&null!=I.onRemove&&I.onRemove(),null!=(I=e)&&null!=I.onAttach&&I.onAttach()},removeTool:X,getAllContexts:function(){return{mainCtx:u,dataCtx:h,drawCtx:m,hoverCtx:w,topCtx:x,oriImageCtx:f,oriDataCtx:y}},resetData:function(){n.width=n.width,o.width=o.width,a()},resetHover:function(){l.width=l.width},imagePx:E,screenPx:function(e,t){return{x:e*A,y:t*A}},screenLength:function(e){return e*A},updateZoomOnEvent:function(e){G((e=E((e=B(e)).x,e.y)).x,e.y),wpd.zoomView.setCoords(e.x,e.y)},updateZoomToImagePosn:function(e,t){G(e,t),wpd.zoomView.setCoords(e,t)},getDisplaySize:function(){return{width:v,height:D}},getImageSize:function(){return{width:P,height:b}},copyImageDataLayerToScreen:function(){k%180==0?h.drawImage(n,0,0,v,D):h.drawImage(n,0,0,D,v)},setRepainter:function(e){null!=T&&null!=T.onRemove&&T.onRemove(),null!=(T=e)&&null!=T.onAttach&&T.onAttach()},removeRepainter:S,forceHandlerRepaint:function(){null!=T&&null!=T.onForcedRedraw&&T.onForcedRedraw()},getRepainter:function(){return T},saveImage:function(){var e,t,a,i,n=document.createElement("canvas"),s=n.getContext("2d");for(n.width=P,n.height=b,s.drawImage(p,0,0,P,b),e=s.getImageData(0,0,P,b),a=y.getImageData(0,0,P,b),t=0;t<e.data.length;t+=4)0==a.data[t]&&0==a.data[t+1]&&0==a.data[t+2]||(i=a.data[t+3]/255,e.data[t]=(1-i)*e.data[t]+i*a.data[t],e.data[t+1]=(1-i)*e.data[t+1]+i*a.data[t+1],e.data[t+2]=(1-i)*e.data[t+2]+i*a.data[t+2]);s.putImageData(e,0,0),window.open(n.toDataURL(),"_blank")},loadImage:function(e,t){return null==s&&U(),X(),S(),P=e.width,b=e.height,M=P/+b,p.width=P,p.height=b,n.width=P,n.height=b,f.drawImage(e,0,0,P,b),_=f.getImageData(0,0,P,b),O(t),N(),W(),_},getImageFiles:function(){let t=[];for(const a of wpd.appData.getFileManager().getFiles()){let e;e="application/pdf"===a.type?a:function(s){return new Promise((n,e)=>{if(s.type.match("image.*")){let e=new FileReader;e.onload=function(){let i=e.result;new Promise((e,t)=>{let a=new Image;a.onload=function(){g.width=a.width,g.height=a.height,C.drawImage(a,0,0,a.width,a.height),e()},a.src=i}).then(()=>{let e=g.toDataURL("image/png"),t=atob(e.split(",")[1]),a=t.length,i=new Uint8Array(a);for(;a--;)i[a]=t.charCodeAt(a);n(new File([i],s.name,{type:"image/png",encoding:"utf-8"})),C.clearRect(0,0,g.width,g.height)})},e.readAsDataURL(s)}else e()})}(a),t.push(e)}return Promise.all(t)}}}(),wpd||{}),wpd=(wpd.layoutManager=function(){var t,a,i,n,s,o;function r(){var e=parseInt(document.body.offsetWidth,10),t=parseInt(document.body.offsetHeight,10);i.style.height=t+"px",n.style.height=t-280+"px",s.style.width=e-i.offsetWidth-5+"px",s.style.height=t+"px",a.style.height=t-85+"px",o.style.height=t-85+"px",wpd.sidebar.resize()}function e(e){clearTimeout(t),t=setTimeout(r,80)}return{initialLayout:function(){a=document.getElementById("graphicsContainer"),i=document.getElementById("sidebarContainer"),n=document.getElementById("sidebarControlsContainer"),s=document.getElementById("mainContainer"),o=document.getElementById("left-side-container"),r(),window.addEventListener("resize",e,!1),wpd.tree.init()},getGraphicsViewportSize:function(){return{width:a.offsetWidth,height:a.offsetHeight}}}}(),wpd||{}),wpd=(wpd.pointGroups=function(){const a="point-group-settings-popup";const o="#point-group-table",e="#point-groups-controls",i="#point-group-0";let r=[],l=null,d=0,t;function n(a){const i=wpd.tree.getActiveDataset();var e=i.getPointGroups();let t=[...document.querySelector(o).children].map(e=>e.querySelector("#point-group-"+e.rowIndex).value);if(1===t.length?(t[0]||(t=[]),wpd.pointGroups.hideControls()):1<t.length&&wpd.pointGroups.showControls(),0<r.length){const s=wpd.tree.getActiveAxes();r.sort((e,t)=>t-e).forEach(e=>{if(a){const t=i.getPixelIndexesInGroup(e).sort((e,t)=>t-e);t.forEach(e=>{null!==e&&(i.removePixelAtIndex(e),i.refreshTuplesAfterPixelRemoval(e))}),wpd.graphicsWidget.resetData(),wpd.graphicsWidget.forceHandlerRepaint(),wpd.dataPointCounter.setCount(i.getCount()),t.forEach(e=>{wpd.events.dispatch("wpd.dataset.point.delete",{axes:s,dataset:i,index:e})})}i.removePointGroupFromTuples(e)})}var n=t.length+r.length-e.length;0<n&&i.refreshTuplesAfterGroupAdd(n),i.setPointGroups(t),0===e.length&&(l=null,d=0),wpd.pointGroups.refreshControls(),wpd.pointGroups.closeSettingsPopup()}return window.onload=()=>{t=wpd.events.addListener("wpd.dataset.select",e=>{const t=document.querySelector("#dataset-edit-point-groups-button");e=wpd.appData.getPlotData().getAxesForDataset(e.dataset);null!=e&&(t.hidden=e instanceof wpd.MapAxes)})},{showSettingsPopup:function(){const e=wpd.tree.getActiveDataset(),t=e.getPointGroups();t.forEach((e,t)=>{0<t?wpd.pointGroups.addSettingsRow(!1,e):document.querySelector(i).value=e}),wpd.popup.show(a)},closeSettingsPopup:function(){wpd.popup.close(a),[...document.querySelector(o).children].forEach(e=>{0<e.rowIndex?e.remove():document.querySelector(i).value=""}),r=[]},addSettingsRow:function(e,t){const a=document.querySelector(o);var i,n=a.lastElementChild.rowIndex+1;const s=document.createElement("template");s.innerHTML=(i=n,t=(t=t)||"",`<tr><td>${wpd.gettext("point-group-group")+` <span>${i}</span>: `}</td><td>${`<input id="point-group-${i}" type="text" value="${t}" />`}</td><td>${`<input type="button" value="${wpd.gettext("point-group-delete-group")}" onclick="wpd.pointGroups.deleteSettingsRow(this)" />`}</td></tr>`),a.appendChild(s.content.firstChild),e&&document.querySelector("#point-group-"+n).focus()},deleteSettingsRow:function(e){const t=e.closest("tr");r.push(t.rowIndex),t.remove(),[...document.querySelector(o).children].forEach(e=>{const t=e.children;e=e.rowIndex;t[0].querySelector("span").innerText=e,t[1].querySelector("input").setAttribute("id","point-group-"+e)})},saveSettings:function(){0<r.length?wpd.pointGroups.showDeleteGroupPopup(n.bind(null,!0),n.bind(null,!1)):n()},previousGroup:function(){const e=wpd.tree.getActiveDataset();if(0!==l||0!==d){let a=-1,i=-1;var n=e.getAllTuples();for(let t=null===l?n.length-1:l;0<=t;t--){const o=n[t];if(void 0===o){a=null,i=0;break}let e=o.length-1;if(-1<(e=t===l?d-1:e)){var s=o.lastIndexOf(null,e);if(-1<s){a=t,i=s;break}}}-1!==a&&-1!==i&&(l=a,d=i)}wpd.pointGroups.refreshControls()},nextGroup:function(){const e=wpd.tree.getActiveDataset();if(null!==l){let a=-1,i=-1;var n=e.getAllTuples();for(let t=l;t<n.length;t++){const o=n[t];let e=0;t===l&&(e=d+1);var s=o.indexOf(null,e);if(-1<s){a=t,i=s;break}}d=-1===a&&-1===i?(l=null,0):(l=a,i)}wpd.pointGroups.refreshControls()},getCurrentGroupIndex:function(){return d},setCurrentGroupIndex:function(e){d=e},getCurrentTupleIndex:function(){return l},setCurrentTupleIndex:function(e){l=e},showControls:function(){document.querySelector(e).hidden=!1},hideControls:function(){document.querySelector(e).hidden=!0},refreshControls:function(){let e=wpd.tree.getActiveDataset().getPointGroups()[d],t=(e=e||(0===d?wpd.gettext("point-group-primary-group"):wpd.gettext("point-group-group")+" "+d),l);null===l&&(t=`(${wpd.gettext("point-group-new-tuple")})`),document.querySelector("#current-point-group-name").innerText=e,document.querySelector("#current-point-tuple-index").innerText=t},showDeleteTuplePopup:function(e,t){wpd.okCancelPopup.show(wpd.gettext("tuple-delete-title"),wpd.gettext("tuple-delete-text"),e,t,wpd.gettext("yes"),wpd.gettext("no"))},showDeleteGroupPopup:function(e,t){wpd.okCancelPopup.show(wpd.gettext("group-delete-title"),wpd.gettext("group-delete-text"),e,t,wpd.gettext("yes"),wpd.gettext("no"))}}}(),wpd||{}),wpd=(wpd.popup=function(){let o=null,r=null;function t(e){let t=document.getElementById("shadow"),a=(t.style.visibility="hidden",document.getElementById(e));a.style.visibility="hidden",d(),window.removeEventListener("keydown",p,!1),r=null}function l(e){let t=document.createElement("div");t.className="popup-drag-mask",t.style.display="inline-block",t.addEventListener("mousemove",a,!1),t.addEventListener("mouseup",i,!1),t.addEventListener("mouseout",s,!1),document.body.appendChild(t),o={dragMaskDiv:t,initialMouseX:e.pageX,initialMouseY:e.pageY,initialWindowX:r.offsetLeft,initialWindowY:r.offsetTop},e.preventDefault(),e.stopPropagation()}function a(e){n(e),e.stopPropagation(),e.preventDefault()}function i(e){n(e),d(),e.stopPropagation(),e.preventDefault()}function n(e){var t=o.initialWindowX+e.pageX-o.initialMouseX,e=o.initialWindowY+e.pageY-o.initialMouseY,a=parseInt(document.body.offsetWidth,10),i=parseInt(document.body.offsetHeight,10),n=parseInt(r.offsetWidth,10),s=parseInt(r.offsetHeight,10);t+.7*n<a&&0<t&&0<e&&e+.5*s<i&&(r.style.top=e+"px",r.style.left=t+"px")}function s(e){d()}function d(){null!=o&&null!=o.dragMaskDiv&&(o.dragMaskDiv.removeEventListener("mouseout",s,!1),o.dragMaskDiv.removeEventListener("mouseup",i,!1),o.dragMaskDiv.removeEventListener("mousemove",a,!1),o.dragMaskDiv.style.display="none",document.body.removeChild(o.dragMaskDiv),o=null)}function p(e){wpd.keyCodes.isEsc(e.keyCode)&&t(r.id)}return{show:function(e){let t=document.getElementById("shadow"),a=(t.style.visibility="visible",document.getElementById(e));var e=parseInt(window.innerWidth,10),i=parseInt(window.innerHeight,10),n=parseInt(a.offsetWidth,10);let s=(i-parseInt(a.offsetHeight,10))/2;s=60<s?60:s,a.style.left=(e-n)/2+"px",a.style.top=s+"px",a.style.visibility="visible";for(let e=0;e<a.childNodes.length;e++)if("popupheading"===a.childNodes[e].className){a.childNodes[e].addEventListener("mousedown",l,!1);break}window.addEventListener("keydown",p,!1);let o=(r=a).getElementsByTagName("input");0<o.length&&o[0].focus()},close:t}}(),wpd.busyNote=function(){var e,t=!1;return{show:function(){t||(null==e&&((e=document.createElement("div")).id="wait",e.innerHTML='<p align="center">'+wpd.gettext("processing")+"...</p>"),document.body.appendChild(e),t=!0)},close:function(){null!=e&&!0===t&&(document.body.removeChild(e),t=!1)}}}(),wpd.messagePopup=function(){var i;return{show:function(e,t,a){wpd.popup.show("messagePopup"),document.getElementById("message-popup-heading").innerHTML=e,document.getElementById("message-popup-text").innerHTML=t,i=a},close:function(){wpd.popup.close("messagePopup"),null!=i&&i()}}}(),wpd.okCancelPopup=function(){var o,r;return{show:function(e,t,a,i,n,s){wpd.popup.show("okCancelPopup"),document.getElementById("ok-cancel-popup-heading").innerHTML=e,document.getElementById("ok-cancel-popup-text").innerHTML=t,document.getElementById("ok-cancel-popup-ok-button").value=n||wpd.gettext("ok"),document.getElementById("ok-cancel-popup-cancel-button").value=s||wpd.gettext("cancel"),o=a,r=i},ok:function(){wpd.popup.close("okCancelPopup"),null!=o&&o()},cancel:function(){wpd.popup.close("okCancelPopup"),null!=r&&r()}}}(),wpd.unsupported=function(){wpd.messagePopup.show(wpd.gettext("unsupported"),wpd.gettext("unsupported-text"))},wpd||{}),wpd=(wpd.sidebar=function(){function a(){const t=document.getElementsByClassName("sidebar");for(let e=0;e<t.length;e++)t[e].style.display="none"}return{show:function(e){a();let t=document.getElementById(e);t.style.display="inline-block",t.style.height=parseInt(document.body.offsetHeight,10)-280+"px"},clear:a,resize:function(){let t=document.getElementsByClassName("sidebar");for(let e=0;e<t.length;e++)"inline-block"===t[e].style.display&&(t[e].style.height=parseInt(document.body.offsetHeight,10)-280+"px")}}}(),wpd||{}),wpd=(wpd.toolbar=function(){function a(){const t=document.getElementsByClassName("toolbar");for(let e=0;e<t.length;e++)t[e].style.visibility="hidden"}return{show:function(e){a();let t=document.getElementById(e);t.style.visibility="visible"},clear:a}}(),wpd||{}),wpd=(wpd.TreeWidget=class{constructor(e){this.$mainElem=e,this.treeData=null,this.itemColors={},this.$mainElem.addEventListener("click",e=>this._onclick(e)),this.$mainElem.addEventListener("keydown",e=>this._onkeydown(e)),this.$mainElem.addEventListener("dblclick",e=>this._ondblclick(e)),this.idmap=[],this.itemCount=0,this.selectedPath=null}_renderFolder(a,i,e){if(null!=a){let t="";t=e?'<ul class="tree-list">':'<ul class="tree-list-root">';for(let e=0;e<a.length;e++){var n=a[e];if(this.itemCount++,"string"==typeof n){var s=i+"/"+n;t+='<li title="'+n+'">';let e=this.itemColors[s];void 0!==e&&(t+='<div class="tree-item-icon" style="background-color: '+e.toRGBString()+';"></div>'),t+='<span class="tree-item" id="tree-item-id-'+this.itemCount+'">'+n+"</span>",this.idmap[this.itemCount]=s}else"object"==typeof n&&(t+="<li>",s=Object.keys(n)[0],t+='<span class="tree-folder" id="tree-item-id-'+this.itemCount+'">'+s+"</span>",this.idmap[this.itemCount]=i+"/"+s,t+=this._renderFolder(n[s],i+"/"+s,!0));t+="</li>"}return t+="</ul>"}}render(e,t){this.idmap=[],this.itemCount=0,this.treeData=e,this.itemColors=t,this.$mainElem.innerHTML=this._renderFolder(this.treeData,"",!1),this.selectedPath=null}_unselectAll(){const e=this.$mainElem.querySelectorAll(".tree-folder"),t=this.$mainElem.querySelectorAll(".tree-item");e.forEach(function(e){e.classList.remove("tree-selected")}),t.forEach(function(e){e.classList.remove("tree-selected")}),this.selectedPath=null}selectPath(e,t){var a=this.idmap.indexOf(e);if(0<=a){this._unselectAll(),this.selectedPath=e;const i=document.getElementById("tree-item-id-"+a);i.classList.add("tree-selected"),null!=this.itemSelectionCallback&&this.itemSelectionCallback(i,e,t)}}_onclick(e){var t=e.target.classList.contains("tree-item"),a=e.target.classList.contains("tree-folder");(t||a)&&(this._unselectAll(),e.target.classList.add("tree-selected"),null!=this.itemSelectionCallback&&(t=parseInt(e.target.id.replace("tree-item-id-",""),10),isNaN(t)||(this.selectedPath=this.idmap[t],this.itemSelectionCallback(e.target,this.idmap[t],!1))))}_onkeydown(e){("F2"===e.key||"r"===e.key.toLowerCase()&&e.metaKey)&&this.itemRenameCallback&&(this.itemRenameCallback(e.target,this.selectedPath,!1),e.preventDefault())}_ondblclick(e){this.itemRenameCallback&&(this.itemRenameCallback(e.target,this.selectedPath,!1),e.preventDefault(),e.stopPropagation())}onItemSelection(e){this.itemSelectionCallback=e}onItemRename(e){this.itemRenameCallback=e}getSelectedPath(){return this.selectedPath}},wpd.tree=function(){let D=null,h=null,m=null;function t(){if(null!=D){let e=[],t={};const c=wpd.appData.getPlotData(),u=wpd.appData.getFileManager(),h=wpd.appData.getPageManager(),m=u.currentFileIndex();e.push(wpd.gettext("image"));let a=c.getAxesNames();const w=u.getAxesNameMap();a=a.filter(e=>w[e]===m);let i={};if(wpd.appData.isMultipage()){const f=h.currentPage(),y=h.getAxesNameMap();i[wpd.gettext("axes")]=a.filter(e=>y[e]===f)}else i[wpd.gettext("axes")]=a;e.push(i);let n=c.getDatasetNames();const x=u.getDatasetNameMap();n=n.filter(e=>x[e]===m);let s={};if(wpd.appData.isMultipage()){const C=h.currentPage(),v=h.getDatasetNameMap();s[wpd.gettext("datasets")]=n.filter(e=>v[e]===C)}else s[wpd.gettext("datasets")]=n;e.push(s);for(var g of c.getDatasets())null!=g.colorRGB&&(t["/"+wpd.gettext("datasets")+"/"+g.name]=g.colorRGB);let o=u.filterToCurrentFileMeasurements(c.getMeasurementsByType(wpd.DistanceMeasurement)),r=u.filterToCurrentFileMeasurements(c.getMeasurementsByType(wpd.AngleMeasurement)),l=u.filterToCurrentFileMeasurements(c.getMeasurementsByType(wpd.AreaMeasurement)),d=(wpd.appData.isMultipage()&&(o=h.filterToCurrentPageMeasurements(o),r=h.filterToCurrentPageMeasurements(r),l=h.filterToCurrentPageMeasurements(l)),[]),p=(0<l.length&&d.push(wpd.gettext("area")),0<r.length&&d.push(wpd.gettext("angle")),0<o.length&&d.push(wpd.gettext("distance")),{});p[wpd.gettext("measurements")]=d,e.push(p),D.render(e,t),P(null)}}function P(t){const e=document.querySelectorAll(".tree-widget");e.forEach(function(e){e.id===t?e.style.display="inline":e.style.display="none"})}function w(){wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.resetData(),wpd.sidebar.clear()}function x(e,a,t){const i=wpd.appData.getPlotData(),n=i.getDatasetNames();a=n.indexOf(a.replace("/"+wpd.gettext("datasets")+"/",""));if(0<=a&&(t||w(),h=i.getDatasets()[a],t||wpd.acquireData.load()),P("dataset-item-tree-widget"),null!=h){const d=wpd.appData.getPlotData(),p=d.getAxesNames();a=d.getAxesForDataset(h);const g=document.getElementById("dataset-item-axes-select"),c=wpd.appData.getFileManager();var s=c.getAxesNameMap(),o=c.currentFileIndex();let t="<option value='-1'>None</option>";if(wpd.appData.isMultipage()){const u=wpd.appData.getPageManager();var r=u.currentPage(),l=u.getAxesNameMap();for(let e=0;e<p.length;e++)s[p[e]]===o&&l[p[e]]===r&&(t+="<option value='"+e+"'>"+p[e]+"</option>")}else for(let e=0;e<p.length;e++)s[p[e]]===o&&(t+="<option value='"+e+"'>"+p[e]+"</option>");g.innerHTML=t,g.value=null==a?"-1":p.indexOf(a.name),m=a}if(null!=h){let e=document.getElementById("dataset-display-color-picker-button");e.style.backgroundColor=h.colorRGB.toRGBString()}wpd.events.dispatch("wpd.dataset.select",{dataset:h})}function f(e){const t=wpd.appData.getPlotData(),a=t.getAxesColl();e=e==wpd.measurementModes.distance;const i=wpd.appData.getFileManager();var n=i.getAxesNameMap(),s=i.currentFileIndex();let o=i.filterToCurrentFileMeasurements(e?t.getMeasurementsByType(wpd.DistanceMeasurement):t.getMeasurementsByType(wpd.AreaMeasurement)),r,l="<option value='-1'>None</option>";if(wpd.appData.isMultipage()){const c=wpd.appData.getPageManager();var d=c.currentPage(),p=c.getAxesNameMap();o=c.filterToCurrentPageMeasurements(o),r=o[o.length-1];for(let e=0;e<a.length;e++)n[a[e].name]===s&&p[a[e].name]===d&&(a[e]instanceof wpd.ImageAxes||a[e]instanceof wpd.MapAxes)&&(l+="<option value='"+e+"'>"+a[e].name+"</option>")}else{r=o[0];for(let e=0;e<a.length;e++)n[a[e].name]===s&&(a[e]instanceof wpd.ImageAxes||a[e]instanceof wpd.MapAxes)&&(l+="<option value='"+e+"'>"+a[e].name+"</option>")}const g=e?document.getElementById("distance-item-axes-select"):document.getElementById("area-item-axes-select");g.innerHTML=l;e=t.getAxesForMeasurement(r);g.value=null==e?"-1":a.indexOf(e),m=e}function a(e,t,a){if(t==="/"+wpd.gettext("image"))w(),m=null,P("image-item-tree-widget"),wpd.sidebar.show("image-editing-sidebar"),wpd.appData.getUndoManager().updateUI();else if(t.startsWith("/"+wpd.gettext("image")+"/"))y("/"+wpd.gettext("image"));else if(t==="/"+wpd.gettext("datasets")){{w();let e=[],t=[];const s=wpd.appData.getPlotData(),o=wpd.appData.getFileManager(),r=o.getDatasetNameMap(),l=o.currentFileIndex();let a=s.getDatasets().filter(e=>r[e.name]===l);if(wpd.appData.isMultipage()){const d=wpd.appData.getPageManager(),p=d.currentPage(),g=d.getDatasetNameMap();for(var i of a.filter(e=>g[e.name]===p))e.push(s.getAxesForDataset(i)),t.push(i)}else for(var n of a)e.push(s.getAxesForDataset(n)),t.push(n);wpd.graphicsWidget.setRepainter(new wpd.MultipltDatasetRepainter(e,t))}P("dataset-group-tree-widget"),m=null}else if(t==="/"+wpd.gettext("axes"))w(),P("axes-group-tree-widget"),m=null;else if(t==="/"+wpd.gettext("measurements"))w(),P("measurement-group-tree-widget"),m=null;else if(t==="/"+wpd.gettext("measurements")+"/"+wpd.gettext("distance"))a||wpd.measurement.start(wpd.measurementModes.distance),P("distance-item-tree-widget"),f(wpd.measurementModes.distance);else if(t==="/"+wpd.gettext("measurements")+"/"+wpd.gettext("angle"))a||wpd.measurement.start(wpd.measurementModes.angle),P("angle-item-tree-widget"),m=null;else if(t==="/"+wpd.gettext("measurements")+"/"+wpd.gettext("area"))a||wpd.measurement.start(wpd.measurementModes.area),P("area-item-tree-widget"),f(wpd.measurementModes.area);else if(t.startsWith("/"+wpd.gettext("datasets")+"/"))x(0,t,a);else if(t.startsWith("/"+wpd.gettext("axes")+"/")){a=t;w(),P("axes-item-tree-widget"),a=a.replace("/"+wpd.gettext("axes")+"/","");const c=wpd.appData.getPlotData(),u=(a=c.getAxesNames().indexOf(a),m=c.getAxesColl()[a],document.getElementById("tweak-axes-calibration-button"));u.disabled=m instanceof wpd.ImageAxes,wpd.events.dispatch("wpd.axes.select",{axes:m})}else w(),P(null),m=null}function i(e,t,a){t.startsWith("/"+wpd.gettext("datasets")+"/")?wpd.dataSeriesManagement.showRenameDataset():t.startsWith("/"+wpd.gettext("axes")+"/")&&wpd.alignAxes.showRenameAxes()}function n(){t()}function y(e,t){D.selectPath(e,t)}return window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(t,a){a=a||window;for(let e=0;e<this.length;e++)t.call(a,this[e],e,this)}),{init:function(){var e=document.getElementById("tree-container");(D=new wpd.TreeWidget(e)).onItemSelection(a),D.onItemRename(i),t()},refresh:n,refreshPreservingSelection:function(e){var t;null!=D?(t=D.getSelectedPath(),n(),D.selectPath(t,!e)):n()},selectPath:y,addMeasurement:function(e){wpd.measurement.start(e),n();let t=!0;wpd.appData.isMultipage()&&(t=!1),e===wpd.measurementModes.distance?wpd.tree.selectPath("/"+wpd.gettext("measurements")+"/"+wpd.gettext("distance"),t):e===wpd.measurementModes.angle?wpd.tree.selectPath("/"+wpd.gettext("measurements")+"/"+wpd.gettext("angle"),t):e===wpd.measurementModes.area&&wpd.tree.selectPath("/"+wpd.gettext("measurements")+"/"+wpd.gettext("area"),t)},getActiveDataset:function(){return h},getActiveAxes:function(){return m}}}(),wpd||{}),wpd=(wpd.webcamCapture=function(){var a;function e(){return navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}function n(){null!=a&&a.stop(),wpd.popup.close("webcamCapture")}return{start:function(){var t;null==e()?wpd.messagePopup.show(wpd.gettext("webcam-capture"),wpd.gettext("webcam-capture-text")):(wpd.popup.show("webcamCapture"),t=document.getElementById("webcamVideo"),navigator.getUserMedia=e(),navigator.getUserMedia({video:!0},function(e){a=e,t.src=window.URL.createObjectURL(e)},function(){}))},cancel:function(){n()},capture:function(){var e,t=document.createElement("canvas"),a=document.getElementById("webcamVideo"),i=t.getContext("2d");t.width=a.videoWidth,t.height=a.videoHeight,i.drawImage(a,0,0),e=i.getImageData(0,0,t.width,t.height),n(),wpd.graphicsWidget.runImageOp(function(){return{imageData:e,width:t.width,height:t.height}})}}}(),wpd||{}),wpd=(wpd.zoomView=function(){var o,r,l,d,i,p,a=250,n=250,s="black";function e(){var e=document.getElementById("zoomCrossHair"),t=e.getContext("2d");e.width=e.width,t.strokeStyle="black"===s?"rgba(0,0,0,1)":"red"===s?"rgba(255,0,0,1)":"yellow"===s?"rgba(255,255,0,1)":"rgba(0,0,0,1)",t.beginPath(),t.moveTo(a/2,0),t.lineTo(a/2,n),t.moveTo(0,n/2),t.lineTo(a,n/2),t.stroke()}return{initZoom:function(){o=document.getElementById("zoomCanvas"),r=o.getContext("2d"),l=document.createElement("canvas"),d=l.getContext("2d"),i=document.getElementById("mousePosition"),p=5,e()},setZoomImage:function(e,t,a,i,n,s){l.width=i/p,l.height=n/p,d.putImageData(e,0,0),o.width=o.width,r.setTransform(s),r.drawImage(l,t,a,i,n)},setCoords:function(e,t){const a=wpd.tree.getActiveAxes();null!=a?i.innerHTML=a.pixelToLiveString(e,t):i.innerHTML=e.toFixed(2)+", "+t.toFixed(2)},setZoomRatio:function(e){p=e},getZoomRatio:function(){return p},getSize:function(){return{width:a,height:n}},showSettingsWindow:function(){document.getElementById("zoom-magnification-value").value=p,document.getElementById("zoom-crosshair-color-value").value=s,wpd.popup.show("zoom-settings-popup")},applySettings:function(){p=document.getElementById("zoom-magnification-value").value,s=document.getElementById("zoom-crosshair-color-value").value,e(),wpd.popup.close("zoom-settings-popup")}}}(),wpd||{}),wpd=(wpd.AxesCornersTool=function(e,t){var i=0,r=e,n=!0;t?(i=r.maxPointCount,n=!1):(n=!(i=0),wpd.graphicsWidget.resetData()),this.onMouseClick=function(e,t,a){n?(i+=1,r.addPoint(a.x,a.y,0,0),r.unselectAll(),r.selectPoint(i-1),wpd.graphicsWidget.forceHandlerRepaint(),i===r.maxPointCount&&(n=!1,wpd.alignAxes.calibrationCompleted())):(r.unselectAll(),r.selectNearestPoint(a.x,a.y),wpd.graphicsWidget.forceHandlerRepaint()),wpd.graphicsWidget.updateZoomOnEvent(e)},this.onKeyDown=function(a){if(0!==r.getSelectedPoints().length){var i=r.getPoint(r.getSelectedPoints()[0]),n=i.px,i=i.py,s=!0===a.shiftKey?5/wpd.graphicsWidget.getZoomRatio():.5/wpd.graphicsWidget.getZoomRatio(),o=wpd.graphicsWidget.getRotation();let{x:e,y:t}=wpd.graphicsWidget.getRotatedCoordinates(0,o,n,i);if(wpd.keyCodes.isUp(a.keyCode))t-=s;else if(wpd.keyCodes.isDown(a.keyCode))t+=s;else if(wpd.keyCodes.isLeft(a.keyCode))e-=s;else{if(!wpd.keyCodes.isRight(a.keyCode))return;e+=s}({x:e,y:t}=wpd.graphicsWidget.getRotatedCoordinates(o,0,e,t)),r.changePointPx(r.getSelectedPoints()[0],e,t),wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.updateZoomToImagePosn(e,t),a.preventDefault(),a.stopPropagation()}}},wpd.AlignmentCornersRepainter=function(e){var i=e;this.painterName="AlignmentCornersReptainer",this.onForcedRedraw=function(){wpd.graphicsWidget.resetData(),this.onRedraw()},this.onRedraw=function(){if(null!=i)for(var e,t,a=0;a<i.getCount();a++)e={x:(e=i.getPoint(a)).px,y:e.py},t=i.isPointSelected(a)?"rgba(0,200,0,1)":"rgba(200,0,0,1)",wpd.graphicsHelper.drawPoint(e,t,i.labels[a],i.labelPositions[a])}},wpd.CircularChartRecorderAlignmentRepainter=class{_calibration=null;painterName="CircularChartRecorderAlignmentRepainter";constructor(e){this._calibration=e}onForcedRedraw(){wpd.graphicsWidget.resetData(),this.onRedraw()}onRedraw(){if(null!=this._calibration){for(let t=0;t<this._calibration.getCount();t++){var a=this._calibration.getPoint(t),a={x:a.px,y:a.py};let e="rgba(200,0,0,1)";this._calibration.isPointSelected(t)&&(e="rgba(0,200,0,1)"),wpd.graphicsHelper.drawPoint(a,e,this._calibration.labels[t],this._calibration.labelPositions[t])}if(5==this._calibration.getCount()){let t=[];for(let e=0;e<5;e++)t.push(this._calibration.getPoint(e));var e=[[t[0].px,t[0].py],[t[1].px,t[1].py],[t[2].px,t[2].py]],i=[[t[2].px,t[2].py],[t[3].px,t[3].py],[t[4].px,t[4].py]],e=wpd.getCircleFrom3Pts(e),i=wpd.getCircleFrom3Pts(i);wpd.graphicsHelper.drawCircle(e,"rgba(0,200,0,0.5)"),wpd.graphicsHelper.drawCircle(i,"rgba(200,0,0,1)")}}}},wpd||{}),wpd=(wpd.ColorPickerTool=function(){var o=wpd.graphicsWidget.getAllContexts();this.onMouseClick=function(e,t,a){var a=o.oriImageCtx.getImageData(a.x,a.y,1,1),i=a.data[0],n=a.data[1],s=a.data[2];0===a.data[3]&&(s=n=i=255),this.onComplete([i,n,s])},this.onComplete=function(e){}},wpd.ColorFilterRepainter=function(){this.painterName="colorFilterRepainter",this.onRedraw=function(){var e=wpd.tree.getActiveDataset(),e=wpd.appData.getPlotData().getAutoDetectionDataForDataset(e);wpd.colorSelectionWidget.paintFilteredColor(e.binaryData,e.mask)}},wpd||{}),wpd=(wpd.graphicsHelper={drawPoint:function(e,t,a,i){var n,s=wpd.graphicsWidget.screenPx(e.x,e.y),o=wpd.graphicsWidget.getAllContexts(),r=wpd.graphicsWidget.getImageSize().height;if(null!=a)switch(o.dataCtx.font="15px sans-serif",n=o.dataCtx.measureText(a).width,o.dataCtx.fillStyle="rgba(255, 255, 255, 0.7)",o.oriDataCtx.font="15px sans-serif",o.oriDataCtx.fillStyle=t,i){case"N":case"n":o.dataCtx.fillRect(s.x-13,s.y-24,n+5,35),o.dataCtx.fillStyle=t,o.dataCtx.fillText(a,s.x-10,s.y-7),o.oriDataCtx.fillText(a,e.x-10,e.y-7);break;case"E":case"e":o.dataCtx.fillRect(s.x-7,s.y-16,n+17,26),o.dataCtx.fillStyle=t,o.dataCtx.fillText(a,s.x+7,s.y+5),o.oriDataCtx.fillText(a,e.x+7,e.y+5);break;case"W":case"w":o.dataCtx.fillRect(s.x-n-10,s.y-16,n+17,26),o.dataCtx.fillStyle=t,o.dataCtx.fillText(a,s.x-n-7,s.y+5),o.oriDataCtx.fillText(a,e.x-n-7,e.y+5);break;default:o.dataCtx.fillRect(s.x-13,s.y-8,n+5,35),o.dataCtx.fillStyle=t,o.dataCtx.fillText(a,s.x-10,s.y+18),o.oriDataCtx.fillText(a,e.x-10,e.y+18)}o.dataCtx.beginPath(),o.dataCtx.fillStyle=t,o.dataCtx.strokeStyle="rgb(255, 255, 255)",o.dataCtx.arc(s.x,s.y,4,0,2*Math.PI,!0),o.dataCtx.fill(),o.dataCtx.stroke(),o.oriDataCtx.beginPath(),o.oriDataCtx.fillStyle=t,o.oriDataCtx.strokeStyle="rgb(255, 255, 255)",o.oriDataCtx.arc(e.x,e.y,1500<r?4:2,0,2*Math.PI,!0),o.oriDataCtx.fill(),o.oriDataCtx.stroke()},drawCircle:function(e,t){var a=wpd.graphicsWidget.screenPx(e.x0,e.y0),i=wpd.graphicsWidget.screenLength(e.radius);let n=wpd.graphicsWidget.getAllContexts();n.dataCtx.beginPath(),n.dataCtx.strokeStyle=t,n.dataCtx.lineWidth=2,n.dataCtx.arc(a.x,a.y,i,0,2*Math.PI,!1),n.dataCtx.stroke(),n.oriDataCtx.beginPath(),n.oriDataCtx.strokeStyle=t,n.oriDataCtx.lineWidth=2,n.oriDataCtx.arc(e.x0,e.y0,e.radius,0,2*Math.PI,!1),n.oriDataCtx.stroke()}},wpd||{}),wpd=(wpd.GridColorFilterRepainter=function(){this.painterName="gridColorFilterRepainter",this.onRedraw=function(){var e=wpd.appData.getPlotData().getGridDetectionData();wpd.colorSelectionWidget.paintFilteredColor(e.binaryData,e.gridMask.pixels)}},wpd.GridBoxTool=function(){function i(){wpd.graphicsWidget.resetHover(),p.hoverCtx.strokeStyle="rgb(0,0,0)",p.hoverCtx.strokeRect(o.x,o.y,l.x-o.x,l.y-o.y)}function n(e,t,a){!1!==d&&(clearTimeout(r),d=!1,wpd.graphicsWidget.resetHover(),p.dataCtx.fillStyle="rgba(255,255,0,0.8)",p.dataCtx.fillRect(o.x,o.y,t.x-o.x,t.y-o.y),p.oriDataCtx.fillStyle="rgba(255,255,0,0.8)",p.oriDataCtx.fillRect(s.x,s.y,a.x-s.x,a.y-s.y))}var s,o,r,l,d=!1,p=wpd.graphicsWidget.getAllContexts(),g=null,c=null;this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.GridMaskPainter),document.getElementById("grid-mask-box").classList.add("pressed-button"),document.getElementById("grid-mask-view").classList.add("pressed-button")},this.onMouseDown=function(e,t,a){!0!==d&&(d=!0,s=a,o=t)},this.onMouseMove=function(e,t,a){!1!==d&&(l=t,clearTimeout(r),r=setTimeout(i,2))},this.onMouseOut=function(e,t,a){!0===d&&(clearTimeout(r),g=t,c=a)},this.onDocumentMouseUp=function(e,t,a){null!=g&&null!=c?n(0,g,c):n(0,t,a),c=g=null},this.onMouseUp=function(e,t,a){n(0,t,a)},this.onRemove=function(){document.getElementById("grid-mask-box").classList.remove("pressed-button"),document.getElementById("grid-mask-view").classList.remove("pressed-button"),wpd.gridDetection.grabMask()}},wpd.GridViewMaskTool=function(){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.GridMaskPainter),document.getElementById("grid-mask-view").classList.add("pressed-button")},this.onRemove=function(){document.getElementById("grid-mask-view").classList.remove("pressed-button"),wpd.gridDetection.grabMask()}},wpd.GridMaskPainter=function(){function e(){if(null!=n.gridMask.pixels&&0!==n.gridMask.pixels.size){var t,a=wpd.graphicsWidget.getImageSize();let e=i.oriDataCtx.getImageData(0,0,a.width,a.height);for(t of n.gridMask.pixels)e.data[4*t]=255,e.data[4*t+1]=255,e.data[4*t+2]=0,e.data[4*t+3]=200;i.oriDataCtx.putImageData(e,0,0),wpd.graphicsWidget.copyImageDataLayerToScreen()}}var i=wpd.graphicsWidget.getAllContexts(),n=wpd.appData.getPlotData().getGridDetectionData();this.painterName="gridMaskPainter",this.onRedraw=function(){wpd.gridDetection.grabMask(),e()},this.onAttach=function(){wpd.graphicsWidget.resetData(),e()}},wpd||{}),wpd=(wpd.CropTool=class{constructor(){this._isDrawing=!1,this._hasCropBox=!1,this._isResizing=!1,this._topImageCorner=null,this._topScreenCorner=null,this._moveTimer=null,this._screenPos=null,this._imagePos=null,this._hotspotCoords=null,this._resizingHotspot="",this._resizeStartCoords={x:0,y:0},this._ctx=wpd.graphicsWidget.getAllContexts()}onAttach(){document.getElementById("image-editing-crop").classList.add("pressed-button")}onRemove(){wpd.graphicsWidget.resetHover(),document.getElementById("image-editing-crop").classList.remove("pressed-button")}onMouseDown(e,t,a){var i;this._hasCropBox?null!=(i=this._getHotspot(t))&&(this._isResizing=!0,this._resizeStartCoords={x:t.x,y:t.y},this._resizingHotspot=i):(this._screenPos=t,this._imagePos=a,this._isDrawing=!0,this._topImageCorner=a,this._topScreenCorner=t)}onMouseMove(t,e,a){if(this._isDrawing)this._screenPos=e,this._imagePos=a,clearTimeout(this._moveTimer),this._moveTimer=setTimeout(()=>{this._drawCropBox()},2);else if(this._hasCropBox){var a=this._isResizing?this._resizingHotspot:this._getHotspot(e);if(null!=a){let e="crosshair";"n"===a||"s"===a?e="ns-resize":"e"==a||"w"==a?e="ew-resize":"nw"==a||"se"==a?e="nwse-resize":"ne"==a||"sw"==a?e="nesw-resize":"c"==a&&(e="move"),t.target.style.cursor=e}else t.target.style.cursor="crosshair";this._isResizing&&(a={x:e.x-this._resizeStartCoords.x,y:e.y-this._resizeStartCoords.y},"n"==this._resizingHotspot?this._topScreenCorner.y+=a.y:"s"==this._resizingHotspot?this._screenPos.y+=a.y:"w"==this._resizingHotspot?this._topScreenCorner.x+=a.x:"e"==this._resizingHotspot?this._screenPos.x+=a.x:"nw"==this._resizingHotspot?(this._topScreenCorner.y+=a.y,this._topScreenCorner.x+=a.x):"ne"==this._resizingHotspot?(this._topScreenCorner.y+=a.y,this._screenPos.x+=a.x):"sw"==this._resizingHotspot?(this._screenPos.y+=a.y,this._topScreenCorner.x+=a.x):"se"==this._resizingHotspot?(this._screenPos.y+=a.y,this._screenPos.x+=a.x):"c"==this._resizingHotspot&&(this._topScreenCorner.x+=a.x,this._topScreenCorner.y+=a.y,this._screenPos.x+=a.x,this._screenPos.y+=a.y),clearTimeout(this._moveTimer),this._moveTimer=setTimeout(()=>{this._drawCropBox()},2),this._resizeStartCoords={x:e.x,y:e.y})}}_drawCropBox(){wpd.graphicsWidget.resetHover();let e=this._ctx.hoverCtx;e.strokeStyle="rgb(0,0,0)",e.strokeRect(this._topScreenCorner.x,this._topScreenCorner.y,this._screenPos.x-this._topScreenCorner.x,this._screenPos.y-this._topScreenCorner.y),this._hotspotCoords=this._getHotspotCoords(),e.fillStyle="rgb(255,0,0)",e.strokeStyle="rgb(255,255,255)";for(var t of this._hotspotCoords)e.beginPath(),e.arc(t.x,t.y,4,0,2*Math.PI,!0),e.fill(),e.stroke()}onMouseUp(e,t,a){this._finalizeDrawing()}_finalizeDrawing(){clearTimeout(this._moveTimer),(this._isDrawing||this._isResizing)&&(this._isDrawing=!1,this._isResizing=!1,this._hasCropBox=!0,this._drawCropBox())}_getHotspotCoords(){return[{x:this._topScreenCorner.x,y:this._topScreenCorner.y},{x:this._screenPos.x,y:this._topScreenCorner.y},{x:this._screenPos.x,y:this._screenPos.y},{x:this._topScreenCorner.x,y:this._screenPos.y},{x:(this._topScreenCorner.x+this._screenPos.x)/2,y:this._topScreenCorner.y},{x:this._screenPos.x,y:(this._topScreenCorner.y+this._screenPos.y)/2},{x:(this._topScreenCorner.x+this._screenPos.x)/2,y:this._screenPos.y},{x:this._topScreenCorner.x,y:(this._topScreenCorner.y+this._screenPos.y)/2},{x:(this._topScreenCorner.x+this._screenPos.x)/2,y:(this._topScreenCorner.y+this._screenPos.y)/2}]}_getHotspot(t){var a=["nw","ne","se","sw","n","e","s","w","c"],i=this._hotspotCoords;for(let e=0;e<i.length;e++){var n=i[e];if((n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y)<64)return a[e]}return null}onMouseOut(){this._finalizeDrawing()}onDocumentMouseUp(){this._finalizeDrawing()}onKeyDown(e){var t=wpd.keyCodes.isEsc(e.keyCode),a=wpd.keyCodes.isEnter(e.keyCode);if((t||a)&&(this._isDrawing=!1,wpd.graphicsWidget.resetHover()),t&&(this._hasCropBox=!1),a&&this._hasCropBox){let e=new wpd.CropImageAction(this._topImageCorner.x,this._topImageCorner.y,this._imagePos.x,this._imagePos.y);wpd.appData.getUndoManager().insertAction(e),e.execute()}e.preventDefault()}onRedraw(){this._hasCropBox&&(this._topScreenCorner=wpd.graphicsWidget.screenPx(this._topImageCorner.x,this._topImageCorner.y),this._screenPos=wpd.graphicsWidget.screenPx(this._imagePos.x,this._imagePos.y),this._drawCropBox())}},wpd||{}),wpd=(wpd.imageOps=function(){function e(e,t,a){for(var i,n,s,o,r,l=0;l<a;l++)for(i=0;i<t/2;i++)for(n=4*(l*t+i),s=4*((l+1)*t-(i+1)),r=0;r<4;r++)o=e.data[n+r],e.data[n+r]=e.data[s+r],e.data[s+r]=o;return{imageData:e,width:t,height:a}}function t(e,t,a){for(var i,n,s,o,r,l=0;l<a/2;l++)for(i=0;i<t;i++)for(n=4*(l*t+i),s=4*((a-(l+2))*t+i),r=0;r<4;r++)o=e.data[n+r],e.data[n+r]=e.data[s+r],e.data[s+r]=o;return{imageData:e,width:t,height:a}}return{hflip:function(){wpd.graphicsWidget.runImageOp(e)},vflip:function(){wpd.graphicsWidget.runImageOp(t)}}}(),wpd||{}),wpd=(wpd.keyCodes={isUp:function(e){return 38===e},isDown:function(e){return 40===e},isLeft:function(e){return 37===e},isRight:function(e){return 39===e},isTab:function(e){return 9===e},isDel:function(e){return 46===e},isBackspace:function(e){return 8===e},isAlphabet:function(e,t){return!(90<e||e<65)&&String.fromCharCode(e).toLowerCase()===t},isPeriod:function(e){return 190===e},isComma:function(e){return 188===e},isEnter:function(e){return 13===e},isEsc:function(e){return 27===e}},wpd||{}),wpd=(wpd.ManualSelectionTool=function(p,g){this.onAttach=function(){document.getElementById("manual-select-button").classList.add("pressed-button"),wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter(p,g)),g.hasPointGroups()&&(wpd.pointGroups.showControls(),wpd.pointGroups.refreshControls())},this.onMouseClick=function(e,t,a){const i=[a.x,a.y];var n=g.hasPointGroups(),s=wpd.pointGroups.getCurrentTupleIndex(),o=wpd.pointGroups.getCurrentGroupIndex();let r=null;if(p.dataPointsHaveLabels&&(!n||0===o)){const d=g.getMetadataKeys();var l="label";null!=d&&d.length?d.indexOf(l)<0&&g.setMetadataKeys([l,...d]):g.setMetadataKeys([l]);let e=g.getCount();n&&(e=null===s?g.getTupleCount():s),r=p.dataPointsLabelPrefix+e,i.push({label:r})}l=g.addPixel(...i);wpd.graphicsHelper.drawPoint(a,g.colorRGB.toRGBString(),r),n&&(null===s&&0===o?(a=g.addTuple(l),wpd.pointGroups.setCurrentTupleIndex(a)):g.addToTupleAt(s,o,l),wpd.pointGroups.nextGroup()),wpd.graphicsWidget.updateZoomOnEvent(e),wpd.dataPointCounter.setCount(g.getCount()),p.dataPointsHaveLabels&&e.shiftKey&&wpd.dataPointLabelEditor.show(g,g.getCount()-1,this),wpd.events.dispatch("wpd.dataset.point.add",{axes:p,dataset:g,index:l})},this.onRemove=function(){document.getElementById("manual-select-button").classList.remove("pressed-button"),g.hasPointGroups()&&wpd.pointGroups.hideControls()},this.onKeyDown=function(e){var t=g.getCount()-1,a=g.getPixel(t),i=.5/wpd.graphicsWidget.getZoomRatio(),n=wpd.graphicsWidget.getRotation();let{x:s,y:o}=wpd.graphicsWidget.getRotatedCoordinates(0,n,a.x,a.y);if(wpd.keyCodes.isUp(e.keyCode))o-=i;else if(wpd.keyCodes.isDown(e.keyCode))o+=i;else if(wpd.keyCodes.isLeft(e.keyCode))s-=i;else{if(!wpd.keyCodes.isRight(e.keyCode))return wpd.keyCodes.isComma(e.keyCode)?void wpd.pointGroups.previousGroup():wpd.keyCodes.isPeriod(e.keyCode)?void wpd.pointGroups.nextGroup():wpd.acquireData.isToolSwitchKey(e.keyCode)?void wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(e.keyCode).toLowerCase()):void 0;s+=i}({x:s,y:o}=wpd.graphicsWidget.getRotatedCoordinates(n,0,s,o)),g.setPixelAt(t,s,o),wpd.graphicsWidget.resetData(),wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.updateZoomToImagePosn(a.x,a.y),e.preventDefault()}},wpd.DeleteDataPointTool=function(o,r){wpd.graphicsWidget.getAllContexts();this.onAttach=function(){document.getElementById("delete-point-button").classList.add("pressed-button"),wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter(o,r))},this.onMouseClick=function(t,e,a){var i,n=e=>{var e=r.removeNearestPixel(e.x,e.y),t=r.getTupleIndex(e);-1<t&&(r.removeFromTupleAt(t,e),r.refreshTuplesAfterPixelRemoval(e),r.isTupleEmpty(t)&&r.removeTuple(t),wpd.pointGroups.previousGroup()),s([e])};const s=e=>{wpd.graphicsWidget.resetData(),wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.updateZoomOnEvent(t),wpd.dataPointCounter.setCount(r.getCount()),e.forEach(e=>{wpd.events.dispatch("wpd.dataset.point.delete",{axes:o,dataset:r,index:e})})};r.hasPointGroups()?-1<(i=r.findNearestPixel(a.x,a.y))&&wpd.pointGroups.showDeleteTuplePopup(((e,t)=>{let a=[];t=r.getTupleIndex(t);if(-1<t){const a=r.getTuple(t),i=[...a].filter(e=>null!==e).sort((e,t)=>t-e);i.forEach(e=>{r.removePixelAtIndex(e),r.refreshTuplesAfterPixelRemoval(e)}),r.removeTuple(t),wpd.pointGroups.previousGroup()}else a=[r.removeNearestPixel(e.x,e.y)];s(a)}).bind(this,a,i),n.bind(this,a)):n(a)},this.onKeyDown=function(e){wpd.acquireData.isToolSwitchKey(e.keyCode)&&wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(e.keyCode).toLowerCase())},this.onRemove=function(){document.getElementById("delete-point-button").classList.remove("pressed-button")}},wpd.MultipltDatasetRepainter=class{constructor(e,t){this.painterName="multipleDatasetsRepainter",this._datasetList=t,this._axesList=e,this._datasetRepainters=[];for(var[a,i]of t.entries()){a=e[a];this._datasetRepainters.push(new wpd.DataPointsRepainter(a,i))}}drawPoints(){for(var e of this._datasetRepainters)e.drawPoints()}onAttach(){wpd.graphicsWidget.resetData(),this.drawPoints()}onRedraw(){this.drawPoints()}onForcedRedraw(){wpd.graphicsWidget.resetData(),this.drawPoints()}},wpd.DataPointsRepainter=class{constructor(e,t){this._axes=e,this._dataset=t,this.painterName="dataPointsRepainter"}drawPoints(){var e=this._dataset.getMetadataKeys();let a=!1;if(null!=this._axes){this._axes.dataPointsHaveLabels&&null!=e&&"label"===e[0]&&(a=!0);for(let t=0;t<this._dataset.getCount();t++){var i,n=this._dataset.getPixel(t),s=0<=this._dataset.getSelectedPixels().indexOf(t)?"rgb(0,200,0)":this._dataset.colorRGB.toRGBString();if(a){let e=null;this._dataset.hasPointGroups()?(i=this._dataset.getTupleIndex(t),this._dataset.getPointGroupIndexInTuple(i,t)<=0&&(void 0!==n.metadata&&(e=n.metadata.label),i=-1<i?i:t,null==e&&(e=this._axes.dataPointsLabelPrefix+i))):null==(e=n.metadata.label)&&(e=this._axes.dataPointsLabelPrefix+t),wpd.graphicsHelper.drawPoint(n,s,e)}else wpd.graphicsHelper.drawPoint(n,s)}}}onAttach(){wpd.graphicsWidget.resetData(),this.drawPoints()}onRedraw(){this.drawPoints()}onForcedRedraw(){wpd.graphicsWidget.resetData(),this.drawPoints()}},wpd.AdjustDataPointTool=function(g,c){const e=document.getElementById("manual-adjust-button"),t=document.getElementById("value-overrides-controls"),i=document.getElementById("override-data-values");let n=!1,s=!1,o=null,r=null,l=null,d=null,p=null;this.onAttach=function(){e.classList.add("pressed-button"),i.classList.remove("pressed-button"),wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter(g,c)),wpd.toolbar.show("adjustDataPointsToolbar")},this.onRemove=function(){c.unselectAll(),wpd.graphicsWidget.forceHandlerRepaint(),e.classList.remove("pressed-button"),wpd.toolbar.clear(),t.hidden=!0},this.onMouseDown=function(e,t,a){n=!0,r=t,d=a,c.unselectAll()},this.onMouseUp=function(e,t){!0===s?(wpd.graphicsWidget.resetHover(),c.selectPixelsInRectangle(d,p),this._onSelect(e,c.getSelectedPixels()),clearTimeout(o),setTimeout(function(){s=!1,n=!1,r=null,l=null,wpd.graphicsWidget.resetHover()})):(n=!1,r=null,l=null,wpd.graphicsWidget.resetHover())},this.onMouseMove=function(e,t,a){!0===n&&(s=!0,l=t,p=a,clearTimeout(o),o=setTimeout(function(){this._drawSelectionBox()}.bind(this),1))},this._drawSelectionBox=function(){wpd.graphicsWidget.resetHover();const e=wpd.graphicsWidget.getAllContexts().hoverCtx;null!=r&&null!=l&&(e.strokeStyle="rgb(0,0,0)",e.strokeRect(r.x,r.y,l.x-r.x,l.y-r.y))},this._onSelect=function(e,t){wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.updateZoomOnEvent(e),this.toggleOverrideSection(t),wpd.events.dispatch("wpd.dataset.point.select",{axes:g,dataset:c,indexes:t})},this.onMouseClick=function(e,t,a){!1===s&&(c.unselectAll(),a=c.selectNearestPixel(a.x,a.y),this._onSelect(e,[a]))},this.onKeyDown=function(d){if(wpd.acquireData.isToolSwitchKey(d.keyCode))wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(d.keyCode).toLowerCase());else{const p=c.getSelectedPixels();if(!(p.length<1))if(wpd.keyCodes.isAlphabet(d.keyCode,"r"))wpd.dataPointValueOverrideEditor.show(c,g,p,this);else{let l={x:null,y:null};p.forEach(function(e){var t=!0===d.shiftKey?5/wpd.graphicsWidget.getZoomRatio():.5/wpd.graphicsWidget.getZoomRatio();let a=c.getPixel(e),i=a.x,n=a.y;var s=wpd.graphicsWidget.getRotation();let{x:o,y:r}=wpd.graphicsWidget.getRotatedCoordinates(0,s,i,n);if(wpd.keyCodes.isUp(d.keyCode))r-=t;else if(wpd.keyCodes.isDown(d.keyCode))r+=t;else if(wpd.keyCodes.isLeft(d.keyCode))o-=t;else if(wpd.keyCodes.isRight(d.keyCode))o+=t;else{if(1!==p.length)return;if(wpd.keyCodes.isAlphabet(d.keyCode,"q"))c.selectPreviousPixel(),e=c.getSelectedPixels()[0],a=c.getPixel(e),i=a.x,n=a.y,{x:o,y:r}=wpd.graphicsWidget.getRotatedCoordinates(0,s,i,n);else if(wpd.keyCodes.isAlphabet(d.keyCode,"w"))c.selectNextPixel(),e=c.getSelectedPixels()[0],a=c.getPixel(e),i=a.x,n=a.y,{x:o,y:r}=wpd.graphicsWidget.getRotatedCoordinates(0,s,i,n);else{if(!wpd.keyCodes.isAlphabet(d.keyCode,"e"))return wpd.keyCodes.isDel(d.keyCode)||wpd.keyCodes.isBackspace(d.keyCode)?(c.removePixelAtIndex(e),c.unselectAll(),0<=c.findNearestPixel(i,n)&&(c.selectNearestPixel(i,n),e=c.getSelectedPixels()[0],a=c.getPixel(e),i=a.x,n=a.y,{x:o,y:r}=wpd.graphicsWidget.getRotatedCoordinates(0,s,i,n)),wpd.graphicsWidget.resetData(),wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.updateZoomToImagePosn(i,n),wpd.dataPointCounter.setCount(c.getCount()),d.preventDefault(),void d.stopPropagation()):void 0;if(g.dataPointsHaveLabels)return e=c.getSelectedPixels()[0],d.preventDefault(),d.stopPropagation(),void wpd.dataPointLabelEditor.show(c,e,this)}}({x:o,y:r}=wpd.graphicsWidget.getRotatedCoordinates(s,0,o,r)),c.setPixelAt(e,o,r),l={x:o,y:r}}.bind(this)),wpd.graphicsWidget.forceHandlerRepaint(),null!=l.x&&wpd.graphicsWidget.updateZoomToImagePosn(l.x,l.y),d.preventDefault(),d.stopPropagation()}}},this.toggleOverrideSection=function(e){const a=document.getElementById("overridden-data-indicator");a.hidden=!0,1===e.length&&0<=e[0]||1<e.length?(t.hidden=!1,i.onclick=wpd.dataPointValueOverrideEditor.show.bind(null,c,g,e,this),c.getSelectedPixels().some(e=>{const t=c.getPixel(e);if(t.metadata){let e=1;if(t.metadata.hasOwnProperty("label")&&(e+=1),Object.keys(t.metadata).length>=e)return!(a.hidden=!1)}return!1})):(t.hidden=!0,i.onclick=null)},this.displayMask=function(){e.classList.add("pressed-button"),wpd.toolbar.show("adjustDataPointsToolbar"),t.hidden=!1,i.classList.add("pressed-button")}},wpd.EditLabelsTool=function(e,n){this.onAttach=function(){document.getElementById("edit-data-labels").classList.add("pressed-button"),wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter(e,n))},this.onRemove=function(){document.getElementById("edit-data-labels").classList.remove("pressed-button"),n.unselectAll()},this.onMouseClick=function(e,t,a){var i=n;i.unselectAll(),0<=(a=i.selectNearestPixel(a.x,a.y))&&(!i.hasPointGroups()||i.getPointGroupIndexInTuple(i.getTupleIndex(a),a)<=0)&&(wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.updateZoomOnEvent(e),wpd.dataPointLabelEditor.show(i,a,this))},this.onKeyDown=function(e){wpd.acquireData.isToolSwitchKey(e.keyCode)&&wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(e.keyCode).toLowerCase())}},wpd.dataPointCounter={setCount:function(t){let a=document.getElementsByClassName("data-point-counter");for(let e=0;e<a.length;e++)a[e].innerHTML=t}},wpd||{}),wpd=(wpd.BoxMaskTool=function(){function i(){wpd.graphicsWidget.resetHover(),p.hoverCtx.strokeStyle="rgb(0,0,0)",p.hoverCtx.strokeRect(o.x,o.y,l.x-o.x,l.y-o.y)}function n(e,t,a){!1!==d&&(clearTimeout(r),d=!1,wpd.graphicsWidget.resetHover(),p.dataCtx.fillStyle="rgba(255,255,0,1)",p.dataCtx.fillRect(o.x,o.y,t.x-o.x,t.y-o.y),p.oriDataCtx.fillStyle="rgba(255,255,0,1)",p.oriDataCtx.fillRect(s.x,s.y,a.x-s.x,a.y-s.y))}var s,o,r,l,d=!1,p=wpd.graphicsWidget.getAllContexts(),g=null,c=null;this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter),document.getElementById("box-mask").classList.add("pressed-button"),document.getElementById("view-mask").classList.add("pressed-button")},this.onMouseDown=function(e,t,a){!0!==d&&(d=!0,s=a,o=t)},this.onMouseMove=function(e,t,a){!1!==d&&(l=t,clearTimeout(r),r=setTimeout(i,2))},this.onMouseOut=function(e,t,a){!0===d&&(clearTimeout(r),g=t,c=a)},this.onDocumentMouseUp=function(e,t,a){null!=g&&null!=c?n(0,g,c):n(0,t,a),c=g=null},this.onMouseUp=function(e,t,a){n(0,t,a)},this.onRemove=function(){document.getElementById("box-mask").classList.remove("pressed-button"),document.getElementById("view-mask").classList.remove("pressed-button"),wpd.dataMask.grabMask()}},wpd.PenMaskTool=function(){function i(){r.dataCtx.strokeStyle="rgba(255,255,0,1)",r.dataCtx.lineTo(s.x,s.y),r.dataCtx.stroke(),r.oriDataCtx.strokeStyle="rgba(255,255,0,1)",r.oriDataCtx.lineTo(o.x,o.y),r.oriDataCtx.stroke()}var n,s,o,r=wpd.graphicsWidget.getAllContexts(),l=!1;this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter),document.getElementById("pen-mask").classList.add("pressed-button"),document.getElementById("view-mask").classList.add("pressed-button"),document.getElementById("mask-paint-container").style.display="block"},this.onMouseDown=function(e,t,a){var i;!0!==l&&(i=parseInt(document.getElementById("paintThickness").value,10),l=!0,r.dataCtx.strokeStyle="rgba(255,255,0,1)",r.dataCtx.lineWidth=i*wpd.graphicsWidget.getZoomRatio(),r.dataCtx.beginPath(),r.dataCtx.moveTo(t.x,t.y),r.oriDataCtx.strokeStyle="rgba(255,255,0,1)",r.oriDataCtx.lineWidth=i,r.oriDataCtx.beginPath(),r.oriDataCtx.moveTo(a.x,a.y))},this.onMouseMove=function(e,t,a){!1!==l&&(s=t,o=a,clearTimeout(n),n=setTimeout(i,2))},this.onMouseUp=function(e,t,a){clearTimeout(n),r.dataCtx.closePath(),r.dataCtx.lineWidth=1,r.oriDataCtx.closePath(),r.oriDataCtx.lineWidth=1,l=!1},this.onMouseOut=function(e,t,a){this.onMouseUp(e,t,a)},this.onRemove=function(){document.getElementById("pen-mask").classList.remove("pressed-button"),document.getElementById("view-mask").classList.remove("pressed-button"),document.getElementById("mask-paint-container").style.display="none",wpd.dataMask.grabMask(),wpd.toolbar.clear()}},wpd.EraseMaskTool=function(){function i(){r.dataCtx.globalCompositeOperation="destination-out",r.oriDataCtx.globalCompositeOperation="destination-out",r.dataCtx.strokeStyle="rgba(255,255,0,1)",r.dataCtx.lineTo(s.x,s.y),r.dataCtx.stroke(),r.oriDataCtx.strokeStyle="rgba(255,255,0,1)",r.oriDataCtx.lineTo(o.x,o.y),r.oriDataCtx.stroke()}var n,s,o,r=wpd.graphicsWidget.getAllContexts(),l=!1;this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter),document.getElementById("erase-mask").classList.add("pressed-button"),document.getElementById("view-mask").classList.add("pressed-button"),document.getElementById("mask-erase-container").style.display="block"},this.onMouseDown=function(e,t,a){var i;!0!==l&&(i=parseInt(document.getElementById("eraseThickness").value,10),l=!0,r.dataCtx.globalCompositeOperation="destination-out",r.oriDataCtx.globalCompositeOperation="destination-out",r.dataCtx.strokeStyle="rgba(0,0,0,1)",r.dataCtx.lineWidth=i*wpd.graphicsWidget.getZoomRatio(),r.dataCtx.beginPath(),r.dataCtx.moveTo(t.x,t.y),r.oriDataCtx.strokeStyle="rgba(0,0,0,1)",r.oriDataCtx.lineWidth=i,r.oriDataCtx.beginPath(),r.oriDataCtx.moveTo(a.x,a.y))},this.onMouseMove=function(e,t,a){!1!==l&&(s=t,o=a,clearTimeout(n),n=setTimeout(i,2))},this.onMouseOut=function(e,t,a){this.onMouseUp(e,t,a)},this.onMouseUp=function(e,t,a){clearTimeout(n),r.dataCtx.closePath(),r.dataCtx.lineWidth=1,r.oriDataCtx.closePath(),r.oriDataCtx.lineWidth=1,r.dataCtx.globalCompositeOperation="source-over",r.oriDataCtx.globalCompositeOperation="source-over",l=!1},this.onRemove=function(){document.getElementById("erase-mask").classList.remove("pressed-button"),document.getElementById("view-mask").classList.remove("pressed-button"),document.getElementById("mask-erase-container").style.display="none",wpd.dataMask.grabMask(),wpd.toolbar.clear()}},wpd.ViewMaskTool=function(){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter),document.getElementById("view-mask").classList.add("pressed-button")},this.onRemove=function(){document.getElementById("view-mask").classList.remove("pressed-button"),wpd.dataMask.grabMask()}},wpd.MaskPainter=function(){let i=wpd.graphicsWidget.getAllContexts();var e=wpd.tree.getActiveDataset();function t(){if(null!=n.mask&&0!==n.mask.size){var t,a=wpd.graphicsWidget.getImageSize();let e=i.oriDataCtx.getImageData(0,0,a.width,a.height);for(t of n.mask)e.data[4*t]=255,e.data[4*t+1]=255,e.data[4*t+2]=0,e.data[4*t+3]=255;i.oriDataCtx.putImageData(e,0,0),wpd.graphicsWidget.copyImageDataLayerToScreen()}}let n=wpd.appData.getPlotData().getAutoDetectionDataForDataset(e);this.painterName="dataMaskPainter",this.onRedraw=function(){wpd.dataMask.grabMask(),t()},this.onAttach=function(){t()}},wpd||{}),wpd=(wpd.AddMeasurementTool=function(o){var r=wpd.graphicsWidget.getAllContexts(),l=0,d=!0,p=[];this.onAttach=function(){document.getElementById(o.addButtonId).classList.add("pressed-button"),o.connectivity<0&&(document.getElementById("add-polygon-info").style.display="block")},this.onRemove=function(){document.getElementById(o.addButtonId).classList.remove("pressed-button"),o.connectivity<0&&(document.getElementById("add-polygon-info").style.display="none")},this.onKeyDown=function(e){wpd.keyCodes.isAlphabet(e.keyCode,"a")?(wpd.graphicsWidget.resetHover(),wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(o))):wpd.keyCodes.isAlphabet(e.keyCode,"d")?(wpd.graphicsWidget.resetHover(),wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool(o))):(wpd.keyCodes.isEnter(e.keyCode)||wpd.keyCodes.isEsc(e.keyCode))&&!0===d&&o.connectivity<0&&(d=!1,o.getData().addConnection(p),wpd.graphicsWidget.resetHover(),wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.setTool(new wpd.AdjustMeasurementTool(o)))},this.onMouseClick=function(e,t,a){if(d){wpd.graphicsWidget.resetHover(),p[2*l]=a.x,p[2*l+1]=a.y,l+=1;var i,{x:n,y:s}=wpd.graphicsWidget.screenPx(a.x,a.y);if(l===o.connectivity)return d=!1,o.getData().addConnection(p),wpd.graphicsWidget.resetHover(),wpd.graphicsWidget.forceHandlerRepaint(),void wpd.graphicsWidget.setTool(new wpd.AdjustMeasurementTool(o));1<l&&(i=wpd.graphicsWidget.screenPx(p[2*(l-2)],p[2*(l-2)+1]),r.dataCtx.beginPath(),r.dataCtx.strokeStyle="rgb(0,0,10)",r.dataCtx.moveTo(i.x,i.y),r.dataCtx.lineTo(n,s),r.dataCtx.stroke(),r.oriDataCtx.beginPath(),r.oriDataCtx.strokeStyle="rgb(0,0,10)",r.oriDataCtx.moveTo(p[2*(l-2)],p[2*(l-2)+1]),r.oriDataCtx.lineTo(a.x,a.y),r.oriDataCtx.stroke()),r.dataCtx.beginPath(),r.dataCtx.fillStyle="rgb(200, 0, 0)",r.dataCtx.arc(n,s,3,0,2*Math.PI,!0),r.dataCtx.fill(),r.oriDataCtx.beginPath(),r.oriDataCtx.fillStyle="rgb(200,0,0)",r.oriDataCtx.arc(a.x,a.y,3,0,2*Math.PI,!0),r.oriDataCtx.fill()}wpd.graphicsWidget.updateZoomOnEvent(e)},this.onMouseMove=function(e,t,a){var i,n;d&&1<=l&&(wpd.graphicsWidget.resetHover(),n=wpd.graphicsWidget.getRotation(),{x:n,y:i}=wpd.graphicsWidget.getRotatedCoordinates(0,n,p[2*(l-1)],p[2*(l-1)+1]),n=wpd.graphicsWidget.screenPx(n,i),r.hoverCtx.beginPath(),r.hoverCtx.strokeStyle="rgb(0,0,0)",r.hoverCtx.moveTo(n.x,n.y),r.hoverCtx.lineTo(t.x,t.y),r.hoverCtx.stroke())}},wpd.DeleteMeasurementTool=function(i){wpd.graphicsWidget.getAllContexts();this.onAttach=function(){document.getElementById(i.deleteButtonId).classList.add("pressed-button")},this.onRemove=function(){document.getElementById(i.deleteButtonId).classList.remove("pressed-button")},this.onKeyDown=function(e){wpd.keyCodes.isAlphabet(e.keyCode,"a")?wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(i)):wpd.keyCodes.isAlphabet(e.keyCode,"d")&&wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool(i))},this.onMouseClick=function(e,t,a){i.getData().deleteNearestConnection(a.x,a.y),wpd.graphicsWidget.setTool(new wpd.AdjustMeasurementTool(i)),wpd.graphicsWidget.resetData(),wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.updateZoomOnEvent(e)}},wpd.AdjustMeasurementTool=function(l){this.onAttach=function(){},this.onMouseClick=function(e,t,a){l.getData().selectNearestPoint(a.x,a.y),wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.updateZoomOnEvent(e)},this.onKeyDown=function(a){if(wpd.keyCodes.isAlphabet(a.keyCode,"a"))wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(l));else if(wpd.keyCodes.isAlphabet(a.keyCode,"d"))wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool(l));else{var i=l.getData(),n=i.getSelectedConnectionAndPoint();if(0<=n.connectionIndex&&0<=n.pointIndex){var s=!0===a.shiftKey?5/wpd.graphicsWidget.getZoomRatio():.5/wpd.graphicsWidget.getZoomRatio(),o=i.getPointAt(n.connectionIndex,n.pointIndex),r=wpd.graphicsWidget.getRotation();let{x:e,y:t}=wpd.graphicsWidget.getRotatedCoordinates(0,r,o.x,o.y);if(wpd.keyCodes.isUp(a.keyCode))t-=s;else if(wpd.keyCodes.isDown(a.keyCode))t+=s;else if(wpd.keyCodes.isLeft(a.keyCode))e-=s;else{if(!wpd.keyCodes.isRight(a.keyCode))return;e+=s}({x:e,y:t}=wpd.graphicsWidget.getRotatedCoordinates(r,0,e,t)),i.setPointAt(n.connectionIndex,n.pointIndex,e,t),wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.updateZoomToImagePosn(e,t),a.preventDefault(),a.stopPropagation()}}}},wpd.MeasurementRepainter=function(j){var l=wpd.graphicsWidget.getAllContexts(),V=function(e,t,a,i,n,s,o,r){l.dataCtx.beginPath(),l.dataCtx.strokeStyle="rgb(0,0,10)",l.dataCtx.moveTo(e,t),l.dataCtx.lineTo(a,i),l.dataCtx.stroke(),l.oriDataCtx.beginPath(),l.oriDataCtx.strokeStyle="rgb(0,0,10)",l.oriDataCtx.moveTo(n,s),l.oriDataCtx.lineTo(o,r),l.oriDataCtx.stroke()},Y=function(e,t,a,i,n){l.dataCtx.beginPath(),l.dataCtx.fillStyle=n?"rgb(0, 200, 0)":"rgb(200, 0, 0)",l.dataCtx.arc(e,t,3,0,2*Math.PI,!0),l.dataCtx.fill(),l.oriDataCtx.beginPath(),l.oriDataCtx.fillStyle=n?"rgb(0,200,0)":"rgb(200,0,0)",l.oriDataCtx.arc(a,i,3,0,2*Math.PI,!0),l.oriDataCtx.fill()},$=function(e,t,a,i,n,s){l.dataCtx.beginPath(),l.dataCtx.strokeStyle="rgb(0,0,10)",l.dataCtx.arc(e,t,15,n,s,!0),l.dataCtx.stroke(),l.oriDataCtx.beginPath(),l.oriDataCtx.strokeStyle="rgb(0,0,10)",l.oriDataCtx.arc(a,i,15,n,s,!0),l.oriDataCtx.stroke()},q=function(e,t,a,i,n){var s;e=parseInt(e,10),t=parseInt(t,10),a=parseInt(a,10),i=parseInt(i,10),l.dataCtx.font="14px sans-serif",s=l.dataCtx.measureText(n).width,l.dataCtx.fillStyle="rgba(255, 255, 255, 0.7)",l.dataCtx.fillRect(e-5,t-15,s+10,25),l.dataCtx.fillStyle="rgb(200, 0, 0)",l.dataCtx.fillText(n,e,t),l.oriDataCtx.font="14px sans-serif",s=l.oriDataCtx.measureText(n).width,l.oriDataCtx.fillStyle="rgba(255, 255, 255, 0.7)",l.oriDataCtx.fillRect(a-5,i-15,s+10,25),l.oriDataCtx.fillStyle="rgb(200, 0, 0)",l.oriDataCtx.fillText(n,a,i)};this.painterName="measurementRepainter-"+j.name,this.onAttach=function(){},this.onRedraw=function(){if(j.name===wpd.measurementModes.distance.name)for(var e,t,a,i,n,s,o,r,l,d=j.getData(),F=d.connectionCount(),p=j.getAxes(),g=0;g<F;g++)e=(i=d.getConnectionAt(g))[0],t=i[1],a=i[2],i=i[3],r=d.isPointSelected(g,0),l=d.isPointSelected(g,1),o=!0===wpd.appData.isAligned()&&p instanceof wpd.MapAxes?"Dist"+g.toString()+": "+p.pixelToDataDistance(d.getDistance(g)).toFixed(2)+" "+p.getUnits():"Dist"+g.toString()+": "+d.getDistance(g).toFixed(2)+" px",n=wpd.graphicsWidget.screenPx(e,t),s=wpd.graphicsWidget.screenPx(a,i),V(n.x,n.y,s.x,s.y,e,t,a,i),Y(n.x,n.y,e,t,r),Y(s.x,s.y,a,i,l),q(.5*(n.x+s.x),.5*(n.y+s.y),.5*(e+a),.5*(t+i),o);else if(j.name===wpd.measurementModes.angle.name)for(var c,u,h,m,w,x,f,y,C,v,D,P,b,L,N,M=j.getData(),O=M.connectionCount(),_=0;_<O;_++)c=(x=M.getConnectionAt(_))[0],u=x[1],h=x[2],m=x[3],w=x[4],x=x[5],b=M.isPointSelected(_,0),L=M.isPointSelected(_,1),N=M.isPointSelected(_,2),P="Theta"+_.toString()+": "+M.getAngle(_).toFixed(2)+"°",v=Math.atan2(u-m,c-h),D=Math.atan2(x-m,w-h),f=wpd.graphicsWidget.screenPx(c,u),y=wpd.graphicsWidget.screenPx(h,m),C=wpd.graphicsWidget.screenPx(w,x),V(f.x,f.y,y.x,y.y,c,u,h,m),V(y.x,y.y,C.x,C.y,h,m,w,x),Y(f.x,f.y,c,u,b),Y(y.x,y.y,h,m,L),Y(C.x,C.y,w,x,N),$(y.x,y.y,h,m,v,D),q(y.x+10,y.y+15,h+10,m+15,P);else if(j.name===wpd.measurementModes.area.name){let l=j.getData();var z=l.connectionCount();let d=j.getAxes();for(let r=0;r<z;r++){var A=l.getConnectionAt(r);let t=0,a=0,i=0,n=0,s={x:0,y:0};for(let e=0;e<A.length;e+=2){var I,T,k,B=A[e],E=A[e+1],S=wpd.graphicsWidget.screenPx(B,E);2<=e&&V(s.x,s.y,S.x,S.y,i,n,B,E),e==A.length-2&&(I=A[0],T=A[1],k=wpd.graphicsWidget.screenPx(I,T),V(k.x,k.y,S.x,S.y,I,T,B,E)),i=B,n=E,s=S}for(let e=0;e<A.length;e+=2){var R=A[e],W=A[e+1],H=wpd.graphicsWidget.screenPx(R,W),G=l.isPointSelected(r,e/2);Y(H.x,H.y,R,W,G),t+=R,a+=W}t/=A.length/2,a/=A.length/2;var U=wpd.graphicsWidget.screenPx(t,a);let e="",o="";o=!0===wpd.appData.isAligned()&&d instanceof wpd.MapAxes?(e="Area"+r+": "+d.pixelToDataArea(l.getArea(r)).toFixed(2)+" "+d.getUnits()+"^2","Perimeter"+r+": "+d.pixelToDataDistance(l.getPerimeter(r)).toFixed(2)+" "+d.getUnits()):(e="Area"+r+": "+l.getArea(r).toFixed(2)+" px^2","Perimeter"+r+": "+l.getPerimeter(r).toFixed(2)+" px");var X=e+", "+o;q(U.x,U.y,t,a,X)}return}},this.onForcedRedraw=function(){wpd.graphicsWidget.resetData(),this.onRedraw()}},wpd||{}),wpd=(wpd.args={getValue:function(e){for(var t,a=window.location.search.substring(1).split("&"),i=0;i<a.length;i++)if((t=a[i].split("="))[0]===e)return unescape(t[1]);return null}},wpd||{}),wpd=(wpd.dataExport={show:function(){},generateCSV:function(){wpd.popup.close("export-all-data-popup");let l=wpd.appData.getPlotData(),d=l.getDatasets();if(null==d||0===d.length)wpd.messagePopup.show(wpd.gettext("no-datasets-to-export-error"),wpd.gettext("no-datasets-to-export"));else{let a=0,i=[],n=[],s=[],o=0;for(let t=0;t<d.length;t++){let e=l.getAxesForDataset(d[t]);if(null!=e){var p=e.getAxesLabels(),g=p.length,c=(o+=g,d[t].getCount());c>a&&(a=c),i.push(d[t].name);for(let e=0;e<g;e++)0!==e&&i.push(""),n.push(p[e])}}for(let e=0;e<a;e++){var u=[];for(let e=0;e<o;e++)u.push("");s.push(u)}let r=0;for(let a=0;a<d.length;a++){let e=l.getAxesForDataset(d[a]);if(null!=e){var h=e.getAxesLabels().length,m=d[a].getCount();for(let t=0;t<m;t++){var w=d[a].getPixel(t),x=function(e,t,a){var i=t.pixelToData(a.x,a.y);if(t instanceof wpd.XYAxes)for(var n,s=0;s<=1;s++)t.isDate(s)&&(n=t.getInitialDateFormat(s),i[s]=wpd.dateConverter.formatDateNumber(i[s],n));else t instanceof wpd.CircularChartRecorderAxes?i[0]=wpd.dateConverter.formatDateNumber(i[0],t.getTimeFormat()):t instanceof wpd.BarAxes&&(i=["",i[0]],null==a.metadata?i[0]="Bar"+e:i[0]=a.metadata[0]);return i}(t,e,w);for(let e=0;e<h;e++)s[t][r+e]=x[e]}r+=h}}let t=i.join(",")+"\n"+n.join(",")+"\n";for(let e=0;e<a;e++)t+=s[e].join(",")+"\n";wpd.download.csv(t,"wpd_datasets.csv")}},exportToPlotly:function(){wpd.popup.close("export-all-data-popup");var e,t,a,i,n,s=wpd.appData.getPlotData().getDatasets(),o=wpd.plotDataProvider,r={data:[]};if(null==s||0===s.length)wpd.messagePopup.show(wpd.gettext("no-datasets-to-export-error"),wpd.gettext("no-datasets-to-export"));else{for(e=0;e<s.length;e++)for(o.setDataSource(s[e]),i=o.getData(),r.data[e]={},t=0;t<2;t++)for(r.data[e][n=0===t?"x":"y"]=[],a=0;a<i.rawData.length;a++)null!=i.fieldDateFormat[t]?r.data[e][n][a]=wpd.dateConverter.formatDateNumber(i.rawData[a][t],"yyyy-mm-dd hh:ii:ss"):r.data[e][n][a]=i.rawData[a][t];wpd.plotly.send(r)}}},wpd||{}),wpd=(wpd.download=function(){function a(e,t){let a=document.createElement("a");a.href=URL.createObjectURL(new Blob([e]),{type:"text/plain"}),a.download=t.replace(/[^a-zA-Z\d+\.\-_\s]/g,"_"),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}return{json:function(e,t){a(e,t=null==t?"wpd_plot_data.json":t)},csv:function(e,t){a(e,t=null==t?"data.csv":t)}}}(),wpd||{}),wpd=(wpd.events=function(){let n={};function i(e,t){window.removeEventListener(e,t),t=t,s(e=e)?t&&(0<=(t=n[e].indexOf(t))&&n[e].splice(t,1),0!==n[e].length)||delete n[e]:n={}}function s(e){return n[e]&&0<n[e].length}return"function"!=typeof window.CustomEvent&&(window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var a=document.createEvent("CustomEvent");return a.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),a}),{dispatch:function(e,t){s(e)&&window.dispatchEvent(new CustomEvent(e,{detail:t}))},addListener:function(e,t){var a,i=e=>{t(e.detail)};return window.addEventListener(e,i),e=e,a=i,n[e]?n[e].push(a):n[e]=[a],i},removeListener:i,removeAllListeners:function(e){var t=e=>{for(;n[e];)i(e,n[e][0])};if(e)s(e)&&t(e);else for(const a in n)t(a)},getRegisteredEvents:function(){return n}}}(),wpd||{}),wpd=(wpd.log=function(){wpd.browserInfo.isElectronBrowser()||fetch("log").then(function(e){return e.text()}).then(function(e){if("true"==e){let e={};e["screen-size"]=window.screen.width+"x"+window.screen.height,e["document-location"]=document.location.href,e["document-referrer"]=document.referrer,e.platform=window.navigator.platform,e.userAgent=window.navigator.userAgent,e.language=window.navigator.language,fetch("log",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify(e)})}})},wpd||{}),wpd=(wpd.plotly={send:function(e){var t=document.createElement("div"),a=document.createElement("form"),i=document.createElement("textarea");a.setAttribute("method","post"),a.setAttribute("action","https://plot.ly/external"),a.setAttribute("target","_blank"),i.setAttribute("name","data"),i.setAttribute("id","data"),a.appendChild(i),t.appendChild(a),document.body.appendChild(t),t.style.display="none",e=JSON.stringify(e),i.innerHTML=e,a.submit(),document.body.removeChild(t)}},wpd||{}),wpd=(wpd.saveResume=function(){function r(t){const e=wpd.appData.getPlotData();t=e.deserialize(t);{let e={};t&&0!==Object.keys(t).length&&(e=t),wpd.appData.getFileManager().loadMetadata(e)}wpd.tree.refresh()}function t(){const e=wpd.appData.getPlotData();var t=wpd.appData.getFileManager().getMetadata();return JSON.stringify(e.serialize(t))}function n(e){return e.replace(/[^a-zA-Z\d+\.\-_\s]/g,"_")}function s(e){wpd.busyNote.show();var o=new tarball.TarReader;o.readFile(e).then(function(t){wpd.busyNote.close();var a=t.findIndex(e=>e.name.endsWith("/info.json"));if(0<=a){const s=t[a].name.replace("/info.json","");let n=[],e=(t.filter(e=>"file"===e.type&&!e.name.endsWith(".json")).forEach(e=>{let t="";t=e.name.endsWith(".pdf")?"application/pdf":"image/png";var a=new RegExp(s+"/","i");const i=o.getFileBlob(e.name,t);i.name=e.name.replace(a,""),n.push(i)}),JSON.parse(o.getTextFile(s+"/wpd.json")));wpd.imageManager.initializeFileManager(n),wpd.imageManager.loadFromFile(n[0],!0).then(()=>{r(e),wpd.tree.refresh(),wpd.messagePopup.show(wpd.gettext("import-json"),wpd.gettext("json-data-loaded")),l()})}},function(e){console.log(e)})}function l(){const e=wpd.appData.getPlotData();0<e.getDatasetCount()&&wpd.tree.selectPath("/"+wpd.gettext("datasets"))}return{save:function(){wpd.popup.show("export-json-window")},load:function(){wpd.popup.show("import-json-window")},downloadJSON:function(){var e=n(document.getElementById("project-name-input").value)+".json";wpd.download.json(t(),e),wpd.popup.close("export-json-window")},downloadProject:function(){const a=n(document.getElementById("project-name-input").value),i=t();wpd.busyNote.show(),wpd.graphicsWidget.getImageFiles().then(e=>{var t=e.map(e=>e.name);!function(t,e,a,i){var n=JSON.stringify({version:[4,0],json:"wpd.json",images:i});let s=new tarball.TarWriter;s.addFolder(t+"/"),s.addTextFile(t+"/info.json",n),s.addTextFile(t+"/wpd.json",e);for(let e=0;e<a.length;e++)s.addFile(t+"/"+i[e],a[e]);return s.download(t+".tar")}(a,i,e,t).then(wpd.busyNote.close())}),wpd.popup.close("export-json-window")},read:function(){var a,i=document.getElementById("import-json-file");if(wpd.popup.close("import-json-window"),1===i.files.length){let e=i.files[0],t=e.type;""!=t&&null!=t||(e.name.endsWith(".json")?t="application/json":e.name.endsWith(".tar")&&(t="application/x-tar")),"application/json"==t?(i=e,(a=new FileReader).onload=function(){r(JSON.parse(a.result)),wpd.graphicsWidget.resetData(),wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.removeRepainter(),wpd.tree.refresh(),wpd.messagePopup.show(wpd.gettext("import-json"),wpd.gettext("json-data-loaded")),l()},a.readAsText(i)):"application/x-tar"==t?s(e):wpd.messagePopup.show(wpd.gettext("invalid-project"),wpd.gettext("invalid-project-msg"))}},readProjectFile:s}}(),wpd||{}),wpd=(wpd.scriptInjector=function(){function start(){wpd.popup.show("runScriptPopup")}function cancel(){wpd.popup.close("runScriptPopup")}function load(){var $scriptFileInput=document.getElementById("runScriptFileInput"),fileReader;wpd.popup.close("runScriptPopup"),1==$scriptFileInput.files.length&&(fileReader=new FileReader,fileReader.onload=function(){"undefined"!=typeof wpdscript&&(wpdscript=null),eval(fileReader.result),"wpdscript"!=typeof wpdscript&&(window.wpdscript=wpdscript,wpdscript.run())},fileReader.readAsText($scriptFileInput.files[0]))}function injectHTML(){}function injectCSS(){}return{start:start,cancel:cancel,load:load}}(),wpd||{}),wpd=(wpd.appData=function(){let e=null,t=null,a=null,i=null;function n(){return e=null==e?new wpd.PlotData:e}function s(){var e;return l()?(e=a.currentPage(),(t=null===t?{}:t).hasOwnProperty(e)||(t[e]=new wpd.UndoManager),t[e]):t=null==t?new wpd.UndoManager:t}function o(){return i=null==i?new wpd.FileManager:i}function r(){return a}function l(){const e=a;return!!e&&1<e.pageCount()}return{isAligned:function(){return 0<n().getAxesCount()},isMultipage:l,getPlotData:n,getUndoManager:s,getPageManager:r,getFileManager:o,getMultipageUndoManager:function(){return l()?t:null},setPageManager:function(e){a=e,o().refreshPageInfo()},setUndoManager:function(e){t=e},reset:function(){e=null,t=null},plotLoaded:function(e){n().setTopColors(wpd.colorAnalyzer.getTopColors(e)),s().reapply()}}}(),wpd||{}),wpd=(wpd.autoExtraction={start:function(){wpd.colorPicker.init(),wpd.algoManager.updateAlgoList()}},wpd.algoManager=function(){var d,p;function g(){var e=wpd.tree.getActiveDataset();return wpd.appData.getPlotData().getAutoDetectionDataForDataset(e)}function i(){var e=document.getElementById("auto-extract-algo-name").value;let t=g();t.algorithm=new("averagingWindow"===e?wpd.AveragingWindowAlgo:"XStepWithInterpolation"===e?wpd.XStepWithInterpolationAlgo:"CustomIndependents"===e?wpd.CustomIndependents:"XStep"===e?wpd.AveragingWindowWithStepSizeAlgo:"blobDetector"===e?wpd.BlobDetectorAlgo:"barExtraction"===e||"histogram"===e?wpd.BarExtractionAlgo:wpd.AveragingWindowAlgo),n(t.algorithm)}function n(e){let t=document.getElementById("algo-parameter-container");var a=e.getParamList(d),i=Object.keys(a);let n="<table>";for(let e=0;e<i.length;e++){var s=a[i[e]];n+="<tr><td>"+s[0]+'</td><td><input type="text" size=3 id="algo-param-'+i[e]+'" class="algo-params" value="'+s[2]+'"/></td><td>'+s[1]+"</td></tr>"}n+="</table>",t.innerHTML=n}return{updateAlgoList:function(){p=wpd.tree.getActiveDataset(),d=wpd.appData.getPlotData().getAxesForDataset(p);let e="",t=document.getElementById("auto-extract-algo-name");d instanceof wpd.BarAxes||(e+='<option value="averagingWindow">'+wpd.gettext("averaging-window")+"</option>"),d instanceof wpd.XYAxes&&(e=(e+='<option value="XStepWithInterpolation">'+wpd.gettext("x-step-with-interpolation")+"</option>")+'<option value="XStep">'+wpd.gettext("x-step")+"</option>"),d instanceof wpd.XYAxes&&(e+='<option value="CustomIndependents">'+wpd.gettext("custom-independents")+"</option>"),d instanceof wpd.BarAxes||(e+='<option value="blobDetector">'+wpd.gettext("blob-detector")+"</option>"),d instanceof wpd.BarAxes&&(e+='<option value="barExtraction">'+wpd.gettext("bar-extraction")+"</option>"),d instanceof wpd.XYAxes&&(e+='<option value="histogram">'+wpd.gettext("histogram")+"</option>"),t.innerHTML=e;var a=g();null!=a.algorithm?(a.algorithm instanceof wpd.AveragingWindowAlgo?t.value="averagingWindow":a.algorithm instanceof wpd.XStepWithInterpolationAlgo?t.value="XStepWithInterpolation":a.algorithm instanceof wpd.CustomIndependents?t.value="CustomIndependents":a.algorithm instanceof wpd.AveragingWindowWithStepSizeAlgo?t.value="XStep":a.algorithm instanceof wpd.BlobDetectorAlgo?t.value="blobDetector":a.algorithm instanceof wpd.BarExtractionAlgo&&(d instanceof wpd.XYAxes?t.value="histogram":t.value="barExtraction"),n(a.algorithm)):i()},applyAlgoSelection:i,run:function(){wpd.busyNote.show();let e=g(),t=e.algorithm;var a=new wpd.DataPointsRepainter(d,p),i=document.getElementsByClassName("algo-params");let n=wpd.graphicsWidget.getAllContexts();var s=wpd.graphicsWidget.getImageSize();let o={};for(let t=0;t<i.length;t++){let e=i[t].id;var r=e.replace("algo-param-","");o[r]=i[t].value}t.setParams(o),wpd.graphicsWidget.removeTool();var l=n.oriImageCtx.getImageData(0,0,s.width,s.height);return e.imageWidth=s.width,e.imageHeight=s.height,e.generateBinaryData(l),wpd.graphicsWidget.setRepainter(a),t.run(e,p,d),wpd.graphicsWidget.forceHandlerRepaint(),wpd.dataPointCounter.setCount(p.getCount()),wpd.busyNote.close(),!0}}}(),wpd.dataMask=function(){function e(){let e=wpd.graphicsWidget.getAllContexts();var t=wpd.graphicsWidget.getImageSize(),a=e.oriDataCtx.getImageData(0,0,t.width,t.height);let i=new Set,n=(t=wpd.tree.getActiveDataset(),wpd.appData.getPlotData().getAutoDetectionDataForDataset(t));for(let e=0;e<a.data.length;e+=4)255===a.data[e]&&255===a.data[e+1]&&0===a.data[e+2]&&i.add(e/4);n.setMask(i)}return{grabMask:e,markBox:function(){var e=new wpd.BoxMaskTool;wpd.graphicsWidget.setTool(e)},markPen:function(){var e=new wpd.PenMaskTool;wpd.graphicsWidget.setTool(e)},eraseMarks:function(){var e=new wpd.EraseMaskTool;wpd.graphicsWidget.setTool(e)},viewMask:function(){var e=new wpd.ViewMaskTool;wpd.graphicsWidget.setTool(e)},clearMask:function(){wpd.graphicsWidget.resetData(),e()}}}(),wpd||{}),wpd=(wpd.AxesCalibrator=class{constructor(e,t){this._calibration=e,this._isEditing=t}},wpd.XYAxesCalibrator=class extends wpd.AxesCalibrator{start(){wpd.popup.show("xyAxesInfo")}reload(){var e=new wpd.AxesCornersTool(this._calibration,!0);wpd.graphicsWidget.setTool(e)}pickCorners(){wpd.popup.close("xyAxesInfo");var e=new wpd.AxesCornersTool(this._calibration,!1);wpd.graphicsWidget.setTool(e)}getCornerValues(){if(wpd.popup.show("xyAlignment"),this._isEditing){let e=wpd.tree.getActiveAxes(),t=e.calibration;4==t.getCount()&&(document.getElementById("xmin").value=t.getPoint(0).dx,document.getElementById("xmax").value=t.getPoint(1).dx,document.getElementById("ymin").value=t.getPoint(2).dy,document.getElementById("ymax").value=t.getPoint(3).dy,document.getElementById("xlog").checked=e.isLogX(),document.getElementById("ylog").checked=e.isLogY(),document.getElementById("xy-axes-no-rotation").checked=e.noRotation())}}align(){var e=document.getElementById("xmin").value,t=document.getElementById("xmax").value,a=document.getElementById("ymin").value,i=document.getElementById("ymax").value,n=document.getElementById("xlog").checked,s=document.getElementById("ylog").checked,o=document.getElementById("xy-axes-no-rotation").checked;let r=this._isEditing?wpd.tree.getActiveAxes():new wpd.XYAxes;if(n&&(0==parseFloat(e)||0==parseFloat(t))||s&&(0==parseFloat(a)||0==parseFloat(i)))return wpd.popup.close("xyAlignment"),wpd.messagePopup.show(wpd.gettext("calibration-invalid-log-inputs"),wpd.gettext("calibration-enter-valid-log"),wpd.alignAxes.getCornerValues),!1;if(this._calibration.setDataAt(0,e,a),this._calibration.setDataAt(1,t,a),this._calibration.setDataAt(2,e,a),this._calibration.setDataAt(3,t,i),!r.calibrate(this._calibration,n,s,o))return wpd.popup.close("xyAlignment"),wpd.messagePopup.show(wpd.gettext("calibration-invalid-inputs"),wpd.gettext("calibration-enter-valid"),wpd.alignAxes.getCornerValues),!1;if(!this._isEditing){r.name=wpd.alignAxes.makeAxesName(wpd.XYAxes);let e=wpd.appData.getPlotData();e.addAxes(r,wpd.appData.isMultipage()),wpd.alignAxes.postProcessAxesAdd(r)}return wpd.popup.close("xyAlignment"),!0}},wpd.BarAxesCalibrator=class extends wpd.AxesCalibrator{start(){wpd.popup.show("barAxesInfo")}reload(){var e=new wpd.AxesCornersTool(this._calibration,!0);wpd.graphicsWidget.setTool(e)}pickCorners(){wpd.popup.close("barAxesInfo");var e=new wpd.AxesCornersTool(this._calibration,!1);wpd.graphicsWidget.setTool(e)}getCornerValues(){if(wpd.popup.show("barAlignment"),this._isEditing){let e=wpd.tree.getActiveAxes(),t=e.calibration;2==t.getCount()&&(document.getElementById("bar-axes-p1").value=t.getPoint(0).dy,document.getElementById("bar-axes-p2").value=t.getPoint(1).dy,document.getElementById("bar-axes-log-scale").checked=e.isLog(),document.getElementById("bar-axes-rotated").checked=e.isRotated())}}align(){var e=document.getElementById("bar-axes-p1").value,t=document.getElementById("bar-axes-p2").value,a=document.getElementById("bar-axes-log-scale").checked,i=document.getElementById("bar-axes-rotated").checked;let n=this._isEditing?wpd.tree.getActiveAxes():new wpd.BarAxes;if(this._calibration.setDataAt(0,0,e),this._calibration.setDataAt(1,0,t),!n.calibrate(this._calibration,a,i))return wpd.popup.close("barAlignment"),wpd.messagePopup.show(wpd.gettext("calibration-invalid-inputs"),wpd.gettext("calibration-enter-valid"),wpd.alignAxes.getCornerValues),!1;if(!this._isEditing){n.name=wpd.alignAxes.makeAxesName(wpd.BarAxes);let e=wpd.appData.getPlotData();e.addAxes(n,wpd.appData.isMultipage()),wpd.alignAxes.postProcessAxesAdd(n)}return wpd.popup.close("barAlignment"),!0}},wpd.PolarAxesCalibrator=class extends wpd.AxesCalibrator{start(){wpd.popup.show("polarAxesInfo")}reload(){var e=new wpd.AxesCornersTool(this._calibration,!0);wpd.graphicsWidget.setTool(e)}pickCorners(){wpd.popup.close("polarAxesInfo");var e=new wpd.AxesCornersTool(this._calibration,!1);wpd.graphicsWidget.setTool(e)}getCornerValues(){if(wpd.popup.show("polarAlignment"),this._isEditing){let e=wpd.tree.getActiveAxes(),t=e.calibration;3==t.getCount()&&(document.getElementById("polar-r1").value=t.getPoint(1).dx,document.getElementById("polar-theta1").value=t.getPoint(1).dy,document.getElementById("polar-r2").value=t.getPoint(2).dx,document.getElementById("polar-theta2").value=t.getPoint(2).dy,document.getElementById("polar-degrees").checked=e.isThetaDegrees(),document.getElementById("polar-radians").checked=!e.isThetaDegrees(),document.getElementById("polar-clockwise").checked=e.isThetaClockwise(),document.getElementById("polar-log-scale").checked=e.isRadialLog())}}align(){var e=parseFloat(document.getElementById("polar-r1").value),t=parseFloat(document.getElementById("polar-theta1").value),a=parseFloat(document.getElementById("polar-r2").value),i=parseFloat(document.getElementById("polar-theta2").value),n=document.getElementById("polar-degrees").checked,s=document.getElementById("polar-clockwise").checked,o=document.getElementById("polar-log-scale").checked;let r=this._isEditing?wpd.tree.getActiveAxes():new wpd.PolarAxes;if(this._calibration.setDataAt(1,e,t),this._calibration.setDataAt(2,a,i),r.calibrate(this._calibration,n,s,o),!this._isEditing){r.name=wpd.alignAxes.makeAxesName(wpd.PolarAxes);let e=wpd.appData.getPlotData();e.addAxes(r,wpd.appData.isMultipage()),wpd.alignAxes.postProcessAxesAdd(r)}return wpd.popup.close("polarAlignment"),!0}},wpd.TernaryAxesCalibrator=class extends wpd.AxesCalibrator{start(){wpd.popup.show("ternaryAxesInfo")}reload(){var e=new wpd.AxesCornersTool(this._calibration,!0);wpd.graphicsWidget.setTool(e)}pickCorners(){wpd.popup.close("ternaryAxesInfo");var e=new wpd.AxesCornersTool(this._calibration,!1);wpd.graphicsWidget.setTool(e)}getCornerValues(){if(wpd.popup.show("ternaryAlignment"),this._isEditing){let e=wpd.tree.getActiveAxes(),t=e.calibration;3==t.getCount()&&(document.getElementById("range0to1").checked=!e.isRange100(),document.getElementById("range0to100").checked=e.isRange100(),document.getElementById("ternarynormal").checked=e.isNormalOrientation())}}align(){var e=document.getElementById("range0to100").checked,t=document.getElementById("ternarynormal").checked;let a=this._isEditing?wpd.tree.getActiveAxes():new wpd.TernaryAxes;if(a.calibrate(this._calibration,e,t),!this._isEditing){a.name=wpd.alignAxes.makeAxesName(wpd.TernaryAxes);let e=wpd.appData.getPlotData();e.addAxes(a,wpd.appData.isMultipage()),wpd.alignAxes.postProcessAxesAdd(a)}return wpd.popup.close("ternaryAlignment"),!0}},wpd.MapAxesCalibrator=class extends wpd.AxesCalibrator{start(){wpd.popup.show("mapAxesInfo")}reload(){var e=new wpd.AxesCornersTool(this._calibration,!0);wpd.graphicsWidget.setTool(e)}pickCorners(){wpd.popup.close("mapAxesInfo");var e=new wpd.AxesCornersTool(this._calibration,!1);wpd.graphicsWidget.setTool(e)}getCornerValues(){if(wpd.popup.show("mapAlignment"),this._isEditing){let e=wpd.tree.getActiveAxes(),t=e.calibration;2==t.getCount()&&(document.getElementById("scaleLength").checked=e.getScaleLength(),document.getElementById("scaleUnits").checked=e.getUnits())}}align(){var e=parseFloat(document.getElementById("scaleLength").value),t=document.getElementById("scaleUnits").value,a=document.getElementById("map-origin-bottom-left").checked?"bottom-left":"top-left",i=wpd.graphicsWidget.getImageSize().height;let n=this._isEditing?wpd.tree.getActiveAxes():new wpd.MapAxes;if(n.calibrate(this._calibration,e,t,a,i),!this._isEditing){n.name=wpd.alignAxes.makeAxesName(wpd.MapAxes);let e=wpd.appData.getPlotData();e.addAxes(n,wpd.appData.isMultipage()),wpd.alignAxes.postProcessAxesAdd(n)}return wpd.popup.close("mapAlignment"),!0}},wpd.CircularChartRecorderCalibrator=class extends wpd.AxesCalibrator{start(){wpd.popup.show("circularChartRecorderAxesInfo")}reload(){var e=new wpd.AxesCornersTool(this._calibration,!0);wpd.graphicsWidget.setTool(e)}pickCorners(){wpd.popup.close("circularChartRecorderAxesInfo");var e=new wpd.AxesCornersTool(this._calibration,!1);wpd.graphicsWidget.setTool(e)}getCornerValues(){if(wpd.popup.show("circularChartRecorderAlignment"),this._isEditing){let e=wpd.tree.getActiveAxes(),t=e.calibration;var a;5==t.getCount()&&(document.getElementById("circular-t0").value=t.getPoint(0).dx,document.getElementById("circular-r0").value=t.getPoint(0).dy,null!=(a=e.getStartTime())&&(document.getElementById("circular-tstart").value=a),document.getElementById("circular-r2").value=t.getPoint(2).dy)}}align(){var e=document.getElementById("circular-t0").value,t=parseFloat(document.getElementById("circular-r0").value),a=parseFloat(document.getElementById("circular-r2").value),i=document.getElementById("circular-tstart").value;let n=this._isEditing?wpd.tree.getActiveAxes():new wpd.CircularChartRecorderAxes;if(this._calibration.setDataAt(0,e,t),this._calibration.setDataAt(1,e,0),this._calibration.setDataAt(2,e,a),this._calibration.setDataAt(3,0,a),this._calibration.setDataAt(4,0,a),n.calibrate(this._calibration,i),!this._isEditing){n.name=wpd.alignAxes.makeAxesName(wpd.CircularChartRecorderAxes);let e=wpd.appData.getPlotData();e.addAxes(n,wpd.appData.isMultipage()),wpd.alignAxes.postProcessAxesAdd(n)}return wpd.popup.close("circularChartRecorderAlignment"),!0}},wpd.alignAxes=function(){let r=null,l=null;function e(){const t=()=>{const e=wpd.appData.getPlotData();var t=wpd.tree.getActiveAxes();e.deleteAxes(t),wpd.appData.isMultipage()&&wpd.appData.getPageManager().deleteAxesFromCurrentPage([t]),wpd.tree.refresh(),wpd.tree.selectPath("/"+wpd.gettext("axes")),wpd.events.dispatch("wpd.axes.delete",{axes:t})},a=wpd.appData.getPlotData(),i=wpd.tree.getActiveAxes(),e=a.getDatasets(),n=e.filter(e=>a.getAxesForDataset(e)===i);0<n.length?wpd.okCancelPopup.show(wpd.gettext("delete-associated-datasets"),wpd.gettext("delete-associated-datasets-text"),()=>{for(const e of n)a.deleteDataset(e),wpd.appData.getFileManager().deleteDatasetsFromCurrentFile([e]),wpd.appData.isMultipage()&&wpd.appData.getPageManager().deleteDatasetsFromCurrentPage([e]),wpd.events.dispatch("wpd.dataset.delete",{dataset:e});t()},t):t()}function n(){var e=wpd.tree.getActiveAxes();const t=document.getElementById("rename-axes-name-input");t.value=e.name,wpd.popup.show("rename-axes-popup")}function t(){const e=document.getElementById("rename-axes-name-input");wpd.popup.close("rename-axes-popup");var t=e.value.trim();const a=wpd.appData.getPlotData();if(0<=a.getAxesNames().indexOf(t)||0===t.length)wpd.messagePopup.show(wpd.gettext("rename-axes-error"),wpd.gettext("axes-exists-error"),n);else{const i=wpd.tree.getActiveAxes();i.name=t,wpd.tree.refresh(),wpd.tree.selectPath("/"+wpd.gettext("axes")+"/"+t,!0)}}function d(t){wpd.events.dispatch("wpd.axes.add",{axes:t});const a=wpd.appData.getPlotData(),i=wpd.appData.getFileManager(),n=wpd.appData.getPageManager();i.addAxesToCurrentFile([t]);let e=i.filterToCurrentFileAxes(a.getAxesColl()),s=i.filterToCurrentFileDatasets(a.getDatasets());if(wpd.appData.isMultipage()&&(n.addAxesToCurrentPage([t]),e=n.filterToCurrentPageAxes(e),s=n.filterToCurrentPageDatasets(s)),1===e.length&&0===s.length){let e=new wpd.Dataset;e.name="Default Dataset";t=wpd.dataSeriesManagement.getDatasetWithNameCount(e.name);0<t&&(e.name+=" "+(t+1)),a.addDataset(e),i.addDatasetsToCurrentFile([e]),wpd.appData.isMultipage()&&n.addDatasetsToCurrentPage([e]),wpd.events.dispatch("wpd.dataset.add",{dataset:e})}}return{start:function(){var e=document.getElementById("r_xy"),t=document.getElementById("r_polar"),a=document.getElementById("r_ternary"),i=document.getElementById("r_map"),n=document.getElementById("r_image"),s=document.getElementById("r_bar"),o=document.getElementById("r_circular_chart_recorder");wpd.popup.close("axesList"),!0===e.checked?((r=new wpd.Calibration(2)).labels=["X1","X2","Y1","Y2"],r.labelPositions=["N","N","E","E"],r.maxPointCount=4,l=new wpd.XYAxesCalibrator(r)):!0===s.checked?((r=new wpd.Calibration(2)).labels=["P1","P2"],r.labelPositions=["S","S"],r.maxPointCount=2,l=new wpd.BarAxesCalibrator(r)):!0===t.checked?((r=new wpd.Calibration(2)).labels=["Origin","P1","P2"],r.labelPositions=["E","S","S"],r.maxPointCount=3,l=new wpd.PolarAxesCalibrator(r)):!0===a.checked?((r=new wpd.Calibration(2)).labels=["A","B","C"],r.labelPositions=["S","S","E"],r.maxPointCount=3,l=new wpd.TernaryAxesCalibrator(r)):!0===i.checked?((r=new wpd.Calibration(2)).labels=["P1","P2"],r.labelPositions=["S","S"],r.maxPointCount=2,l=new wpd.MapAxesCalibrator(r)):!0===n.checked?(r=null,l=null,(e=new wpd.ImageAxes).name=wpd.alignAxes.makeAxesName(wpd.ImageAxes),e.calibrate(),wpd.appData.getPlotData().addAxes(e,wpd.appData.isMultipage()),d(e),wpd.tree.refresh(),0<(s=wpd.appData.getPlotData().getDatasetNames()).length&&(t=s[s.length-1],wpd.tree.selectPath("/"+wpd.gettext("datasets")+"/"+t,!0)),wpd.acquireData.load()):!0===o.checked&&((r=new wpd.Calibration(2)).labels=["(T0,R0)","(T0,R1)","(T0,R2)","(T1,R2)","(T2,R2)"],r.labelPositions=["S","S","S","S","S"],r.maxPointCount=5,l=new wpd.CircularChartRecorderCalibrator(r)),null!=l&&(l.start(),1==o.checked?wpd.graphicsWidget.setRepainter(new wpd.CircularChartRecorderAlignmentRepainter(r)):wpd.graphicsWidget.setRepainter(new wpd.AlignmentCornersRepainter(r)))},calibrationCompleted:function(){wpd.sidebar.show("axes-calibration-sidebar")},zoomCalPoint:function(e){e=r.getPoint(e),wpd.graphicsWidget.updateZoomToImagePosn(e.px,e.py)},getCornerValues:function(){l.getCornerValues()},pickCorners:function(){l.pickCorners()},align:function(){var e;wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.removeRepainter(),wpd.graphicsWidget.resetData(),l.align()&&(wpd.sidebar.clear(),wpd.tree.refresh(),0<(e=wpd.appData.getPlotData().getDatasetNames()).length&&(e=e[0],wpd.tree.selectPath("/"+wpd.gettext("datasets")+"/"+e)))},editAlignment:function(){wpd.appData.isAligned()&&null!=l?wpd.popup.show("edit-or-reset-calibration-popup"):wpd.popup.show("axesList")},reloadCalibrationForEditing:function(){wpd.popup.close("edit-or-reset-calibration-popup"),l=null;var e=wpd.tree.getActiveAxes();r=e.calibration,e instanceof wpd.XYAxes?l=new wpd.XYAxesCalibrator(r,!0):e instanceof wpd.BarAxes?l=new wpd.BarAxesCalibrator(r,!0):e instanceof wpd.PolarAxes?l=new wpd.PolarAxesCalibrator(r,!0):e instanceof wpd.TernaryAxes?l=new wpd.TernaryAxesCalibrator(r,!0):e instanceof wpd.MapAxes?l=new wpd.MapAxesCalibrator(r,!0):e instanceof wpd.CircularChartRecorderAxes&&(l=new wpd.CircularChartRecorderCalibrator(r,!0)),null!=l&&(l.reload(),e instanceof wpd.CircularChartRecorderAxes?wpd.graphicsWidget.setRepainter(new wpd.CircularChartRecorderAlignmentRepainter(r)):wpd.graphicsWidget.setRepainter(new wpd.AlignmentCornersRepainter(r)),wpd.graphicsWidget.forceHandlerRepaint(),wpd.sidebar.show("axes-calibration-sidebar"))},addCalibration:function(){wpd.popup.show("axesList")},deleteCalibration:function(){wpd.okCancelPopup.show(wpd.gettext("delete-axes"),wpd.gettext("delete-axes-text"),e)},showRenameAxes:n,makeAxesName:function(e){const t=wpd.appData.getPlotData();let a="";const i=t.getAxesNames();e===wpd.XYAxes?a=wpd.gettext("axes-name-xy"):e===wpd.PolarAxes?a=wpd.gettext("axes-name-polar"):e===wpd.MapAxes?a=wpd.gettext("axes-name-map"):e===wpd.TernaryAxes?a=wpd.gettext("axes-name-ternary"):e===wpd.BarAxes?a=wpd.gettext("axes-name-bar"):e===wpd.ImageAxes?a=wpd.gettext("axes-name-image"):e===wpd.CircularChartRecorderAxes&&(a=wpd.gettext("axes-name-circular-chart-recorder"));let n=2,s=a;for(;0<=i.indexOf(s);)s=a+" "+n,n++;return s},renameAxes:t,renameKeypress:function(e){"Enter"===e.key&&t()},postProcessAxesAdd:d}}(),wpd||{}),wpd=(wpd.browserInfo={checkBrowser:function(){window.FileReader&&"object"==typeof WebAssembly&&"download"in document.createElement("a")||alert("WARNING!\nYour web browser may not be fully supported. Please use a recent version of Google Chrome, Firefox or Safari browser with HTML5 and WebAssembly support.")},isElectronBrowser:function(){return"undefined"!=typeof process}},wpd||{}),wpd=(wpd.colorSelectionWidget=function(){var i,a,n,s;function o(){let e=document.getElementById("color-selection-selected-color-box");e.style.backgroundColor="rgb("+i[0]+","+i[1]+","+i[2]+")",document.getElementById("color-selection-red").value=i[0],document.getElementById("color-selection-green").value=i[1],document.getElementById("color-selection-blue").value=i[2];{let e=document.getElementById("color-selection-options"),t=wpd.appData.getPlotData().getTopColors(),a=10<t.length?10:t.length,i="";for(let e=0;e<a;e++){var n="rgb("+t[e].r+","+t[e].g+","+t[e].b+");",s=t[e].percentage.toFixed(3)+"%";i+='<div class="colorOptionBox" style="background-color: '+n+'" title="'+s+'" onclick="wpd.colorSelectionWidget.selectTopColor('+e+');"></div>'}e.innerHTML=i}wpd.popup.show("color-selection-widget")}return{setParams:function(e){i=e.color,a=e.triggerElementId,n=e.title,s=e.setColorDelegate;let t=document.getElementById("color-selection-title");t.innerHTML=n},startPicker:o,pickColor:function(){wpd.popup.close("color-selection-widget");let e=new wpd.ColorPickerTool;e.onComplete=function(e){s(i=e),wpd.graphicsWidget.removeTool(),o()},wpd.graphicsWidget.setTool(e)},setColor:function(){let e=[];e[0]=parseInt(document.getElementById("color-selection-red").value,10),e[1]=parseInt(document.getElementById("color-selection-green").value,10),e[2]=parseInt(document.getElementById("color-selection-blue").value,10),i=e,s(e),wpd.popup.close("color-selection-widget");{let e=document.getElementById(a);e.style.backgroundColor="rgb("+i[0]+","+i[1]+","+i[2]+")",i[0]+i[1]+i[2]<200?e.style.color="rgb(255,255,255)":e.style.color="rgb(0,0,0)"}},selectTopColor:function(e){let t=[];var a=wpd.appData.getPlotData().getTopColors();t[0]=a[e].r,t[1]=a[e].g,t[2]=a[e].b,i=t,s(t),o()},paintFilteredColor:function(e,t){let a=wpd.graphicsWidget.getAllContexts();var i=wpd.graphicsWidget.getImageSize();let n=a.oriDataCtx.getImageData(0,0,i.width,i.height);if(null!=t&&0!==t.size){for(var s of t)e.has(s)?(n.data[4*s]=255,n.data[4*s+1]=255,n.data[4*s+2]=0,n.data[4*s+3]=255):(n.data[4*s]=0,n.data[4*s+1]=0,n.data[4*s+2]=0,n.data[4*s+3]=150);a.oriDataCtx.putImageData(n,0,0),wpd.graphicsWidget.copyImageDataLayerToScreen()}}}}(),wpd.colorPicker=function(){function o(){var e=wpd.tree.getActiveDataset();return wpd.appData.getPlotData().getAutoDetectionDataForDataset(e)}function t(){let e=document.getElementById("color-button"),t=document.getElementById("color-distance-value");var a=o();let i=document.getElementById("color-detection-mode-select"),n=null;n="fg"===a.colorDetectionMode?a.fgColor:a.bgColor;var s=a.colorDistance;e.style.backgroundColor="rgb("+n[0]+","+n[1]+","+n[2]+")",t.value=s,i.value=a.colorDetectionMode}return{startPicker:function(){wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.removeRepainter(),wpd.graphicsWidget.resetData(),"fg"===o().colorDetectionMode?wpd.colorSelectionWidget.setParams(function(){let t=o();return{color:t.fgColor,triggerElementId:"color-button",title:wpd.gettext("specify-foreground-color"),setColorDelegate:function(e){t.fgColor=e}}}()):wpd.colorSelectionWidget.setParams(function(){let t=o();return{color:t.bgColor,triggerElementId:"color-button",title:wpd.gettext("specify-background-color"),setColorDelegate:function(e){t.bgColor=e}}}()),wpd.colorSelectionWidget.startPicker()},changeDetectionMode:function(){var e=document.getElementById("color-detection-mode-select");o().colorDetectionMode=e.value,t()},changeColorDistance:function(){var e=parseFloat(document.getElementById("color-distance-value").value);o().colorDistance=e},init:t,testColorDetection:function(){wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.removeRepainter(),wpd.graphicsWidget.resetData(),wpd.graphicsWidget.setRepainter(new wpd.ColorFilterRepainter);let e=wpd.graphicsWidget.getAllContexts(),t=o();var a=wpd.graphicsWidget.getImageSize(),a=e.oriImageCtx.getImageData(0,0,a.width,a.height);t.generateBinaryData(a),wpd.colorSelectionWidget.paintFilteredColor(t.binaryData,t.mask)}}}(),wpd||{}),wpd=(wpd.dataSeriesManagement=function(){function l(e){const t=wpd.appData.getPlotData(),a=t.getDatasetNames();return 0<=a.indexOf(e)}function d(){const e=wpd.appData.getPlotData();return e.getDatasetCount()}function a(){var e=wpd.tree.getActiveDataset();const t=document.getElementById("rename-dataset-name-input");t.value=e.name,wpd.popup.show("rename-dataset-popup")}function t(){const e=document.getElementById("rename-dataset-name-input");if(wpd.popup.close("rename-dataset-popup"),l(e.value.trim()))wpd.messagePopup.show(wpd.gettext("rename-dataset-error"),wpd.gettext("dataset-exists-error"),a);else{const t=wpd.tree.getActiveDataset();t.name=e.value.trim(),wpd.tree.refresh(),wpd.tree.selectPath("/"+wpd.gettext("datasets")+"/"+t.name,!0)}}return{showAddDataset:function(){const e=document.getElementById("add-single-dataset-name-input");let t=d(),a=wpd.gettext("dataset")+" "+t;for(;l(a);)t++,a=wpd.gettext("dataset")+" "+t;e.value=a,wpd.popup.show("add-dataset-popup")},showRenameDataset:a,renameDataset:t,renameKeypress:function(e){"Enter"===e.key&&t()},addSingleDataset:function(){const t=document.getElementById("add-single-dataset-name-input");if(wpd.popup.close("add-dataset-popup"),l(t.value.trim()))wpd.messagePopup.show(wpd.gettext("add-dataset-error"),wpd.gettext("dataset-exists-error"),function(){wpd.popup.show("add-dataset-popup")});else{const a=wpd.appData.getPlotData();let e=new wpd.Dataset;e.name=t.value.trim(),a.addDataset(e),wpd.appData.getFileManager().addDatasetsToCurrentFile([e]),wpd.appData.isMultipage()&&wpd.appData.getPageManager().addDatasetsToCurrentPage([e]),wpd.tree.refreshPreservingSelection(),wpd.events.dispatch("wpd.dataset.add",{dataset:e})}},addMultipleDatasets:function(){var e=document.getElementById("add-multiple-datasets-count-input"),a=parseInt(e.value,0);if(wpd.popup.close("add-dataset-popup"),0<a){const o=wpd.appData.getPlotData(),r=wpd.appData.getFileManager();var i=wpd.appData.isMultipage();let e=d();var n=wpd.gettext("dataset")+" ";let t=0;for(;t<a;){var s=n+e;if(!l(s)){let e=new wpd.Dataset;e.name=s,o.addDataset(e),r.addDatasetsToCurrentFile([e]),i&&wpd.appData.getPageManager().addDatasetsToCurrentPage([e]),wpd.events.dispatch("wpd.dataset.add",{dataset:e}),t++}e++}wpd.tree.refreshPreservingSelection()}else wpd.messagePopup(wpd.gettext("add-dataset-error"),wpd.gettext("add-dataset-count-error"),function(){wpd.popup.show("add-dataset-popup")})},deleteDataset:function(){wpd.okCancelPopup.show(wpd.gettext("delete-dataset"),wpd.gettext("delete-dataset-text"),function(){const e=wpd.appData.getPlotData();var t=wpd.tree.getActiveDataset();e.deleteDataset(t),wpd.appData.getFileManager().deleteDatasetsFromCurrentFile([t]),wpd.appData.isMultipage()&&wpd.appData.getPageManager().deleteDatasetsFromCurrentPage([t]),wpd.tree.refresh(),wpd.tree.selectPath("/"+wpd.gettext("datasets")),wpd.events.dispatch("wpd.dataset.delete",{dataset:t})})},changeAxes:function(e){const t=wpd.appData.getPlotData();var a=t.getAxesColl(),i=wpd.tree.getActiveDataset();-1===(e=parseInt(e,10))?t.setAxesForDataset(i,null):0<=e&&e<a.length&&t.setAxesForDataset(i,a[e]),wpd.tree.refreshPreservingSelection(!0)},startColorPicker:function(){wpd.colorSelectionWidget.setParams({color:wpd.tree.getActiveDataset().colorRGB.getRGB(),triggerElementId:"dataset-display-color-picker-button",title:"Specify Display Color for Digitized Points",setColorDelegate:function(e){wpd.tree.getActiveDataset().colorRGB=new wpd.Color(e[0],e[1],e[2]),wpd.graphicsWidget.forceHandlerRepaint(),wpd.tree.refreshPreservingSelection()}}),wpd.colorSelectionWidget.startPicker()},getDatasetWithNameCount:function(e){const t=wpd.appData.getPlotData();let a=0;for(const i of t.getDatasetNames())i.startsWith(e)&&a++;return a}}}(),wpd||{}),wpd=(wpd.FileManager=class{constructor(){this.$pageInfoElements=document.getElementsByClassName("paged"),this.$fileSelectorContainers=document.getElementsByClassName("files"),this.$navSeparator=document.getElementById("navSeparator"),this.$fileSelector=document.getElementById("image-file-select"),this._init()}_init(){this.currentIndex=0,this.pageManagers={},this.undoManagers={},this.axesByFile={},this.datasetsByFile={},this.measurementsByFile={},this.rotationsByFile={},this.files=[],this.$navSeparator.hidden=!0,this._hidePageInfo(),wpd.events.removeListener("wpd.image.rotate",this.rotationHandler),this.rotationHandler=wpd.events.addListener("wpd.image.rotate",e=>{const t=wpd.appData.getPageManager();t&&t.setRotation(e.rotation)})}set(e){this.files=e,this._initializeInput(),1<e.length?this._showFileInfo():(this._hideFileInfo(),this.$navSeparator.hidden=!0)}reset(){this._init(),wpd.appData.setPageManager(null)}getFiles(){return this.files}fileCount(){return this.files.length}currentFileIndex(){return this.currentIndex}_initializeInput(){var e=Array.prototype.map.call(this.files,e=>e.name),t=wpd.utils.integerRange(this.files.length),a=this.currentIndex;this.$fileSelector.innerHTML=wpd.utils.createOptionsHTML(e,t,a)}_showFileInfo(){wpd.utils.toggleElementsDisplay(this.$fileSelectorContainers,!1)}_hideFileInfo(){wpd.utils.toggleElementsDisplay(this.$fileSelectorContainers,!0)}_showPageInfo(){wpd.utils.toggleElementsDisplay(this.$pageInfoElements,!1)}_hidePageInfo(){wpd.utils.toggleElementsDisplay(this.$pageInfoElements,!0)}refreshPageInfo(){wpd.appData.isMultipage()?(this._showPageInfo(),1<this.files.length&&(this.$navSeparator.hidden=!1)):(this._hidePageInfo(),this.$navSeparator.hidden=!0)}_savePageManager(){var e=wpd.appData.getPageManager();e&&!this.pageManagers[this.currentIndex]&&(this.pageManagers[this.currentIndex]=e)}_loadPageManager(e){let t=null;this.pageManagers[e]&&(t=this.pageManagers[e]).refreshInput(),wpd.appData.setPageManager(t)}_saveUndoManager(){let e=null;this.pageManagers[this.currentIndex]?e=wpd.appData.getMultipageUndoManager():(e=wpd.appData.getUndoManager()).canUndo()||e.canRedo()||(e=null),e&&(this.undoManagers[this.currentIndex]=e)}_loadUndoManager(e){let t=null;this.undoManagers[e]&&(t=this.undoManagers[e]),wpd.appData.setUndoManager(t)}switch(e){e=parseInt(e,10);e!==this.currentIndex&&-1<e&&e<=this.files.length&&(this._savePageManager(),this._loadPageManager(e),this._saveUndoManager(),this._loadUndoManager(e),wpd.imageManager.loadFromFile(this.files[e],!0),this.currentIndex=e,wpd.tree.refresh())}addAxesToCurrentFile(e){wpd.utils.addToCollection(this.axesByFile,this.currentIndex,e)}addDatasetsToCurrentFile(e){wpd.utils.addToCollection(this.datasetsByFile,this.currentIndex,e)}addMeasurementsToCurrentFile(e){wpd.utils.addToCollection(this.measurementsByFile,this.currentIndex,e)}deleteDatasetsFromCurrentFile(e){wpd.utils.deleteFromCollection(this.datasetsByFile,this.currentIndex,e)}deleteMeasurementsFromCurrentFile(e){wpd.utils.deleteFromCollection(this.measurementsByFile,this.currentIndex,e)}getAxesNameMap(){return wpd.utils.invertObject(this.axesByFile)}getDatasetNameMap(){return wpd.utils.invertObject(this.datasetsByFile)}filterToCurrentFileAxes(e){return wpd.utils.filterCollection(this.axesByFile,this.currentIndex,e)}filterToCurrentFileDatasets(e){return wpd.utils.filterCollection(this.datasetsByFile,this.currentIndex,e)}filterToCurrentFileMeasurements(e){return wpd.utils.filterCollection(this.measurementsByFile,this.currentIndex,e)}getMetadata(){const s={},o=wpd.appData.getPlotData().getMeasurementColl();if(this._savePageManager(),1<this.fileCount()&&(s.file={axes:this.getAxesNameMap(),datasets:this.getDatasetNameMap(),measurements:o.map(e=>wpd.utils.findKey(this.measurementsByFile,e))}),0<Object.keys(this.pageManagers).length){let e=[{}],t=[{}],i=[],a={},n={};for(const l in this.pageManagers){e.push(this.pageManagers[l].getAxesNameMap()),t.push(this.pageManagers[l].getDatasetNameMap()),i.push(this.pageManagers[l].getMeasurementPageMap());var r=this.pageManagers[l].getPageLabelMap(),r=(Object.keys(r).length&&(a[l]=r),this.pageManagers[l].getRotationMap());Object.keys(r).length&&(n[l]=r)}s.page={axes:Object.assign.apply(null,e),datasets:Object.assign.apply(null,t),measurements:o.map(e=>{for(const a of i){var t=wpd.utils.findKey(a,e);if(t)return t}})},(Object.keys(a).length||Object.keys(n).length)&&(s.misc={},Object.keys(a).length&&(s.misc.pageLabel=a),Object.keys(n).length&&(s.misc.rotation=n))}return s}loadMetadata(l){let d=this,t=(l.file?(d.axesByFile=l.file.axes||{},d.datasetsByFile=l.file.datasets||{},d.measurementsByFile=l.file.measurements||{}):(d.axesByFile[0]=wpd.appData.getPlotData().getAxesColl().slice(),d.datasetsByFile[0]=wpd.appData.getPlotData().getDatasets().slice(),d.measurementsByFile[0]=wpd.appData.getPlotData().getMeasurementColl().slice()),[]);for(let i=0;i<d.files.length;i++){let e=null;"application/pdf"===d.files[i].type&&(0===i?d._savePageManager():e=new Promise((t,e)=>{let a=new FileReader;a.onload=function(){pdfjsLib.getDocument(a.result).promise.then(e=>t(e))},a.readAsDataURL(this.files[i])})),t.push(e)}return Promise.all(t).then(e=>{for(let i=0;i<e.length;i++){var n={};if("application/pdf"===d.files[i].type&&(null!==e[i]&&(d.pageManagers[i]=wpd.imageManager.initializePDFManager(e[i],!0)),l.page)){let e={},t={},a={};for(const s in l.page.axes)e[s]=l.page.axes[s].filter(e=>d.axesByFile[i]&&-1<d.axesByFile[i].indexOf(e));for(const o in l.page.datasets)t[o]=l.page.datasets[o].filter(e=>d.datasetsByFile[i]&&-1<d.datasetsByFile[i].indexOf(e));for(const r in l.page.measurements)a[r]=l.page.measurements[r].filter(e=>d.measurementsByFile[i]&&-1<d.measurementsByFile[i].indexOf(e));Object.assign(n,{axes:e,datasets:t,measurements:a})}l.misc&&(l.misc.pageLabel&&d.pageManagers.hasOwnProperty(i)&&Object.assign(n,{pageLabels:l.misc.pageLabel[i]}),l.misc.rotation&&d.pageManagers.hasOwnProperty(i)&&Object.assign(n,{rotations:l.misc.rotation[i]})),d.pageManagers.hasOwnProperty(i)&&(Object.keys(n).length&&d.pageManagers[i].loadPageData(n),0===i&&d.pageManagers[i].refreshInput())}wpd.tree.refresh()})}},wpd||{}),wpd=(wpd.gridDetection=function(){function t(t,e,a){var i=wpd.appData.getPlotData().getGridDetectionData().backupImageData;for(let e=0;e<i.data.length;e++)t.data[e]=i.data[e];return{imageData:t,width:e,height:a,keepZoom:!0}}function r(){wpd.graphicsWidget.removeTool(),wpd.appData.getPlotData().getGridDetectionData().gridData=null,wpd.graphicsWidget.removeRepainter(),wpd.graphicsWidget.resetData();let e=wpd.appData.getPlotData();null!=e.getGridDetectionData().backupImageData&&wpd.graphicsWidget.runImageOp(t)}function l(a,i,e){let n=wpd.appData.getPlotData().getGridDetectionData().gridData,s=wpd.appData.getPlotData().getTopColors()[0];if(null==s&&(s={r:255,g:0,b:0}),null!=n)for(let t=0;t<e;t++)for(let e=0;e<i;e++){var o=4*(t*i+e);n.has(o/4)&&(a.data[o]=s.r,a.data[1+o]=s.g,a.data[2+o]=s.b,a.data[3+o]=255)}return{imageData:a,width:i,height:e}}function i(){var e=parseFloat(document.getElementById("grid-color-distance").value);wpd.appData.getPlotData().getGridDetectionData().colorDistance=e}return{start:function(){wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.removeRepainter(),wpd.graphicsWidget.resetData(),wpd.sidebar.show("grid-detection-sidebar");{let e=document.getElementById("grid-color-picker-button"),t=document.getElementById("grid-background-mode"),a=wpd.appData.getPlotData().getGridDetectionData(),i=a.lineColor,n=a.gridBackgroundMode;null!=i&&(e.style.backgroundColor="rgb("+i[0]+","+i[1]+","+i[2]+")",i[0]+i[1]+i[2]<200?e.style.color="rgb(255,255,255)":e.style.color="rgb(0,0,0)"),t.checked=n}},markBox:function(){var e=new wpd.GridBoxTool;wpd.graphicsWidget.setTool(e)},clearMask:function(){wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.removeRepainter(),wpd.appData.getPlotData().getGridDetectionData().gridMask={xmin:null,xmax:null,ymin:null,ymax:null,pixels:new Set},wpd.graphicsWidget.resetData()},viewMask:function(){var e=new wpd.GridViewMaskTool;wpd.graphicsWidget.setTool(e)},grabMask:function(){let e=wpd.graphicsWidget.getAllContexts();var t,a,i=wpd.graphicsWidget.getImageSize(),n=e.oriDataCtx.getImageData(0,0,i.width,i.height);let s=new Set,o=0,r=wpd.appData.getPlotData().getGridDetectionData();for(let e=0;e<n.data.length;e+=4)255===n.data[e]&&255===n.data[e+1]&&0===n.data[e+2]&&(s.add(e/4),o++,t=parseInt(e/4%i.width,10),a=parseInt(e/4/i.width,10),1===o?(r.gridMask.xmin=t,r.gridMask.xmax=t,r.gridMask.ymin=a,r.gridMask.ymax=a):(t<r.gridMask.xmin&&(r.gridMask.xmin=t),t>r.gridMask.xmax&&(r.gridMask.xmax=t),a<r.gridMask.ymin&&(r.gridMask.ymin=a),a>r.gridMask.ymax&&(r.gridMask.ymax=a)));r.gridMask.pixels=s},startColorPicker:function(){wpd.colorSelectionWidget.setParams({color:wpd.appData.getPlotData().getGridDetectionData().lineColor,triggerElementId:"grid-color-picker-button",title:"Specify Grid Line Color",setColorDelegate:function(e){wpd.appData.getPlotData().getGridDetectionData().lineColor=e}}),wpd.colorSelectionWidget.startPicker()},changeColorDistance:i,changeBackgroundMode:function(){var e=document.getElementById("grid-background-mode").checked;wpd.appData.getPlotData().getGridDetectionData().gridBackgroundMode=e},testColor:function(){wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.resetData(),wpd.graphicsWidget.setRepainter(new wpd.GridColorFilterRepainter);let e=wpd.appData.getPlotData().getGridDetectionData(),t=(i(),wpd.graphicsWidget.getAllContexts());var a=wpd.graphicsWidget.getImageSize(),a=t.oriImageCtx.getImageData(0,0,a.width,a.height);e.generateBinaryData(a),wpd.colorSelectionWidget.paintFilteredColor(e.binaryData,e.gridMask.pixels)},run:function(){wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.removeRepainter(),wpd.graphicsWidget.resetData(),r();let e=wpd.appData.getPlotData().getGridDetectionData(),t=wpd.graphicsWidget.getAllContexts();var a=wpd.graphicsWidget.getImageSize(),i=document.getElementById("grid-horiz-perc"),n=document.getElementById("grid-vert-perc"),s=document.getElementById("grid-horiz-enable").checked,o=document.getElementById("grid-vert-enable").checked,a=(document.getElementById("grid-background-mode").checked,wpd.appData.getPlotData(),null==e.backupImageData&&(e.backupImageData=t.oriImageCtx.getImageData(0,0,a.width,a.height)),t.oriImageCtx.getImageData(0,0,a.width,a.height));e.generateBinaryData(a),wpd.gridDetectionCore.setHorizontalParameters(s,i.value),wpd.gridDetectionCore.setVerticalParameters(o,n.value),e.gridData=wpd.gridDetectionCore.run(e),wpd.graphicsWidget.runImageOp(l),wpd.appData.getPlotData().getGridDetectionData().gridData=null},reset:r}}(),wpd||{}),wpd=(wpd.gettext=function(e){e=document.getElementById("i18n-string-"+e);return e?e.innerHTML:"i18n string"},wpd||{}),wpd=(wpd.imageEditing={showImageInfo:function(){let e=document.getElementById("image-info-dimensions");var t=wpd.imageManager.getImageInfo();if(e.innerHTML="("+t.width+"x"+t.height+")",wpd.appData.isMultipage()){let e=document.getElementById("image-info-pages");e.innerHTML=wpd.appData.getPageManager().pageCount()}wpd.popup.show("image-info-popup")},startImageCrop:function(){wpd.graphicsWidget.setTool(new wpd.CropTool)},startPerspective:function(){wpd.popup.show("perspective-info")},startPerspectiveConfirmed:function(){},undo:function(){wpd.appData.getUndoManager().undo()},redo:function(){wpd.appData.getUndoManager().redo()}},wpd.ReversibleAction=class{constructor(){}execute(){}undo(){}},wpd.CropImageAction=class extends wpd.ReversibleAction{constructor(e,t,a,i){super(),this._x0=e,this._y0=t,this._x1=a,this._y1=i,this._originalImage=null}execute(){let e=wpd.graphicsWidget.getAllContexts();var t=wpd.graphicsWidget.getImageSize(),t=(this._originalImage=e.oriImageCtx.getImageData(0,0,t.width,t.height),this._x1-this._x0),a=this._y1-this._y0;let i=e.oriImageCtx.getImageData(this._x0,this._y0,t,a),n=Math.abs(t),s=Math.abs(a);wpd.graphicsWidget.runImageOp(function(e,t,a){return{imageData:i,width:n,height:s,keepZoom:!0}})}undo(){let i=this._originalImage;wpd.graphicsWidget.runImageOp(function(e,t,a){return{imageData:i,width:i.width,height:i.height}})}},wpd||{}),wpd=(wpd.imageManager=function(){let o=!0,r=!1,l={width:0,height:0};function t(a,t){return new Promise((i,e)=>{if(a.type.match("image.*")){wpd.busyNote.show();let e=new FileReader;e.onload=function(){n(e.result,t).then(i)},e.readAsDataURL(a)}else if("application/pdf"==a.type){wpd.busyNote.show();let t=new FileReader;t.onload=function(){var e=t.result;pdfjsLib.getDocument(e).promise.then(function(e){const t=wpd.appData.getPageManager();if(t)t.renderPage(t.currentPage()).then(i);else{const a=s(e);a.renderPage(1).then(i),wpd.appData.setPageManager(a)}})},t.readAsDataURL(a)}else console.log(a.type),wpd.messagePopup.show(wpd.gettext("invalid-file"),wpd.gettext("invalid-file-text"))})}function n(t,s){return new Promise((i,e)=>{let n=new Image;n.onload=function(){{var e=n,t=s;r&&(wpd.appData.reset(),wpd.sidebar.clear());const a=wpd.appData.getPageManager();a&&wpd.graphicsWidget.setRotation(a.getRotation()),e=wpd.graphicsWidget.loadImage(e),wpd.appData.plotLoaded(e),wpd.busyNote.close(),r?wpd.tree.refresh():wpd.tree.refreshPreservingSelection(),o?wpd.sidebar.show("start-sidebar"):t||wpd.popup.show("axesList"),o=!1,r=!1,l={width:e.width,height:e.height}}i()},n.src=t})}function a(e){const t=wpd.appData.getFileManager();t.reset(),t.set(e)}function s(e,t){const a=new wpd.PDFManager;return a.init(e,t),a}return{saveImage:function(){wpd.graphicsWidget.saveImage()},loadFromURL:n,loadFromFile:t,load:function(){var e=document.getElementById("fileLoadBox");0<e.files.length&&(r=!0,a(e.files),wpd.appData.setPageManager(null),t(e.files[0])),wpd.popup.close("loadNewImage")},getImageInfo:function(){return l},initializeFileManager:a,initializePDFManager:s}}(),wpd||{}),wpd=(wpd.acquireData=function(){var t,a;function e(){return wpd.tree.getActiveDataset()}function i(){var e=new wpd.ManualSelectionTool(a,t);wpd.graphicsWidget.setTool(e)}function n(){var e=new wpd.DeleteDataPointTool(a,t);wpd.graphicsWidget.setTool(e)}function s(){t.clearAll(),wpd.pointGroups.hideControls(),wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.resetData(),wpd.dataPointCounter.setCount(t.getCount()),wpd.graphicsWidget.removeRepainter()}function o(){var e;wpd.sidebar.show("acquireDataSidebar"),e=document.getElementById("edit-data-labels"),a instanceof wpd.BarAxes?e.style.display="inline-block":e.style.display="none",wpd.dataPointCounter.setCount(t.getCount())}function r(){wpd.graphicsWidget.setTool(new wpd.AdjustDataPointTool(a,t))}function l(){a instanceof wpd.BarAxes&&wpd.graphicsWidget.setTool(new wpd.EditLabelsTool(a,t))}return{load:function(){t=e(),null==(a=wpd.appData.getPlotData().getAxesForDataset(e()))?wpd.messagePopup.show(wpd.gettext("dataset-no-calibration"),wpd.gettext("calibrate-dataset")):(wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.resetData(),o(),wpd.autoExtraction.start(),wpd.dataPointCounter.setCount(),wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter(a,t)),i(),wpd.graphicsWidget.forceHandlerRepaint(),wpd.dataPointCounter.setCount(t.getCount()))},manualSelection:i,adjustPoints:r,deletePoint:n,clearAll:function(){t.getCount()<=0&&!t.hasPointGroups()||wpd.okCancelPopup.show(wpd.gettext("clear-data-points"),wpd.gettext("clear-data-points-text"),s,function(){})},undo:function(){t.removeLastPixel(),wpd.graphicsWidget.resetData(),wpd.graphicsWidget.forceHandlerRepaint(),wpd.dataPointCounter.setCount(t.getCount())},showSidebar:o,switchToolOnKeyPress:function(e){switch(e){case"d":n();break;case"a":i();break;case"s":r();break;case"e":l()}},isToolSwitchKey:function(e){return!!(wpd.keyCodes.isAlphabet(e,"a")||wpd.keyCodes.isAlphabet(e,"s")||wpd.keyCodes.isAlphabet(e,"d")||wpd.keyCodes.isAlphabet(e,"e"))},editLabels:l}}(),wpd.dataPointLabelEditor=function(){var s,o,r;function t(){var t=document.getElementById("data-point-label-field").value;if(null!=t&&0<t.length){var a=s.getPixel(o);let e={};(e=null!=a.metadata?a.metadata:e).label=t,s.setMetadataAt(o,e),wpd.graphicsWidget.resetData(),wpd.graphicsWidget.forceHandlerRepaint()}wpd.popup.close("data-point-label-editor"),wpd.graphicsWidget.setTool(r)}function a(){wpd.popup.close("data-point-label-editor"),wpd.graphicsWidget.setTool(r)}return{show:function(e,t,a){var i=e.getPixel(t).metadata.label;s=e,o=t,r=a,wpd.graphicsWidget.removeTool(),wpd.popup.show("data-point-label-editor");const n=document.getElementById("data-point-label-field");n.value=i,n.focus()},ok:t,cancel:a,keydown:function(e){wpd.keyCodes.isEnter(e.keyCode)?t():wpd.keyCodes.isEsc(e.keyCode)&&a(),e.stopPropagation()}}}(),wpd.dataPointValueOverrideEditor=function(){let l,n,d,s,o;const a="data-point-value-override-editor",r="data-point-value-override-editor-table",i="data-point-value-override-revert-flag",p="data-point-value-override-field-label-",g="data-point-value-override-field-",c="data-point-value-override-indicator-",u="Multiple points selected";function h(e,t,a,i){l=e,n=t,s=a,o=i,d=t.getAxesLabels().map(e=>e.toLowerCase()).filter(e=>"label"!==e),document.getElementById(r).innerHTML=function(){let a="";return d.forEach(e=>{let t=wpd.utils.toSentenceCase(e);n instanceof wpd.BarAxes&&"y"===e&&(t=wpd.utils.toSentenceCase("value")),a=(a=(a=(a=(a=(a=(a=(a+="<tr><td>")+'<span id="'+p+e+'">')+t+"</span>:")+"</td><td>")+'<input type="text" id="'+g+e+'" onkeydown="wpd.dataPointValueOverrideEditor.keydown(event);" />')+"</td><td>")+'<span id="'+c+e+'" hidden>&#8682;</span>')+"</td></tr>"}),a}(),wpd.graphicsWidget.removeTool(),e.selectPixels(a),i.displayMask(),wpd.graphicsWidget.forceHandlerRepaint(),window.addEventListener("keydown",w,!1)}function t(){s.forEach(t=>{if("1"!==document.getElementById(i).value){const n=l.getPixel(t),s=x(n);let e={},a={};null!=n.metadata&&(e=n.metadata,n.metadata.hasOwnProperty("overrides")&&(a=e.overrides));const o=l.getMetadataKeys(),r={};let i=!1;d.forEach(e=>{let t=document.getElementById(g+e).value;s[e]!=t&&(null!=t&&0<t.length?(i=!0,isNaN(t)||(t=parseFloat(t)),r[e]=t,o.indexOf("overrides")<0&&l.setMetadataKeys([...o,"overrides"])):a.hasOwnProperty(e)&&(i=!0,r[e]=a[e]))}),i?(e.overrides=r,l.setMetadataAt(t,e),wpd.graphicsWidget.resetData()):f(t)}else f(t)}),e()}function m(){e()}function w(e){wpd.keyCodes.isEnter(e.keyCode)?t():wpd.keyCodes.isEsc(e.keyCode)&&m(),e.stopPropagation()}function x(e){return n.pixelToData(e.x,e.y).reduce((e,t,a)=>({...e,[d[a]]:t}),{})}function f(e){let t=void 0;n instanceof wpd.BarAxes?(delete(t=l.getPixel(e).metadata).overrides,l.getAllPixels().some(e=>!(!e.metadata||!e.metadata.hasOwnProperty("overrides")))||l.setMetadataKeys(l.getMetadataKeys().filter(e=>"overrides"!==e))):l.hasMetadata()||l.setMetadataKeys([]),l.setMetadataAt(e,t)}function e(){y(!1),window.removeEventListener("keydown",w,!1),wpd.popup.close(a),wpd.graphicsWidget.setTool(o),o.toggleOverrideSection(s),wpd.graphicsWidget.forceHandlerRepaint()}function y(e){let t=e?"1":"0";document.getElementById(i).value=t}return{show:function(n,e,i,t){h(n,e,i,t),wpd.popup.show(a);const s={},o={},r={},l={};d.forEach(e=>{o[e]=!0,r[e]=!1,l[e]=[]}),i.forEach(e=>{const t=n.getPixel(e),a=x(t);let i={};null!=t.metadata&&t.metadata.hasOwnProperty("overrides")&&(i=t.metadata.overrides),d.forEach(e=>{i.hasOwnProperty(e)?(s[e]=i[e],l[e].push(i[e]),r[e]=!0):(s[e]=a[e],o[e]=!1)})}),d.forEach(t=>{const e=document.getElementById(g+t),a=document.getElementById(c+t);r[t]?(o[t]?l[t].every(e=>e===l[t][0])?e.value=s[t]:e.placeholder="Multiple override values":e.placeholder="Some values overridden",a.hidden=!1):(1===i.length?e.value=s[t]:e.placeholder=u,a.hidden=!0)})},ok:t,cancel:m,keydown:w,clear:function(){y(!0),s.forEach(e=>{const i=x(l.getPixel(e));d.forEach(e=>{let t=document.getElementById(g+e),a;1<s.length?(a="",t.placeholder=u):a=i[e],document.getElementById(g+e).value=a,document.getElementById(c+e).hidden=!0})})}}}(),wpd||{}),wpd=(wpd.measurementModes={distance:{name:"distance",connectivity:2,addButtonId:"add-pair-button",deleteButtonId:"delete-pair-button",sidebarId:"measure-distances-sidebar",init:function(){const t=wpd.appData.getPlotData(),e=wpd.appData.getFileManager();var a=e.filterToCurrentFileMeasurements(t.getMeasurementsByType(wpd.DistanceMeasurement));if(wpd.appData.isMultipage()){const s=wpd.appData.getPageManager();if(0==s.filterToCurrentPageMeasurements(a).length){var i=new wpd.DistanceMeasurement,n=s.getCurrentPageAxes();if(0<n.length)for(let e=n.length-1;-1<e;e--)if(n[e]instanceof wpd.MapAxes||n[e]instanceof wpd.ImageAxes){t.setAxesForMeasurement(i,n[e]);break}t.addMeasurement(i,!0),e.addMeasurementsToCurrentFile([i]),s.addMeasurementsToCurrentPage([i])}}else 0==a.length&&(a=new wpd.DistanceMeasurement,t.addMeasurement(a),e.addMeasurementsToCurrentFile([a]))},clear:function(){const e=wpd.appData.getPlotData(),t=wpd.appData.getFileManager();let a=t.filterToCurrentFileMeasurements(e.getMeasurementsByType(wpd.DistanceMeasurement));if(wpd.appData.isMultipage()){const i=wpd.appData.getPageManager();a=i.filterToCurrentPageMeasurements(a),i.deleteMeasurementsFromCurrentPage(a)}t.deleteMeasurementsFromCurrentFile(a),a.forEach(e=>{e.clearAll()}),e.deleteMeasurement(a[0]),wpd.tree.refresh()},getData:function(){const e=wpd.appData.getPlotData();let t=wpd.appData.getFileManager().filterToCurrentFileMeasurements(e.getMeasurementsByType(wpd.DistanceMeasurement));if(wpd.appData.isMultipage()){const a=wpd.appData.getPageManager();t=a.filterToCurrentPageMeasurements(t)}return t[0]},getAxes:function(){const e=wpd.appData.getPlotData();let t=wpd.appData.getFileManager().filterToCurrentFileMeasurements(e.getMeasurementsByType(wpd.DistanceMeasurement));if(wpd.appData.isMultipage()){const a=wpd.appData.getPageManager();t=a.filterToCurrentPageMeasurements(t)}return e.getAxesForMeasurement(t[0])},changeAxes:function(e){const t=wpd.appData.getPlotData();let a=wpd.appData.getFileManager().filterToCurrentFileMeasurements(t.getMeasurementsByType(wpd.DistanceMeasurement));if(wpd.appData.isMultipage()){const s=wpd.appData.getPageManager();a=s.filterToCurrentPageMeasurements(a)}var i=a[0],n=t.getAxesColl();-1==e?t.setAxesForMeasurement(i,null):t.setAxesForMeasurement(i,n[e]),wpd.tree.refreshPreservingSelection(!0)}},angle:{name:"angle",connectivity:3,addButtonId:"add-angle-button",deleteButtonId:"delete-angle-button",sidebarId:"measure-angles-sidebar",init:function(){const e=wpd.appData.getPlotData(),t=wpd.appData.getFileManager();var a,i=t.filterToCurrentFileMeasurements(e.getMeasurementsByType(wpd.AngleMeasurement));if(wpd.appData.isMultipage()){const n=wpd.appData.getPageManager();0==n.filterToCurrentPageMeasurements(i).length&&(a=new wpd.AngleMeasurement,e.addMeasurement(a,!0),t.addMeasurementsToCurrentFile([a]),n.addMeasurementsToCurrentPage([a]))}else 0==i.length&&(a=new wpd.AngleMeasurement,e.addMeasurement(a),t.addMeasurementsToCurrentFile([a]))},clear:function(){const e=wpd.appData.getPlotData(),t=wpd.appData.getFileManager();let a=t.filterToCurrentFileMeasurements(e.getMeasurementsByType(wpd.AngleMeasurement));if(t.deleteMeasurementsFromCurrentFile(a),wpd.appData.isMultipage()){const i=wpd.appData.getPageManager();a=i.filterToCurrentPageMeasurements(a),i.deleteMeasurementsFromCurrentPage(a)}a.forEach(e=>{e.clearAll()}),e.deleteMeasurement(a[0]),wpd.tree.refresh()},getData:function(){let e=wpd.appData.getPlotData(),t=wpd.appData.getFileManager().filterToCurrentFileMeasurements(e.getMeasurementsByType(wpd.AngleMeasurement));if(wpd.appData.isMultipage()){const a=wpd.appData.getPageManager();t=a.filterToCurrentPageMeasurements(t)}return t[0]}},area:{name:"area",connectivity:-1,addButtonId:"add-polygon-button",deleteButtonId:"delete-polygon-button",sidebarId:"measure-area-sidebar",init:function(){const e=wpd.appData.getPlotData(),t=wpd.appData.getFileManager();let a=t.filterToCurrentFileMeasurements(e.getMeasurementsByType(wpd.AreaMeasurement));if(wpd.appData.isMultipage()){const n=wpd.appData.getPageManager();0==(a=n.filterToCurrentPageMeasurements(a)).length&&(i=new wpd.AreaMeasurement,e.addMeasurement(i,!0),t.addMeasurementsToCurrentFile([i]),n.addMeasurementsToCurrentPage([i]))}else{var i;0==a.length&&(i=new wpd.AreaMeasurement,e.addMeasurement(i),t.addMeasurementsToCurrentFile([i]))}},clear:function(){const e=wpd.appData.getPlotData(),t=wpd.appData.getFileManager();let a=t.filterToCurrentFileMeasurements(e.getMeasurementsByType(wpd.AreaMeasurement));if(wpd.appData.isMultipage()){const i=wpd.appData.getPageManager();a=i.filterToCurrentPageMeasurements(a),i.deleteMeasurementsFromCurrentPage(a)}t.deleteMeasurementsFromCurrentFile(a),a.forEach(e=>{e.clearAll()}),e.deleteMeasurement(a[0]),wpd.tree.refresh()},getData:function(){const e=wpd.appData.getPlotData();let t=wpd.appData.getFileManager().filterToCurrentFileMeasurements(e.getMeasurementsByType(wpd.AreaMeasurement));if(wpd.appData.isMultipage()){const a=wpd.appData.getPageManager();t=a.filterToCurrentPageMeasurements(t)}return t[0]},getAxes:function(){const e=wpd.appData.getPlotData();let t=wpd.appData.getFileManager().filterToCurrentFileMeasurements(e.getMeasurementsByType(wpd.AreaMeasurement));if(wpd.appData.isMultipage()){const a=wpd.appData.getPageManager();t=a.filterToCurrentPageMeasurements(t)}return e.getAxesForMeasurement(t[0])},changeAxes:function(e){const t=wpd.appData.getPlotData();let a=wpd.appData.getFileManager().filterToCurrentFileMeasurements(t.getMeasurementsByType(wpd.AreaMeasurement));if(wpd.appData.isMultipage()){const s=wpd.appData.getPageManager();a=s.filterToCurrentPageMeasurements(a)}var i=a[0],n=t.getAxesColl();-1==e?t.setAxesForMeasurement(i,null):t.setAxesForMeasurement(i,n[e]),wpd.tree.refreshPreservingSelection(!0)}}},wpd.measurement=function(){var t;return{start:function(e){wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.resetData(),e.init(),wpd.sidebar.show(e.sidebarId),wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(e)),wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(e)),wpd.graphicsWidget.forceHandlerRepaint(),t=e},addItem:function(){wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(t)),wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(t))},deleteItem:function(){wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(t)),wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool(t))},clearAll:function(){wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.resetData(),t.clear()},changeAxes:function(e){t.changeAxes(parseInt(e,10))}}}(),wpd||{}),wpd=(wpd.PageManager=class{constructor(){this.handle=null,this.curPage=0,this.minPage=0,this.maxPage=0,this.customLabelsByPage={},this.rotationsByPage={},this.axesByPage={},this.datasetsByPage={},this.measurementsByPage={},this.$pageSelector=document.getElementById("image-page-nav-select"),this.$pageRelabelInput=document.getElementById("image-page-relabel-input"),this.$pageRelabelAllCheckbox=document.getElementById("image-page-relabel-all-checkbox"),this.$pageRelabelSetButton=document.getElementById("image-page-relabel-set-button"),this.$pageRelabelDeleteButton=document.getElementById("image-page-relabel-delete-button"),this.$pageRelabelDeleteAllButton=document.getElementById("image-page-relabel-delete-all-button")}init(e,t){return this.handle=e,this.curPage=1,this.minPage=1,this.maxPage=this.pageCount(),t||this._initializeInput(),this}_initializeInput(){const e=wpd.utils.integerRange(this.maxPage,this.minPage),t=this.curPage;this.getPageLabels().then(i=>{let n=[];e.forEach(e=>{var t=e-1;let a=e;this.customLabelsByPage.hasOwnProperty(e)?a=this.customLabelsByPage[e]+" (page "+e+" within file)":null!==i&&(a=i[t]+" (page "+e+" within file)"),n.push(a)},this),this.$pageSelector.innerHTML=wpd.utils.createOptionsHTML(n,e,t)})}refreshInput(){this._initializeInput(),this._resetRelabelPopup()}validateLabel(e){""!==e?(this.$pageRelabelSetButton.disabled=!1,wpd.utils.isInteger(e)?(this.$pageRelabelAllCheckbox.disabled=!1,this.$pageRelabelAllCheckbox.parentElement.style="color: black;"):(this.$pageRelabelAllCheckbox.checked=!1,this.$pageRelabelAllCheckbox.disabled=!0,this.$pageRelabelAllCheckbox.parentElement.style="color: lightgray;")):this.$pageRelabelSetButton.disabled=!0}_resetRelabelPopup(){this.$pageRelabelInput.value="",this.$pageRelabelAllCheckbox.checked=!1,this.$pageRelabelAllCheckbox.disabled=!0,this.$pageRelabelAllCheckbox.parentElement.style="color: lightgray;",this.$pageRelabelSetButton.disabled=!0,Object.keys(this.customLabelsByPage).length?(this.$pageRelabelDeleteAllButton.disabled=!1,this.customLabelsByPage.hasOwnProperty(this.curPage)?this.$pageRelabelDeleteButton.disabled=!1:this.$pageRelabelDeleteButton.disabled=!0):(this.$pageRelabelDeleteButton.disabled=!0,this.$pageRelabelDeleteAllButton.disabled=!0)}setLabel(){var e=this.$pageRelabelInput.value;if(""!==e){if(this.$pageRelabelAllCheckbox.checked){const t=wpd.utils.integerRange(this.maxPage,this.minPage),a=e-this.curPage;t.forEach(e=>this.customLabelsByPage[e]=e+a,this)}else this.customLabelsByPage[this.curPage]=e;this._initializeInput(),wpd.popup.close("image-page-relabel-popup"),this._resetRelabelPopup()}}deleteLabel(e){e?this.customLabelsByPage={}:delete this.customLabelsByPage[this.curPage],this._initializeInput(),wpd.popup.close("image-page-relabel-popup"),this._resetRelabelPopup()}setRotation(e){this.rotationsByPage[this.curPage]=e}getRotation(){return this.rotationsByPage[this.curPage]??0}get(){return this.handle}getPage(){}pageCount(){return 0}getPageLabels(){return new Promise(e=>e(null))}currentPage(){return this.curPage}previous(){this.switch(this.curPage-1)}next(){this.switch(this.curPage+1)}switch(e=1){wpd.busyNote.show();e=parseInt(e,10);if(!this._validatePageNumber(e))return wpd.busyNote.close(),wpd.messagePopup.show("Error","Invalid page number."),!1;this.curPage=e,this.$pageSelector.value=e,this.renderPage(e),this._resetRelabelPopup()}_validatePageNumber(e){return e>=this.minPage&&e<=this.maxPage}_pageRenderer(e,t,a){}renderPage(e){return new Promise((t,a)=>{this.getPage(e).then(e=>{this._pageRenderer(e,t,a)})})}_getCurrentPageObjects(e){return e[this.curPage]||[]}getCurrentPageAxes(){return this._getCurrentPageObjects(this.axesByPage)}getCurrentPageDatasets(){return this._getCurrentPageObjects(this.datasetsByPage)}addAxesToCurrentPage(e){wpd.utils.addToCollection(this.axesByPage,this.curPage,e)}addDatasetsToCurrentPage(e){wpd.utils.addToCollection(this.datasetsByPage,this.curPage,e)}addMeasurementsToCurrentPage(e){wpd.utils.addToCollection(this.measurementsByPage,this.curPage,e)}deleteAxesFromCurrentPage(e){wpd.utils.deleteFromCollection(this.axesByPage,this.curPage,e)}deleteDatasetsFromCurrentPage(e){wpd.utils.deleteFromCollection(this.datasetsByPage,this.curPage,e)}deleteMeasurementsFromCurrentPage(e){wpd.utils.deleteFromCollection(this.measurementsByPage,this.curPage,e)}getAxesNameMap(){return wpd.utils.invertObject(this.axesByPage)}getDatasetNameMap(){return wpd.utils.invertObject(this.datasetsByPage)}filterToCurrentPageAxes(e){return wpd.utils.filterCollection(this.axesByPage,this.curPage,e)}filterToCurrentPageDatasets(e){return wpd.utils.filterCollection(this.datasetsByPage,this.curPage,e)}filterToCurrentPageMeasurements(e){return wpd.utils.filterCollection(this.measurementsByPage,this.curPage,e)}getMeasurementPageMap(){return this.measurementsByPage}getPageLabelMap(){return this.customLabelsByPage}getRotationMap(){return this.rotationsByPage}loadPageData(e){this.axesByPage=e.axes||{},this.datasetsByPage=e.datasets||{},this.measurementsByPage=e.measurements||{},this.customLabelsByPage=e.pageLabels||{},this.rotationsByPage=e.rotations||{},Object.keys(this.rotationsByPage).length&&(wpd.graphicsWidget.setRotation(this.getRotation()),wpd.graphicsWidget.rotateAndResize())}},wpd.PDFManager=class extends wpd.PageManager{getPage(e){return this.handle.getPage(e)}getPageLabels(){return this.handle.getPageLabels()}pageCount(){return this.handle.numPages}_pageRenderer(e,t,a){const i=this;var n=e.getViewport({scale:3});let s=document.createElement("canvas");var o=s.getContext("2d");s.width=n.width,s.height=n.height,e.render({canvasContext:o,viewport:n}).promise.then(function(){var e=s.toDataURL();wpd.imageManager.loadFromURL(e,!0).then(()=>{wpd.graphicsWidget.setRotation(i.getRotation()),wpd.graphicsWidget.rotateAndResize(),t()})},function(e){console.log(e),wpd.busyNote.close(),a(e)})}},wpd||{}),wpd=(wpd.UndoManager=class{constructor(){this._actions=[],this._actionIndex=0}canUndo(){return 0<this._actionIndex&&this._actions.length>=this._actionIndex}undo(){if(this.canUndo()){this._actionIndex--;let e=this._actions[this._actionIndex];e.undo(),this.updateUI()}}canRedo(){return this._actions.length>this._actionIndex}redo(){if(this.canRedo()){let e=this._actions[this._actionIndex];e.execute(),this._actionIndex++,this.updateUI()}}reapply(){if(this.canUndo()){for(let t=0;t<this._actionIndex;t++){let e=this._actions[t];e.execute()}this.updateUI()}}insertAction(e){e instanceof wpd.ReversibleAction?(this.canRedo()&&(this._actions.length=this._actionIndex),this._actions.push(e),this._actionIndex++,this.updateUI()):console.error("action must be a wpd.ReversibleAction!")}clear(){this._actions=[],this._actionIndex=0,this.updateUI()}updateUI(){const e=document.getElementById("image-editing-undo"),t=document.getElementById("image-editing-redo");this.canUndo()?e.disabled=!1:e.disabled=!0,this.canRedo()?t.disabled=!1:t.disabled=!0}},wpd||{});wpd.utils={addToCollection:function(e,t,a){e[t]||(e[t]=[]),Array.prototype.push.apply(e[t],a)},createOptionsHTML:function(t,a,i){t.length!==a.length&&console.error("labels and values length mismatch");let n="";for(let e=0;e<t.length;e++)n+='<option value="'+a[e]+'"',a[e]===i&&(n+=" selected"),n+=">"+t[e]+"</option>";return n},deleteFromCollection:function(t,a,e){t[a]&&e.forEach(e=>{e=t[a].indexOf(e);-1<e&&t[a].splice(e,1)})},filterCollection:function(t,a,e){let i=[];return i=t[a]?e.filter(e=>-1<t[a].indexOf(e)):i},findKey:function(e,t){for(const a in e)if(-1<e[a].indexOf(t))return parseInt(a,10)},integerRange:function(e,a=0){return Array.apply(null,Array(e)).map((e,t)=>t+a)},invertObject:function(e){let a={};return Object.entries(e).forEach(([t,e])=>{e.forEach(e=>a[e.name]=parseInt(t,10))}),a},isInteger:function(e){return/^-?[1-9]\d*$|^0$/.test(e)},toggleElementsDisplay:function(e,t){for(const a of e)a.hidden=t},toSentenceCase:function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}};